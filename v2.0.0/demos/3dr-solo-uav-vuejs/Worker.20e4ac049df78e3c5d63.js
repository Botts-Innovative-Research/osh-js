!function(t){var e={};function a(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(r,n,function(e){return t[e]}.bind(null,n));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,a){"use strict";a.r(e);Math.pow(2,53);function r(t){return null!=t}var n=class{constructor(t,e=1,a=5){this.dataSourceMap={},this.bufferingTime=1e3,this.startBufferingTime=-1,this.tsRun=0,this.replaySpeed=e,this.intervalRate=a;let r=-1;for(let e of t)this.addDataSource(e),r=e.bufferingTime>r?e.bufferingTime:r;-1!==r&&(this.bufferingTime=r)}push(t,e){const a=this.dataSourceMap[t];-1===this.startBufferingTime&&(this.startBufferingTime=performance.now(),setTimeout(()=>this.processData(),this.bufferingTime));let r=0;this.tsRun>0&&(r=this.tsRun-e.timeStamp),a.latency=r>a.latency?r:(a.latency+r)/2,a.dataBuffer.push(e)}reset(){this.close();for(let t in this.dataSourceMap){this.dataSourceMap[t].dataBuffer=[]}this.startBufferingTime=-1}processData(){let t,e=-1,a=performance.now();for(let a in this.dataSourceMap)t=this.dataSourceMap[a],t.dataBuffer.length>0&&(e=-1===e||t.dataBuffer[0].timeStamp<e?t.dataBuffer[0].timeStamp:e);this.interval=setInterval(()=>{for(;this.computeNextData(e,a););},this.intervalRate)}computeNextData(t,e){let a,r,n=null,i=0;for(let t in this.dataSourceMap)if(a=this.dataSourceMap[t],a.latency>0){let t=Math.min(a.latency,a.timeOut);i=t>i?t:i,r=a.latency<r?a.latency:r}const s=performance.now()-e;this.tsRun=t+s;for(let e in this.dataSourceMap)if(a=this.dataSourceMap[e],a.dataBuffer.length>0){a.dataBuffer[0].timeStamp-t<=(s-i)*this.replaySpeed&&(n=null===n?a:n.dataBuffer[0].timeStamp<a.dataBuffer[0].timeStamp?n:a)}if(null!==n){let t=n.dataBuffer.shift();return t["@latency"]=a.latency-r,this.onData(n.id,t),!0}return!1}addDataSource(t){this.dataSourceMap[t.id]={bufferingTime:t.bufferingTime,timeOut:t.timeOut||0,dataBuffer:[],startBufferingTime:-1,id:t.id,timedOut:!1,name:t.name||t.id,latency:0}}onData(t,e){}close(){r(this.interval)&&(clearInterval(this.interval),console.log("Data synchronizer terminated successfully"))}};const i={};let s,u=!1,o=null;function f(t){for(let e of t)s.addDataSource(e),i[e.id]=new BroadcastChannel("datasource-data-"+e.id)}function d(t,e){self.currentTime=e.timeStamp,i[t].postMessage({message:"data",dataSourceId:t,...e})}self.currentTime=-1,self.onmessage=t=>{"init"===t.data.message?(s=new n(t.data.dataSources,t.data.replaySpeed,t.data.intervalRate),s.onData=d,u=!0,f(t.data.dataSources),o=new BroadcastChannel(t.data.topic),o.onmessage=t=>{s.push(t.data.dataSourceId,{data:t.data.data,timeStamp:t.data.timeStamp})}):"add"===t.data.message&&t.data.dataSources?f(t.data.dataSources):"current-time"===t.data.message?self.postMessage({message:"current-time",data:self.currentTime}):"reset"===t.data.message?s.reset():null!==s&&s.push(t.data.dataSourceId,t.data.data)},self.onclose=function(){s.close(),console.log("Data Synchronizer has been terminated successfully")}}]);