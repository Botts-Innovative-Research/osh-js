!function(t){var e={};function n(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(s,o,function(e){return t[e]}.bind(null,o));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);Math.pow(2,53);function s(t){return null!=t}function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}var i=class{buildUrl(t){let e="";e+=t.protocol+"://",e+=t.endpointUrl+"?",e+="service="+t.service+"&",e+="version=2.0&",e+="request=GetResult&",e+="offering="+t.offeringID+"&",t.foiURN&&""!==t.foiURN&&(e+="featureOfInterest="+t.foiURN+"&"),e+="observedProperty="+t.observedProperty+"&";const n=s(t.lastTimeStamp)?t.lastTimeStamp:t.startTime;return this.lastStartTime=t.startTime,e+="temporalFilter=phenomenonTime,"+n+"/"+t.endTime+"&",t.replaySpeed&&(e+="replaySpeed="+t.replaySpeed),t.responseFormat&&(e+="&responseFormat="+t.responseFormat),e}};var r=class extends i{parseTimeStamp(t){return 1e3*new DataView(t).getFloat64(0,!1)}parseData(t){return{frameData:new Uint8Array(t,12,t.byteLength-12),roll:0}}};var c=class{constructor(t){this.url=t,this.id="DataConnector-"+o(),this.reconnectTimeout=12e4}setUrl(t){this.url=t}getId(){return this.id}getUrl(){return this.url}setReconnectTimeout(t){this.reconnectTimeout=t}onReconnect(){}disconnect(){}};var a=class extends c{constructor(t){super(t),this.interval=-1,this.lastReceiveTime=-1}connect(){this.init||(this.init=!0,this.ws=new WebSocket(this.getUrl()),this.ws.binaryType="arraybuffer",this.ws.onmessage=function(t){this.lastReceiveTime=Date.now(),t.data.byteLength>0&&this.onMessage(t.data)}.bind(this),this.ws.onerror=function(t){console.error("WebSocket stream error: "+t),this.ws.close(),this.init=!1,this.lastReceiveTime=-1}.bind(this),-1===this.interval&&(this.interval=setInterval(function(){let t=Date.now()-this.lastReceiveTime;(-1===this.lastReceiveTime||t>=this.reconnectTimeout)&&(console.warn(`trying to reconnect after ${this.reconnectTimeout} ..`),this.reconnect())}.bind(this),this.reconnectTimeout)))}disconnect(){this.fullDisconnect(!0)}fullDisconnect(t){null!=this.ws&&(this.ws.close(),this.init=!1),t&&clearInterval(this.interval)}reconnect(){this.onReconnect(),this.init&&this.fullDisconnect(!1),this.connect()}onMessage(t){}close(){this.disconnect()}};var h=class extends c{constructor(t,e){super(t),this.method="POST",this.responseType="arraybuffer",s(e)&&(e.method&&(this.method=e.method),e.responseType&&(this.responseType=e.responseType))}sendRequest(t,e){let n=this,o=new XMLHttpRequest;o.timeout=6e4,null===t?(s(e)?o.open("GET",this.getUrl()+"?"+e,!0):o.open("GET",this.getUrl(),!0),o.responseType=this.responseType,o.onload=t=>{o.response&&n.onMessage(o.response)},o.ontimeout=t=>{console.log("Timeout")},o.send(null)):(o.open("POST",this.getUrl(),!0),o.setRequestHeader("Content-Type","text/xml"),o.send(t),o.onreadystatechange=()=>{o.readyState<4||4===o.readyState&&(200===o.status&&o.status<300?n.onSuccess(o.responseText):n.onError(""))})}onError(t){}onSuccess(t){}connect(){this.sendRequest(null)}};var l=class extends c{constructor(t){super(t),this.lastReceiveTime=-1,this.interval=-1,this.broadcastChannel=null}connect(){null===this.broadcastChannel&&(this.broadcastChannel=new BroadcastChannel(this.getUrl()),this.broadcastChannel.onmessage=t=>{this.lastReceiveTime=Date.now(),this.onMessage(t.data.data)},this.broadcastChannel.onerror=t=>{console.error("BroadcastChannel stream error: "+t),this.broadcastChannel.close(),this.init=!1,this.lastReceiveTime=-1},-1===this.interval&&(this.interval=setInterval(function(){let t=Date.now()-this.lastReceiveTime;(-1===this.lastReceiveTime||t>=this.reconnectTimeout)&&(console.warn(`trying to reconnect after ${this.reconnectTimeout} ..`),this.reconnect())}.bind(this),this.reconnectTimeout)))}disconnect(){this.fullDisconnect(!0)}fullDisconnect(t){null!=this.broadcastChannel&&(this.broadcastChannel.close(),this.broadcastChannel=null),t&&clearInterval(this.interval)}reconnect(){this.onReconnect(),this.init&&this.fullDisconnect(!1),this.connect()}onMessage(t){}close(){this.disconnect()}};const u=new class{constructor(t){this.parser=t,this.connector=null,this.lastTimeStamp=null,this.lastStartTime="now",this.timeShift=0,this.reconnectTimeout=1e4,this.connected=!1}createConnector(t,e,n){this.dataSourceId=n,null!==this.connector&&(this.connector.disconnect(),this.connector=null),this.broadcastChannel=new BroadcastChannel(e);const o=JSON.parse(t);s(o.timeShift)&&(this.timeShift=o.timeShift),s(o.bufferingTime)&&(this.bufferingTime=o.bufferingTime),s(o.timeOut)&&(this.timeOut=o.timeOut),s(o.reconnectTimeout)&&(this.reconnectTimeout=o.reconnectTimeout),this.properties=o,this.createDataConnector(o)}createDataConnector(t){const e=this.parser.buildUrl({...t,timeShift:this.timeShift});t.protocol.startsWith("ws")?(this.connector=new a(e),this.connector.onMessage=this.onMessage.bind(this),this.connector.setReconnectTimeout(this.reconnectTimeout)):t.protocol.startsWith("http")?(this.connector=new h(e),this.connector.responseType="arraybuffer",this.connector.onMessage=this.onMessage.bind(this),this.connector.setReconnectTimeout(this.reconnectTimeout)):t.protocol.startsWith("topic")&&(this.connector=new l(e),this.connector.onMessage=this.onMessage.bind(this),this.connector.setReconnectTimeout(this.reconnectTimeout));const n=this.parser.lastStartTime;null!==this.connector&&(this.connector.onReconnect=()=>{"now"!==n&&this.connector.setUrl(this.parser.buildUrl({lastTimeStamp:new Date(this.lastTimeStamp).toISOString(),...this.properties}))})}setTopic(t){null!==this.broadcastChannel&&this.broadcastChannel.close(),this.broadcastChannel=new BroadcastChannel(t),this.topic=t}connect(){null!==this.connector&&this.connector.connect()}disconnect(){null!==this.connector&&this.connector.disconnect()}onMessage(t){const e={dataSourceId:this.dataSourceId,timeStamp:this.parser.parseTimeStamp(t)+this.timeShift,data:this.parser.parseData(t)};this.lastTimeStamp=e.timeStamp,this.broadcastChannel.postMessage(e)}}(new r);function d(t){self.postMessage(t)}self.onmessage=t=>{"init"===t.data.message?(u.createConnector(t.data.properties,t.data.topic,t.data.id),u.onData=d):"connect"===t.data.message?u.connect():"disconnect"===t.data.message?u.disconnect():"topic"===t.data.message&&u.setTopic(t.data.topic)}}]);