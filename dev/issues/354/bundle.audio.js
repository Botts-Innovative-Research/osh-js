!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){e.exports=function(){return new Worker(r.p+"WorkerName.4b6b3a7e99d0758bc8ae.js")}},function(e,t,r){"use strict";r.r(t);Math.pow(2,53);function n(e){return null!=e}function s(e,t="letiable"){if(!n(e))throw t+" must be defined";return e}function o(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}const i="disconnected";var a=class{constructor(e,t,r){this.id="DataSource-"+o(),this.name=e,this.properties=t,this.dataSourceWorker=r,this.currentRunningProperties={},this.initDataSource(t)}initDataSource(e){this.dataSourceWorker.postMessage({message:"init",id:this.id,properties:JSON.stringify(e),topic:this.getTopicId()})}disconnect(){this.dataSourceWorker.postMessage({message:"disconnect"})}onDisconnect(){return new Promise(e=>{new BroadcastChannel(this.getTopicId()).onmessage=t=>{t.data.status===i&&e()}})}async connect(){return this.dataSourceWorker.postMessage({message:"connect"}),this.isConnected()}async isConnected(){const e=new Promise(e=>{null!==this.dataSourceWorker&&(this.dataSourceWorker.onmessage=t=>{"is-connected"===t.data.message&&e(t.data.data)})});return null!==this.dataSourceWorker&&this.dataSourceWorker.postMessage({message:"is-connected"}),e}getId(){return this.id}getName(){return this.name}updateProperties(e){this.currentRunningProperties={...this.properties,...e},null!==this.dataSourceWorker&&this.dataSourceWorker.postMessage({message:"update-url",data:e})}getCurrentRunningProperties(){return this.currentRunningProperties}terminate(){null!==this.dataSourceWorker&&this.dataSourceWorker.terminate()}getTopicId(){return"datasource-data-"+this.id}};var c=class extends a{constructor(e,t,r){super(e,t,r),s(t,"Some properties must be defined"),s(t.startTime,"startTime must must be defined"),s(t.endTime,"startTime must must be defined"),this.timeSync=null}setDataSynchronizer(e){this.timeSync=e,this.dataSourceWorker.postMessage({message:"topic",topic:"data-synchronizer-"+this.timeSync.id,timeTopic:this.getTimeTopicId()})}initDataSource(e){super.initDataSource(e),this.dataSourceWorker.postMessage({message:"topic",topic:this.getTopicId(),timeTopic:this.getTimeTopicId()})}setTimeRange(e,t,r,s=!1){let o={};n(r)&&(o={replaySpeed:r}),this.updateProperties({...this.currentRunningProperties,startTime:e,endTime:t,...o,reconnect:s})}getStartTime(){return this.properties.startTime}getEndTime(){return this.properties.endTime}getMinTime(){return this.properties.minTime}getMaxTime(){return this.properties.maxTime}getReplaySpeed(){return n(this.properties.replaySpeed)?this.properties.replaySpeed:1}async getCurrentTime(){if(n(this.timeSync))return this.timeSync.getCurrentTime();{const e=new Promise(e=>{null!==this.dataSourceWorker&&(this.dataSourceWorker.onmessage=t=>{"last-timestamp"===t.data.message&&e(t.data.data)})});return null!==this.dataSourceWorker&&this.dataSourceWorker.postMessage({message:"last-timestamp"}),e}}updateProperties(e){super.updateProperties(e)}getTimeTopicId(){return"datasource-time-"+this.id}},u=r(0),d=r.n(u);var p=class extends c{constructor(e,t){super(e,{timeShift:0,reconnectTimeout:5e3,...t},new d.a)}};const l=document.querySelector("button");document.getElementById("samples");l.onclick=()=>async function(){let e=new p("alex-audio",{protocol:"ws",service:"SOS",endpointUrl:"sensiasoft.net:8181/sensorhub/sos",offeringID:"urn:android:device:dd90fceba7fd5b47-sos",observedProperty:"http://sensorml.com/ont/swe/property/AudioFrame",startTime:"2021-03-24T09:56:00Z",endTime:"now",replaySpeed:1});const t=new BroadcastChannel("datasource-data-"+e.id);let r=0,n=0,s=0,o=null,i=0;t.onmessage=async e=>{if("data"===e.data.type)for(let t of e.data.values){const e=t.data.frameData;if(r++,o=null===o?new Uint8Array(e,0,e.byteLength).buffer:h(o,new Uint8Array(e,0,e.byteLength).buffer),i>=2){console.log("flushing...");try{let e=await m.decodeAudioData(o),t=m.createBufferSource();t.buffer=e,t.connect(m.destination),0===s?t.start(0):t.start(s),s+=e.duration}catch(t){n++,console.error(t,n,"at ",s,"secs",e)}console.log(r,n),o=null,i=0}else i++}},e.connect()}();let m=new(window.AudioContext||window.webkitAudioContext);m.onstatechange=function(){console.log(m.state)};const h=(e,t)=>{const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer}}]);
//# sourceMappingURL=bundle.audio.js.map