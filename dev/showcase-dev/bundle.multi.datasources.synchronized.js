!function(e){var t={};function i(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t,i){e.exports=function(){return new Worker(i.p+"WorkerName.27386b597f6c5dbc8783.js")}},function(e,t,i){e.exports=function(){return new Worker(i.p+"WorkerName.02f73fbf5c63f1c18de6.js")}},function(e,t,i){e.exports=function(){return new Worker(i.p+"WorkerName.0cf0829430aaaddd46f4.js")}},function(e,t,i){"use strict";i.r(t);const s=document.getElementById("datasource-video0"),a=document.getElementById("datasource-video1"),r=document.getElementById("datasource-video2"),n=document.getElementById("error"),o=document.getElementById("last-video0"),m=document.getElementById("last-video1"),c=document.getElementById("last-video2"),h=document.getElementById("current-time");let d=0,p=0,u=0,S=0;const g={DATA:"data",LAST_TIME:"last-time",MASTER_TIME:"master-time",STATUS:"status",TIME_CHANGED:"time-changed",CLOSED:"closed"},T="replay",y="realTime";Math.pow(2,53);function l(e){return null!=e}function M(e,t="letiable"){if(!l(e))throw t+" must be defined";return e}function D(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}var w=i(0),v=i.n(w);var I=class{constructor(e,t){this.id=t.id||"DataSource-"+D(),this.name=e,this.properties=t,this.eventSubscriptionMap={},this.init=void 0,this.messagesMap={},this.mode=y,l(t.mode)&&(this.mode=t.mode)}getId(){return this.id}getName(){return this.name}terminate(){null!==this.dataSourceWorker&&this.dataSourceWorker.terminate()}getTopicId(){return"datasource-data-"+this.id}subscribe(e,t){for(let i=0;i<t.length;i++)t[i]in this.eventSubscriptionMap||(this.eventSubscriptionMap[t[i]]=[]),this.eventSubscriptionMap[t[i]].push(e)}async createWorker(e){return new v.a}async updateProperties(e){return this.properties={...this.properties,...e},new Promise(t=>{this.postMessage({message:"update-properties",data:e},t)})}async connect(){await this.checkInit(),await this.doConnect()}async initDataSource(e=this.properties){return new Promise(async(t,i)=>{this.dataSourceWorker=await this.createWorker(this.properties),this.handleWorkerMessage(),this.postMessage({message:"init",id:this.id,properties:e,topics:{data:this.getTopicId()}},async e=>{new BroadcastChannel(this.getTopicId()).onmessage=async e=>{await this.handleMessage(e)},t(e)})})}async handleMessage(e){const t=e.data.type;if(t in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[t].length;i++)this.eventSubscriptionMap[t][i](e.data)}async checkInit(){return new Promise(async(e,t)=>{l(this.init)||(this.init=this.initDataSource()),await this.init,e()})}async doConnect(){return new Promise(async e=>{this.postMessage({message:"connect"},e)})}async isConnected(){return new Promise(async e=>{this.init?(await this.checkInit(),this.postMessage({message:"is-connected"},e)):e(!1)})}async disconnect(){return new Promise(async e=>{await this.checkInit(),this.postMessage({message:"disconnect"},e)})}postMessage(e,t){const i=D();this.dataSourceWorker.postMessage({...e,messageId:i}),l(t)&&(this.messagesMap[i]=t)}handleWorkerMessage(){this.dataSourceWorker.onmessage=e=>{const t=e.data.messageId;t in this.messagesMap&&(this.messagesMap[t](e.data.data),delete this.messagesMap[t])}}async onDisconnect(){}reset(){this.init=void 0}onRemovedDataSource(e){}onAddedDataSource(e){}};var f=class extends I{constructor(e,t){super(e,t),this.dataSynchronizer=void 0,this.properties.version=0}getTimeTopicId(){return"datasource-time-"+this.id}getMode(){return y}getStartTimeAsIsoDate(){return"now"}getStartTimeAsTimestamp(){return Date.now()}getEndTimeAsIsoDate(){return this.getMaxTimeAsTimestamp()}getEndTimeAsTimestamp(){return this.getMaxTimeAsTimestamp()}getMinTimeAsIsoDate(){return"now"}getMaxTimeAsIsoDate(){return"2055-01-01Z"}getMinTimeAsTimestamp(){return Date.now()}getMaxTimeAsTimestamp(){return new Date("2055-01-01Z").toISOString()}setMinTime(e){}setMaxTime(e){}setStartTimestamp(e){}setEndTimestamp(e){}getReplaySpeed(){return 1}setReplaySpeed(e){}setVersion(e){this.properties.version=e}async setDataSynchronizer(e){return new Promise(async(t,i)=>{console.log("set dataSynchronizer"),await this.checkInit();const s="data-synchronizer-"+e.id;this.dataSynchronizer=e,this.properties.version=this.dataSynchronizer.version(),this.postMessage({message:"topics",topics:{data:s,time:this.getTimeTopicId(),sync:e.getTimeTopicId()}},()=>t())})}async removeDataSynchronizer(){this.dataSourceWorker&&(this.dataSourceWorker.terminate(),this.dataSynchronizer=void 0),await this.checkInit()}async disconnect(){return new Promise(async e=>{await this.checkInit(),this.postMessage({message:"disconnect"},e)})}async doConnect(){return console.log(this.dataSynchronizer),new Promise(async e=>{this.postMessage({message:"connect",startTime:"now",version:this.version()},e)})}async initDataSource(e){return await super.initDataSource(e),new Promise(async(e,t)=>{const i={data:this.getTopicId(),time:this.getTimeTopicId()};this.dataSynchronizer&&(i.sync=dataSynchronizer.getTimeTopicId()),this.postMessage({message:"topics",topics:i},async()=>{new BroadcastChannel(this.getTimeTopicId()).onmessage=async e=>{await this.handleTimeMessage(e)},e()})})}async handleTimeMessage(e){const t=e.data.type;if(t in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[t].length;i++)this.eventSubscriptionMap[t][i](e.data)}version(){return this.properties.version}};var A=class extends I{constructor(e,t){super(e,t),"minTime"in t?this.properties.minTimestamp=new Date(t.minTime).getTime():this.setMinTime(t.startTime),"maxTime"in t?this.properties.maxTimestamp=new Date(t.maxTime).getTime():this.setMaxTime(t.endTime),this.properties.startTimestamp=new Date(t.startTime).getTime(),this.properties.endTimestamp=new Date(t.endTime).getTime(),M(t,"Some properties must be defined"),this.dataSynchronizer=void 0,this.properties.version=0}getTimeTopicId(){return"datasource-time-"+this.id}getMode(){return this.properties.mode}getStartTimeAsIsoDate(){return new Date(this.getStartTimeAsTimestamp()).toISOString()}getStartTimeAsTimestamp(){return this.properties.startTimestamp}getEndTimeAsIsoDate(){return new Date(this.getEndTimeAsTimestamp()).toISOString()}getEndTimeAsTimestamp(){return this.properties.endTimestamp}getMinTimeAsIsoDate(){return new Date(this.getMinTimeAsTimestamp()).toISOString()}getMaxTimeAsIsoDate(){return new Date(this.getMaxTimeAsTimestamp()).toISOString()}getMinTimeAsTimestamp(){return this.properties.minTimestamp}getMaxTimeAsTimestamp(){return this.properties.maxTimestamp}setMinTime(e){this.properties.minTimestamp=new Date(e).getTime()}setMaxTime(e){this.properties.maxTimestamp=new Date(e).getTime()}setStartTimestamp(e){this.properties.startTimestamp=e,this.computeMinMax()}setEndTimestamp(e){this.properties.endTimestamp=e,this.computeMinMax()}setStartTime(e){this.setStartTimestamp(new Date(e).getTime())}setEndTime(e){this.setEndTimestamp(new Date(e).getTime())}getReplaySpeed(){return this.properties.replaySpeed}setReplaySpeed(e){this.properties.replaySpeed=e}setVersion(e){this.properties.version=e}async setDataSynchronizer(e){return new Promise(async(t,i)=>{await this.checkInit();const s="data-synchronizer-"+e.getId();this.dataSynchronizer=e,this.properties.version=this.dataSynchronizer.version(),this.postMessage({message:"topics",topics:{data:s,time:this.getTimeTopicId(),sync:e.getTimeTopicId()}},()=>t())})}async removeDataSynchronizer(){this.dataSourceWorker&&(this.dataSourceWorker.terminate(),this.dataSynchronizer=void 0),await this.checkInit()}async disconnect(){return await this.checkInit(),new Promise(async e=>{await this.checkInit(),this.postMessage({message:"disconnect"},e)})}async doConnect(){return new Promise(async e=>{let t;l(this.dataSynchronizer)&&(t=this.dataSynchronizer.getMode()===y?"now":this.getStartTimeAsIsoDate()),this.postMessage({message:"connect",startTime:t,version:this.version()},e)})}async initDataSource(e){return await super.initDataSource(e),new Promise(async(e,t)=>{const i={data:this.getTopicId(),time:this.getTimeTopicId()};this.dataSynchronizer&&(i.sync=dataSynchronizer.getTimeTopicId()),this.postMessage({message:"topics",topics:i},async()=>{new BroadcastChannel(this.getTimeTopicId()).onmessage=async e=>{await this.handleTimeMessage(e)},e()})})}async handleTimeMessage(e){const t=e.data.type;if(t in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[t].length;i++)this.eventSubscriptionMap[t][i](e.data)}version(){return this.properties.version}computeMinMax(){this.properties.startTimestamp<this.properties.minTimestamp&&(this.properties.startTimestamp=this.properties.minTimestamp),this.properties.endTimestamp>this.properties.maxTimestamp&&(this.properties.endTimestamp=this.properties.maxTimestamp)}async setTimeRange(e=this.getStartTimeAsIsoDate(),t=this.getEndTimeAsIsoDate(),i=this.getReplaySpeed(),s=!1,a=this.getMode(),r=this.version()){return await this.checkInit(),r!==this.version()&&(this.properties.version=r),this.properties.startTimestamp=new Date(e).getTime(),this.properties.endTimestamp=new Date(t).getTime(),this.computeMinMax(),this.updateProperties({startTime:this.getStartTimeAsIsoDate(),endTime:this.getEndTimeAsIsoDate(),replaySpeed:i,reconnect:s,mode:a,version:r})}};var z=class{constructor(e,t){const i=D();this.timeSeriesRealtimeDataSource=new f(e,{id:i,...t}),this.timeSeriesReplayDataSource=new A(e,{id:i,...t}),this.setMode(t.mode)}async setMode(e){this.timeSeriesDataSource&&await this.timeSeriesDataSource.disconnect(),this.timeSeriesDataSource&&e===this.timeSeriesDataSource.getMode()||(this.timeSeriesDataSource=e===y?this.timeSeriesRealtimeDataSource:this.timeSeriesReplayDataSource,this.properties=this.timeSeriesDataSource.properties,this.id=this.timeSeriesDataSource.id,this.name=this.timeSeriesDataSource.name,this.properties.mode=e)}getTimeTopicId(){return this.timeSeriesDataSource.getTimeTopicId()}getMode(){return this.timeSeriesDataSource.getMode()}setVersion(e){this.timeSeriesDataSource.setVersion(e)}getStartTimeAsIsoDate(){return this.timeSeriesDataSource.getStartTimeAsIsoDate()}getStartTimeAsTimestamp(){return this.timeSeriesDataSource.getStartTimeAsTimestamp()}getEndTimeAsIsoDate(){return this.timeSeriesDataSource.getEndTimeAsIsoDate()}getEndTimeAsTimestamp(){return this.timeSeriesDataSource.getEndTimeAsTimestamp()}getMinTimeAsIsoDate(){return this.timeSeriesDataSource.getMinTimeAsIsoDate()}getMaxTimeAsIsoDate(){return this.timeSeriesDataSource.getMaxTimeAsIsoDate()}getMinTimeAsTimestamp(){return this.timeSeriesDataSource.getMinTimeAsTimestamp()}getMaxTimeAsTimestamp(){return this.timeSeriesDataSource.getMaxTimeAsTimestamp()}setMinTime(e){this.timeSeriesDataSource.setMinTime(e)}setMaxTime(e){this.timeSeriesDataSource.setMaxTime(e)}setStartTimestamp(e){this.timeSeriesDataSource.setStartTimestamp(e)}setEndTimestamp(e){this.timeSeriesDataSource.setEndTimestamp(e)}setStartTime(e){this.timeSeriesDataSource.setStartTime(e)}setEndTime(e){this.timeSeriesDataSource.setEndTime(e)}getReplaySpeed(){return this.timeSeriesDataSource.getReplaySpeed()}setReplaySpeed(e){this.timeSeriesDataSource.setReplaySpeed(e)}async setDataSynchronizer(e){return this.timeSeriesDataSource.setDataSynchronizer(e)}async removeDataSynchronizer(){return this.timeSeriesDataSource.removeDataSynchronizer()}async disconnect(){return this.timeSeriesDataSource.disconnect()}async doConnect(){return this.timeSeriesDataSource.doConnect()}async initDataSource(e){return this.timeSeriesDataSource.initDataSource(e)}version(){return this.timeSeriesDataSource.version()}async setTimeRange(e=this.getStartTimeAsIsoDate(),t=this.getEndTimeAsIsoDate(),i=this.getReplaySpeed(),s=!1,a=this.getMode(),r=this.version()){return this.timeSeriesDataSource.setTimeRange(e,t,i,s,a,r)}getId(){return this.timeSeriesDataSource.getId()}getName(){return this.timeSeriesDataSource.getName()}terminate(){this.timeSeriesDataSource.terminate()}getTopicId(){return this.timeSeriesDataSource.getTopicId()}subscribe(e,t){this.timeSeriesDataSource.subscribe(e,t)}async updateProperties(e){return this.timeSeriesDataSource.updateProperties(e)}async connect(){return this.timeSeriesDataSource.connect()}async checkInit(){return this.timeSeriesDataSource.checkInit()}async isConnected(){return this.timeSeriesDataSource.isConnected()}reset(){this.timeSeriesDataSource.reset()}onTimeChanged(e,t,i,s){}};var x=class extends z{constructor(e,t){super(e,{protocol:"ws",service:"SOS",timeShift:0,reconnectTimeout:5e3,reconnectRetry:10,tls:!1,type:"SosGetResult",mode:y,prefetchBatchSize:250,prefetchBatchDuration:5e3,...t})}},b=i(1),R=i.n(b);var k=class{constructor(e,t){this.bufferingTime=1e3,this.id=e.id||D(),this.dataSources=e.dataSources||[],this.replaySpeed=e.replaySpeed||1,this.timerResolution=e.timerResolution||5,this.masterTimeRefreshRate=e.masterTimeRefreshRate||250,this.initialized=!1,this.timeSync=t,this.properties={},this.properties.replaySpeed=this.replaySpeed,this.properties.startTimestamp=void 0,this.properties.endTimestamp=void 0,this.properties.minTimestamp=void 0,this.properties.maxTimestamp=void 0,this.properties.version=0,l(e)&&(l(e.minTime)&&(this.minTimestamp=new Date(e.minTime).getTime()),l(e.maxTime)&&(this.maxTimestamp=new Date(e.maxTime).getTime())),this.eventSubscriptionMap={},this.messagesMap={},this.computeMinMax()}getId(){return this.id}getTopicId(){return"data-synchronizer-"+this.id}getTimeTopicId(){return"data-synchronizer-time-"+this.id}getDataSources(){return this.dataSources}computeMinMax(){if(this.dataSources.length>0){let e=Number.MAX_VALUE,t=Number.MIN_VALUE,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(let a of this.dataSources){let r=a.getMinTimeAsTimestamp(),n=a.getMaxTimeAsTimestamp();r<e&&(e=r),n>t&&(t=n);let o=a.getStartTimeAsTimestamp(),m=a.getEndTimeAsTimestamp();o<i&&(i=o),m>s&&(s=m)}l(this.minTimestamp)&&this.minTimestamp>e&&(e=this.minTimestamp),l(this.maxTimestamp)&&this.maxTimestamp>s&&(t=this.maxTimestamp),this.properties.minTimestamp=e,this.properties.maxTimestamp=t,l(this.properties.startTimestamp)||(this.properties.startTimestamp=i),l(this.properties.endTimestamp)||(this.properties.endTimestamp=s)}}initEventSubscription(){new BroadcastChannel(this.getTopicId()).onmessage=e=>{const t=e.data.type;if(t in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[t].length;i++)this.eventSubscriptionMap[t][i](e.data)},new BroadcastChannel(this.getTimeTopicId()).onmessage=e=>{e.data.type===g.MASTER_TIME&&(this.properties.startTimestamp=e.data.timestamp);const t=e.data.type;if(t in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[t].length;i++)this.eventSubscriptionMap[t][i](e.data)}}getStartTimeAsIsoDate(){if(0===this.dataSources.length)throw"dataSource array is empty";return new Date(this.properties.startTimestamp).toISOString()}getStartTimeAsTimestamp(){if(0===this.dataSources.length)throw"dataSource array is empty";return this.properties.startTimestamp}getEndTimeAsIsoDate(){if(0===this.dataSources.length)throw"dataSource array is empty";return new Date(this.properties.endTimestamp).toISOString()}getEndTimeAsTimestamp(){if(0===this.dataSources.length)throw"dataSource array is empty";return this.properties.endTimestamp}getMinTimeAsIsoDate(){if(0===this.dataSources.length)throw"dataSource array is empty";return new Date(this.properties.minTimestamp).toISOString()}getMinTimeAsTimestamp(){if(0===this.dataSources.length)throw"dataSource array is empty";return this.properties.minTimestamp}getMaxTimeAsIsoDate(){if(0===this.dataSources.length)throw"dataSource array is empty";return new Date(this.properties.maxTimestamp).toISOString()}getMaxTimeAsTimestamp(){if(0===this.dataSources.length)throw"dataSource array is empty";return this.properties.maxTimestamp}async setStartTime(e,t=!1){this.properties.startTimestamp=new Date(e).getTime(),t||await this.updateAlgo()}async setEndTime(e,t=!1){this.properties.endTimestamp=new Date(e).getTime(),t||await this.updateAlgo()}async setMaxTime(e){this.properties.maxTimestamp=new Date(e).getTime();for(let t of this.dataSources)t.setMaxTime(e);this.computeMinMax(),this.timeChanged()}getReplaySpeed(){return this.replaySpeed}terminate(){null!==this.synchronizerWorker&&(this.synchronizerWorker.terminate(),this.synchronizerWorker=null);for(let e of this.dataSources)e.terminate()}subscribe(e,t){for(let i=0;i<t.length;i++)t[i]in this.eventSubscriptionMap||(this.eventSubscriptionMap[t[i]]=[]),this.eventSubscriptionMap[t[i]].push(e)}getMode(){return T}async initDataSources(){return new Promise(async(e,t)=>{try{const t=[];for(let e of this.dataSources){const i=await this.createDataSourceForWorker(e);t.push(i)}this.synchronizerWorker=new R.a,this.handleWorkerMessage(),await this.postMessage({message:"init",dataSources:t,replaySpeed:this.replaySpeed,timerResolution:this.timerResolution,masterTimeRefreshRate:this.masterTimeRefreshRate,startTimestamp:this.getStartTimeAsTimestamp(),endTimestamp:this.getEndTimeAsTimestamp(),mode:this.getMode(),version:this.version(),topics:{data:this.getTopicId(),time:this.getTimeTopicId()}},function(){this.initEventSubscription(),this.initialized=!0,e()}.bind(this),!1)}catch(e){console.error(e),t(e)}})}async createDataSourceForWorker(e){const t={bufferingTime:e.properties.bufferingTime||0,timeOut:e.properties.timeOut||0,id:e.getId(),name:e.getName(),minTimestamp:e.getMinTimeAsTimestamp(),maxTimestamp:e.getMaxTimeAsTimestamp()};try{await e.setDataSynchronizer(this.timeSync),e.properties.replaySpeed=this.replaySpeed}catch(e){throw console.error("Cannot set the synchronizer to this DataSource",e),e}return t}timeChanged(){this.onTimeChanged(this.getMinTimeAsTimestamp(),this.getMaxTimeAsTimestamp(),this.getStartTimeAsTimestamp(),this.getEndTimeAsTimestamp())}async addDataSource(e){return new Promise(async t=>{if(this.dataSources.push(e),this.computeMinMax(),this.initialized){const i=await this.createDataSourceForWorker(e);await e.setTimeRange(this.getStartTimeAsIsoDate(),this.getEndTimeAsIsoDate(),this.getReplaySpeed(),!1,this.getMode(),this.version()),await this.postMessage({message:"add",dataSources:[i]},async()=>{this.onAddedDataSource(e.id),this.timeChanged(),t()})}else console.log(`DataSynchronizer not initialized yet, add DataSource ${e.id} as it`),this.timeChanged(),t()})}async removeDataSource(e){return new Promise(async t=>{this.dataSources=this.dataSources.filter(t=>t.id!==e.getId()),0===this.dataSources.length&&await this.reset(),this.computeMinMax(),this.initialized?(await e.removeDataSynchronizer(),await this.postMessage({message:"remove",dataSourceIds:[e.getId()],startTimestamp:this.getStartTimeAsTimestamp(),endTimestamp:this.getEndTimeAsTimestamp()},async()=>{this.timeChanged(),this.onRemovedDataSource(e.id),t()})):(console.log(`DataSynchronizer not initialized yet, remove DataSource ${e.id} as it`),this.timeChanged(),t())})}async push(e,t){return new Promise(async(i,s)=>{null!==this.synchronizerWorker&&await this.postMessage({type:"data",dataSourceId:e,data:t},i)})}version(){return this.properties.version}async connect(){0!==this.dataSources.length&&(console.log("connect replay"),await this.checkInit(),await this.isConnected()||await this.doConnect())}async checkInit(){const e=this;return new Promise(async(t,i)=>{l(e.init)||(e.init=e.initDataSources()),await e.init,t()})}async doConnect(){return new Promise(async e=>{await this.updateAlgo();for(let e of this.dataSources)await e.connect();await this.postMessage({message:"connect",version:this.version()},e)})}async disconnect(){await this.reset();for(let e of this.dataSources)await e.disconnect()}async setReplaySpeed(e){return new Promise(async t=>{this.replaySpeed=e,this.properties.replaySpeed=e,await this.postMessage({message:"replay-speed",replaySpeed:e},t)})}async setTimeRange(e=this.getStartTimeAsIsoDate(),t=this.getEndTimeAsIsoDate(),i=this.getReplaySpeed(),s=!1){return new Promise(async s=>{this.incVersion(),this.replaySpeed=i,await this.setStartTime(e,!0),await this.setEndTime(t,!0),this.computeMinMax();for(let i of this.dataSources)await i.setTimeRange(e,t,this.getReplaySpeed(),!1,this.getMode(),this.version());return this.updateAlgo()})}async updateAlgo(){for(let e of this.dataSources)e.setStartTimestamp(this.getStartTimeAsTimestamp()),e.setEndTimestamp(this.getEndTimeAsTimestamp());this.computeMinMax();const e=[];for(let t of this.dataSources){const i={bufferingTime:t.properties.bufferingTime||0,timeOut:t.properties.timeOut||0,id:t.getId(),name:t.getName(),minTimestamp:t.getMinTimeAsTimestamp(),maxTimestamp:t.getMaxTimeAsTimestamp()};e.push(i)}return new Promise(t=>this.postMessage({message:"time-range",mode:this.getMode(),replaySpeed:this.getReplaySpeed(),startTimestamp:this.getStartTimeAsTimestamp(),endTimestamp:this.getEndTimeAsTimestamp(),version:this.version(),dataSources:e},t))}async updateProperties(e){for(let t of this.dataSources)t.updateProperties(e)}resetTimes(){this.computeMinMax()}async reset(){return new Promise(async e=>{await this.checkInit(),await this.postMessage({message:"reset"}),this.resetTimes(),e()})}async getCurrentTime(){return new Promise(async e=>{await this.postMessage({message:"current-time"},e)})}async isConnected(){return 0!==this.dataSources.length&&(await this.checkInit(),new Promise(async e=>{await this.postMessage({message:"is-connected"},t=>e(t.data))}))}async postMessage(e,t,i=!0){i&&await this.checkInit();const s=D();this.synchronizerWorker.postMessage({...e,messageId:s}),l(t)&&(this.messagesMap[s]=t)}handleWorkerMessage(){this.synchronizerWorker.onmessage=e=>{const t=e.data.messageId;t in this.messagesMap&&(this.messagesMap[t](e.data.data),delete this.messagesMap[t])}}incVersion(){this.properties.version++}onTimeChanged(e,t,i,s){}onRemovedDataSource(e){}onAddedDataSource(e){}},E=i(2),P=i.n(E);var C=class{constructor(e,t){this.bufferingTime=1e3,this.id=e.id||D(),this.dataSources=e.dataSources||[],this.timerResolution=e.timerResolution||5,this.masterTimeRefreshRate=e.masterTimeRefreshRate||250,this.initialized=!1,this.timeSync=t,this.properties={},this.properties.version=0,this.eventSubscriptionMap={},this.messagesMap={}}getId(){return this.id}getDataSources(){return this.dataSources}getTopicId(){return"data-synchronizer-"+this.id}getTimeTopicId(){return"data-synchronizer-time-"+this.id}initEventSubscription(){new BroadcastChannel(this.getTopicId()).onmessage=e=>{const t=e.data.type;if(t in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[t].length;i++)this.eventSubscriptionMap[t][i](e.data)},new BroadcastChannel(this.getTimeTopicId()).onmessage=e=>{const t=e.data.type;if(t in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[t].length;i++)this.eventSubscriptionMap[t][i](e.data)}}terminate(){null!==this.synchronizerWorker&&(this.synchronizerWorker.terminate(),this.synchronizerWorker=null);for(let e of this.dataSources)e.terminate()}subscribe(e,t){for(let i=0;i<t.length;i++)t[i]in this.eventSubscriptionMap||(this.eventSubscriptionMap[t[i]]=[]),this.eventSubscriptionMap[t[i]].push(e)}getMode(){return y}async initDataSources(){return new Promise(async(e,t)=>{try{const t=[];for(let e of this.dataSources){const i=await this.createDataSourceForWorker(e);t.push(i)}this.synchronizerWorker=new P.a,this.handleWorkerMessage(),await this.postMessage({message:"init",dataSources:t,timerResolution:this.timerResolution,masterTimeRefreshRate:this.masterTimeRefreshRate,mode:y,version:this.version(),topics:{data:this.getTopicId(),time:this.getTimeTopicId()}},function(){this.initEventSubscription(),this.initialized=!0,e()}.bind(this),!1)}catch(e){console.log(e),t(e)}})}async createDataSourceForWorker(e){const t={bufferingTime:e.properties.bufferingTime||0,timeOut:e.properties.timeOut||0,id:e.id,name:e.name};try{await e.setDataSynchronizer(this.timeSync)}catch(e){throw console.error("Cannot set the synchronizer to this DataSource",e),e}return t}async addDataSource(e){return new Promise(async t=>{if(this.dataSources.push(e),this.initialized){const i=await this.createDataSourceForWorker(e);await this.postMessage({message:"add",dataSources:[i]},async()=>{this.onAddedDataSource(e.id),t()})}else console.log(`DataSynchronizer not initialized yet, add DataSource ${e.id} as it`),t()})}async removeDataSource(e){return new Promise(async t=>{await e.removeDataSynchronizer(),this.dataSources=this.dataSources.filter(t=>t.id!==e.getId()),0===this.dataSources.length&&await this.reset(),this.initialized?await this.postMessage({message:"remove",dataSourceIds:[e.getId()]},async()=>{this.onRemovedDataSource(e.id),t()}):(console.log(`DataSynchronizer not initialized yet, remove DataSource ${e.id} as it`),t())})}async push(e,t){return new Promise(async(i,s)=>{null!==this.synchronizerWorker&&await this.postMessage({type:"data",dataSourceId:e,data:t},i)})}version(){return this.properties.version}async connect(){await this.checkInit(),await this.doConnect()}async checkInit(){const e=this;return new Promise(async(t,i)=>{l(e.init)||(e.init=e.initDataSources()),await e.init,t()})}async doConnect(){return new Promise(async e=>{for(let e of this.dataSources)await e.connect();await this.postMessage({message:"connect",version:this.version()},e)})}async disconnect(){await this.reset();for(let e of this.dataSources)await e.disconnect()}async updateProperties(e){for(let t of this.dataSources)t.updateProperties(e)}async reset(){return new Promise(async e=>{await this.checkInit(),await this.postMessage({message:"reset"}),e()})}async getCurrentTime(){return new Promise(async e=>{await this.postMessage({message:"current-time"},e)})}async isConnected(){return 0!==this.dataSources.length&&(await this.checkInit(),new Promise(async e=>{await this.postMessage({message:"is-connected"},t=>e(t.data))}))}setMinTime(e){}setMaxTime(e){}async postMessage(e,t,i=!0){i&&await this.checkInit();const s=D();this.synchronizerWorker.postMessage({...e,messageId:s}),l(t)&&(this.messagesMap[s]=t)}handleWorkerMessage(){this.synchronizerWorker.onmessage=e=>{const t=e.data.messageId;t in this.messagesMap&&(this.messagesMap[t](e.data.data),delete this.messagesMap[t])}}incVersion(){this.properties.version++}onTimeChanged(e,t){}onRemovedDataSource(e){}onAddedDataSource(e){}};var W=class{constructor(e){const t=e.id||D();this.dataSynchronizerReplay=new k({...e,id:t+"-replay"},this),this.dataSynchronizerRt=new C({...e,id:t+"-realtime"},this),this.setMode(e.mode||T).then(()=>{this.dataSynchronizer.onTimeChanged=(e,t,i,s)=>this.onTimeChanged(e,t,i,s),this.dataSynchronizer.onAddedDataSource=e=>this.onAddedDataSource(e),this.dataSynchronizer.onRemovedDataSource=e=>this.onRemovedDataSource(e)})}getId(){return this.id}async setMode(e){this.dataSynchronizer&&await this.dataSynchronizer.disconnect(),e===T?this.dataSynchronizer=this.dataSynchronizerReplay:e===y&&(this.dataSynchronizer=this.dataSynchronizerRt),this.id=this.dataSynchronizer.id;for(let t of this.dataSynchronizer.getDataSources())await t.setMode(e)}getDataSources(){return this.dataSynchronizer.getDataSources()}getTopicId(){return this.dataSynchronizer.getTopicId()}getTimeTopicId(){return this.dataSynchronizer.getTimeTopicId()}getStartTimeAsIsoDate(){return this.dataSynchronizer.getStartTimeAsIsoDate()}getStartTimeAsTimestamp(){return this.dataSynchronizer.getStartTimeAsTimestamp()}getEndTimeAsIsoDate(){return this.dataSynchronizer.getEndTimeAsIsoDate()}getEndTimeAsTimestamp(){return this.dataSynchronizer.getEndTimeAsTimestamp()}getMinTimeAsIsoDate(){return this.dataSynchronizer.getMinTimeAsIsoDate()}getMinTimeAsTimestamp(){return this.dataSynchronizer.getMinTimeAsTimestamp()}getMaxTimeAsIsoDate(){return this.dataSynchronizer.getMinTimeAsTimestamp()}getMaxTimeAsTimestamp(){return this.dataSynchronizer.getMaxTimeAsTimestamp()}getReplaySpeed(){return this.dataSynchronizer.getReplaySpeed()}terminate(){return this.dataSynchronizer.terminate()}subscribe(e,t){this.dataSynchronizerRt.subscribe(e,t),this.dataSynchronizerReplay.subscribe(e,t)}getMode(){return this.dataSynchronizer.getMode()}async initDataSources(){return this.dataSynchronizer.initDataSources()}async addDataSource(e){return new Promise(async t=>{await this.dataSynchronizerRt.addDataSource(e),await this.dataSynchronizerReplay.addDataSource(e),t()})}async removeDataSource(e){return new Promise(async t=>{await this.dataSynchronizerRt.removeDataSource(e),await this.dataSynchronizerReplay.removeDataSource(e),t()})}async push(e,t){return this.dataSynchronizer.push(e,t)}version(){return this.dataSynchronizer.version()}async connect(){await this.dataSynchronizer.connect()}async checkInit(){return this.dataSynchronizer.checkInit()}async doConnect(){return console.log("do connect"),this.dataSynchronizer.doConnect()}async disconnect(){return this.dataSynchronizer.disconnect()}async setReplaySpeed(e){return this.dataSynchronizer.setReplaySpeed(e)}async setTimeRange(e=this.getStartTimeAsIsoDate(),t=this.getEndTimeAsIsoDate(),i=this.getReplaySpeed(),s=!1){return this.dataSynchronizer.setTimeRange(e,t,i,s)}async updateProperties(e){return this.dataSynchronizer.updateProperties(e)}async reset(){return this.dataSynchronizer.reset()}async getCurrentTime(){return this.dataSynchronizer.getCurrentTime()}setMinTime(e){this.dataSynchronizer.setMinTime(e)}setMaxTime(e){this.dataSynchronizer.setMaxTime(e)}async isConnected(){return this.dataSynchronizer.isConnected()}onTimeChanged(e,t){}onRemovedDataSource(e){}onAddedDataSource(e){}};const O="2015-12-19T21:04:29.231Z",N="2015-12-19T21:09:19.675Z",V=new x("drone-Video",{endpointUrl:"sensiasoft.net/sensorhub/sos",offeringID:"urn:mysos:solo:video2",observedProperty:"http://sensorml.com/ont/swe/property/VideoFrame",startTime:O,endTime:N,mode:T,tls:!0}),B=new x("drone-Video",{endpointUrl:"sensiasoft.net/sensorhub/sos",offeringID:"urn:mysos:solo:video2",observedProperty:"http://sensorml.com/ont/swe/property/VideoFrame",startTime:O,endTime:N,mode:T,tls:!0}),F=new x("drone-Video",{endpointUrl:"sensiasoft.net/sensorhub/sos",offeringID:"urn:mysos:solo:video2",observedProperty:"http://sensorml.com/ont/swe/property/VideoFrame",startTime:O,endTime:N,mode:T,tls:!0}),_=new W({replaySpeed:1.2,masterTimeRefreshRate:150,startTime:O,endTime:N,dataSources:[V,B,F]});V.subscribe(e=>function(e){let t;for(let i=0;i<e.length;i++)t=e[i],t.data.videoFrame.data=e[i].data.videoFrame.data.slice(0,5),++d%10==0?s.value=JSON.stringify([t])+"\n":s.value+=JSON.stringify([t])+"\n";o.innerText=new Date(e[e.length-1].data.timestamp).toISOString()+" - Video 0",h.innerText=new Date(e[e.length-1].data.timestamp).toISOString()+" - Current",s.scrollTop=s.scrollHeight}(e.values),[g.DATA]),B.subscribe(e=>function(e){let t;for(let i=0;i<e.length;i++)t=e[i],t.data.videoFrame.data=e[i].data.videoFrame.data.slice(0,5),++p%10==0?a.value=JSON.stringify([t])+"\n":a.value+=JSON.stringify([t])+"\n";m.innerText=new Date(e[e.length-1].data.timestamp).toISOString()+" - Video 1",h.innerText=new Date(e[e.length-1].data.timestamp).toISOString()+" - Current",a.scrollTop=a.scrollHeight}(e.values),[g.DATA]),F.subscribe(e=>function(e){let t;for(let i=0;i<e.length;i++)t=e[i],t.data.videoFrame.data=e[i].data.videoFrame.data.slice(0,5),++u%10==0?r.value=JSON.stringify([t])+"\n":r.value+=JSON.stringify([t])+"\n";c.innerText=new Date(e[e.length-1].data.timestamp).toISOString()+" - Video 2",h.innerText=new Date(e[e.length-1].data.timestamp).toISOString()+" - Current",r.scrollTop=r.scrollHeight}(e.values),[g.DATA]),_.subscribe(e=>{return(t=e.timestamp)<S&&(n.value+=new Date(t).toISOString()+" < "+new Date(S).toISOString()+"\n"),void(S=t);var t},[g.TIME]),_.connect()}]);