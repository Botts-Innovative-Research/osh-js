(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{10:function(e,t,s){"use strict";s.d(t,"b",(function(){return i})),s.d(t,"a",(function(){return r})),s.d(t,"c",(function(){return a}));Math.pow(2,53);function i(e){return null!=e}function r(e){const[t,s,i]=e.match(/\w\w/g).map(e=>parseInt(e,16));return[t,s,i]}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}},149:function(e,t,s){e.exports=function(){return new Worker(s.p+"6449dd2b2849737ffe2e.worker.js")}},154:function(e,t,s){"use strict";var i=s(10);const r=new class{constructor(){this.eventMap={}}remove(e,t){e in this.eventMap&&(this.eventMap[e]=this.eventMap[e].filter(e=>e.id!==t))}removeById(e){for(let t in this.eventMap)this.eventMap[t]=this.eventMap[t].filter(t=>t.id!==e)}observe(e,t,s="any"){Object(i.b)(e)&&Object(i.b)(t)&&Object(i.b)(s)&&(e in this.eventMap||(this.eventMap[e]=[]),this.eventMap[e].push({fn:t,id:s}))}fire(e,t){if(Object(i.b)(e)&&e in this.eventMap){let s=this.eventMap[e];for(let e=0;e<s.length;e++)s[e].fn(t)}}};var a=class{static remove(e,t="any"){r.remove("osh:"+e,t)}static removeById(e="any"){r.removeById(e)}static registerView(e){e.registerCallback()}static unregisterView(e){e.unregisterCallback()}static fire(e,t){t.name=e,r.fire("osh:"+e,t)}static observe(e,t,s="any"){r.observe("osh:"+e,t,s)}static observeDiv(e,t,s){document.getElementById(e).addEventListener(t,s)}static get EVENT(){return{SELECT_VIEW:"selectView",SHOW_VIEW:"showView",UAV_TAKEOFF:"uav:takeoff",UAV_GOTO:"uav:goto",UAV_LOOKAT:"uav:lookat",UAV_LAND:"uav:land",UAV_ORBIT:"uav:orbit",LOADING_START:"loading:start",LOADING_STOP:"loading:stop",ADD_VIEW_ITEM:"addViewItem",RESIZE:"resize",PTZ_SEND_REQUEST:"ptzSendRequest"}}},n=(s(168),s(79)),o=s(95);const d="data",l="status";var c=class{constructor(e,t,s){this.layers=[],this.viewItems=[],this.names={},this.lastRec={},this.selectedDataSources=[],this.dataSources=[],this.entity=null,this.id="view-"+Object(i.c)(),this.entity=null,this.dataSourceId=-1,Object(i.b)(s)&&Object(i.b)(s.dataSourceId)&&(this.dataSourceId=s.dataSourceId),Object(i.b)(s)&&Object(i.b)(s.entity)&&(this.entity=s.entity),this.css="",this.cssSelected="",Object(i.b)(s)&&Object(i.b)(s.css)&&(this.css=s.css),Object(i.b)(s)&&Object(i.b)(s.cssSelected)&&(this.cssSelected=s.cssSelected),this.init(e,t,s)}init(e,t,s){this.elementDiv=document.createElement("div"),this.elementDiv.setAttribute("id",this.id),this.elementDiv.setAttribute("class",this.css+" osh-view"),this.divId=this.id;let r=document.getElementById(e);if(Object(i.b)(r)&&null!==r?(r.appendChild(this.elementDiv),this.container=r):(document.body.appendChild(this.elementDiv),this.hide(),this.container=document.body),this.beforeAddingItems(s),Object(i.b)(t))for(let e=0;e<t.length;e++)this.addViewItem(t[e]);Object(i.b)(s)&&Object(i.b)(s.show)&&(document.getElementById(this.divId).style.display=s.show?"block":"none"),this.handleEvents();var a=this;this.registerCallback(),new MutationObserver(e=>{e.forEach((function(e){"style"===e.attributeName&&a.onResize()}))}).observe(this.elementDiv,{attributes:!0});new MutationObserver((function(e){Object(i.b)(document.getElementById(a.divId))||(this.disconnect(),a.destroy())})).observe(document.body,{childList:!0})}registerCallback(){if(Object(i.b)(this.dataSourceId)||Object(i.b)(this.entity)){const t=this;function e(e){new BroadcastChannel(n.a+e).onmessage=s=>{s.data.message&&"reset"===s.data.message?t.reset():s.data.type===d?t.setData(e,s.data.values):s.data.type===l&&s.data.status===o.a.DISCONNECTED&&t.reset()}}if(null!==this.entity)for(let t of this.entity.getDataSources())e(t.id);else e(this.dataSourceId)}}unregisterCallback(){a.removeById(this.divId)}hide(){this.elementDiv.style.display="none"}onResize(){}attachTo(e){Object(i.b)(this.elementDiv.parentNode)&&this.elementDiv.parentNode.removeChild(this.elementDiv),document.getElementById(e).appendChild(this.elementDiv),"none"===this.elementDiv.style.display&&(this.elementDiv.style.display="block"),this.onResize()}beforeAddingItems(e){}getId(){return this.id}getDivId(){return this.divId}setData(e,t){}show(e){}destroy(){this.unregisterCallback()}addViewItem(e){if(this.viewItems.push(e),e.hasOwnProperty("layer")){let t=e.layer;this.layers.push(t),e.hasOwnProperty("name")&&(this.names[t.markerId]=e.name),t.viewItem=e,t.init(this);let s=t.getDataSourcesIds();for(let e=0;e<s.length;e++){const i=s[e];let r=this;new BroadcastChannel(n.a+i).onmessage=e=>{e.data.type===l&&e.data.status===o.a.DISCONNECTED||e.data.type===d&&(t.setData(i,e.data,r),r.lastRec[i]=e.data)}}}}removeViewItem(e){if(this.viewItems.includes(e)){for(let t in e.layer.dataSourceToLayerMap)delete this.lastRec[t];this.viewItems=this.viewItems.filter(t=>t!==e)}this.layers=this.layers.filter(t=>t.id!==e.layer.id),delete this.names[e.layer.markerId]}removeViewItems(){for(const e of this.viewItems)this.removeViewItem(e)}handleEvents(){var e=this;a.observe(a.EVENT.SELECT_VIEW,t=>e.selectDataView(t.dataSourcesIds,t.entityId),this.divId),a.observe(a.EVENT.SHOW_VIEW,t=>e.show(t),this.divId),a.observe(a.EVENT.ADD_VIEW_ITEM,t=>{Object(i.b)(t.viewId)&&t.viewId===e.id&&e.addViewItem(t.viewItem)},this.divId),a.observe(a.EVENT.RESIZE+"-"+this.divId,t=>e.onResize(),this.divId)}selectDataView(e,t){if(Object(i.b)(this.dataSources)){this.selectedDataSources=e,this.selectedEntity=t;for(let e=0;e<this.dataSources.length;e++)this.setData(this.dataSources[e],this.lastRec[this.dataSources[e]])}}getDataSourcesId(){let e=[];-1!==this.dataSourceId&&e.push(this.dataSourceId);for(let t=0;t<this.viewItems.length;t++){let s=this.viewItems[t];if(s.hasOwnProperty("layer")){let t=s.layer;e=e.concat(t.getDataSourcesIds())}}return e}reset(){}};var h=class extends c{constructor(e,t,s){super(e,t,s),this.layerIdToMarkers={},this.layerIdToPolylines={}}addMarkerToLayer(e,t){e.getId()in this.layerIdToMarkers||(this.layerIdToMarkers[e.getId()]={}),this.layerIdToMarkers[e.getId()][e.markerId]=t}addPolylineToLayer(e,t){e.getId()in this.layerIdToPolylines||(this.layerIdToPolylines[e.getId()]={}),this.layerIdToPolylines[e.getId()][e.polylineId]=t}getMarker(e){return e.getId()in this.layerIdToMarkers?this.layerIdToMarkers[e.getId()][e.markerId]:null}getMarkers(){const e=[];for(let t in this.layerIdToMarkers)for(let s in this.layerIdToMarkers[t])e.push(this.layerIdToMarkers[t][s]);return e}getPolylines(){const e=[];for(let t in this.layerIdToPolylines)for(let s in this.layerIdToPolylines[t])e.push(this.layerIdToPolylines[t][s]);return e}getPolyline(e){return e.getId()in this.layerIdToPolylines?this.layerIdToPolylines[e.getId()][e.polylineId]:null}getLayer(e){for(let t of this.layers)if(t.id===e)return t;return null}removeViewItem(e){super.removeViewItem(e),this.removeMarkers(e.layer),this.removePolylines(e.layer)}removeMarkers(e){if(Object(i.b)(e.markerId)){const t=this.layerIdToMarkers[e.id];if(Object(i.b)(t))for(let e in t){const s=t[e];this.removeMarkerFromLayer(s)}delete this.layerIdToMarkers[e.id]}}removePolylines(e){if(Object(i.b)(e.polylineId)){const t=this.layerIdToPolylines[e.id];if(Object(i.b)(t))for(let e in t){const s=t[e];this.removePolylineFromLayer(s)}delete this.layerIdToPolylines[e.id]}}removeMarkerFromLayer(e){}removePolylineFromLayer(e){}onMarkerLeftClick(e,t,s,r){Object(i.b)(s.onLeftClick)&&s.onLeftClick.call(s,e,t,r)}onMarkerRightClick(e,t,s,r){Object(i.b)(s.onRightClick)&&s.onRightClick.call(s,e,t,r)}onMarkerMove(e,t,s,r){Object(i.b)(s.onMove)&&s.onMove.call(s,e,t,r)}onMarkerHover(e,t,s,r){Object(i.b)(s.onHover)&&s.onHover.call(s,e,t,r)}getLayerId(e){const t=e.split("$");return Object(i.b)(t)&&2===t.length?t[0]:null}getMarkerId(e){if(!Object(i.b)(e))return null;const t=e.split("$");return Object(i.b)(t)&&2===t.length?t[1]:null}},u=s(153),m=s(214),y=s(220),p=s(221),I=s(123),b=s(215);s(170);t.a=class extends h{constructor(e,t,s){super(e,t,s);let r=document.getElementById(this.divId).className;document.getElementById(this.divId).setAttribute("class",r+" "+this.css),this.autoZoomOnFirstMarker=!1,Object(i.b)(s)&&Object(i.b)(s.autoZoomOnFirstMarker)&&(this.autoZoomOnFirstMarker=s.autoZoomOnFirstMarker)}beforeAddingItems(e){this.initMap(e)}initMap(e){this.INITIAL_VIEW_STATE={longitude:0,latitude:0,zoom:2,bearing:0,pitch:0};const t=document.createElement("canvas");if(t.setAttribute("id",Object(i.c)()),t.setAttribute("style","width:100%;height:100%;position:relative;"),document.getElementById(this.divId).appendChild(t),this.deckLayers=[],Object(i.b)(e)&&Object(i.b)(e.deckProps)&&Object(i.b)(e.deckProps.layers))for(let t=0;t<e.deckProps.layers.length;t++){const s=e.deckProps.layers[t].id?e.deckProps.layers[t].id:"base_"+s;this.deckLayers.push(e.deckProps.layers[t])}else this.deckLayers.push(new b.a({id:"base",data:"https://c.tile.openstreetmap.org/{z}/{x}/{y}.png",minZoom:0,maxZoom:19,tileSize:256,renderSubLayers:e=>{const{bbox:{west:t,south:s,east:i,north:r}}=e.tile;return new p.a(e,{data:null,image:e.data,bounds:[t,s,i,r]})}}));let s={canvas:t.id,width:"100%",height:"100%",controller:!0,views:[new u.a],initialViewState:this.INITIAL_VIEW_STATE,onViewStateChange:({viewState:e})=>{},layers:this.deckLayers};Object(i.b)(e)&&Object(i.b)(s)&&(s={...s,...e.deckProps}),this.INITIAL_VIEW_STATE=s.initialViewState,this.deckgl=new m.a(s)}updateMarker(e){const t=e.id+"$"+e.markerId,s=e.markerId,r=new y.a({id:t,data:[{position:[e.location.x,e.location.y]}],pickable:!0,iconAtlas:e.icon,iconMapping:{marker:{x:0,y:0,anchorX:e.iconAnchor[0],anchorY:e.iconAnchor[1],width:e.iconSize[0],height:e.iconSize[1],mask:"#000000"!==e.iconColor}},getIcon:e=>"marker",sizeScale:e.iconScale,getPosition:e=>e.position,getSize:t=>e.iconScale,getColor:t=>Object(i.a)(e.iconColor),onHover:(t,i)=>this.onMarkerHover(s,t,e,i),onClick:(t,i)=>i.leftButton?this.onMarkerLeftClick(s,t,e,i):this.onMarkerRightClick(s,t,e,i)});this.addMarkerToLayer(e,r);const a={};this.autoZoomOnFirstMarker&&(this.autoZoomOnFirstMarker=!1,a.initialViewState={...this.INITIAL_VIEW_STATE,longitude:e.location.x,latitude:e.location.y,zoom:e.zoomLevel}),this.render(a)}updateMarkers(e,t,s){}updatePolyline(e){const t=e.id+"$"+e.polylineId,s=e.locations[e.polylineId].map(e=>[e.x,e.y,e.z]),i=[{weight:e.weight,name:e.id,color:e.color,path:s}],r=new I.a({id:t,data:i,widthUnits:"pixels",widthMinPixels:5,getPath:e=>e.path,getColor:e=>e.color,getWidth:e=>e.weight});this.addPolylineToLayer(e,r),this.render({})}removeMarker(e){super.removeMarkers(e),this.render({})}removePolylines(e){super.removePolylines(e),this.render({})}render(e){const t=this.getMarkers(),s=this.getPolylines(),i={layers:[...this.deckLayers,...s,...t]};this.deckgl.setProps({...e,...i})}}},156:function(e,t,s){"use strict";var i=s(10),r=s(79),a=s(95);var n=class{constructor(e,t,s){this.id="DataSource-"+Object(i.c)(),this.name=e,this.properties={fetch:1,...t},this.dataSourceWorker=s,this.dataSynchronizer=null,this.currentRunningProperties={},this.initDataSource(t)}initDataSource(e){this.dataSourceWorker.postMessage({message:"init",id:this.id,properties:JSON.stringify(e),topic:r.a+this.id})}setDataSynchronizer(e){this.dataSynchronizer=e,this.dataSourceWorker.postMessage({message:"topic",topic:r.b+this.dataSynchronizer.id})}setTimeRange(e,t,s){this.updateUrl({...this.currentRunningProperties,startTime:e,endTime:t,replaySpeed:s})}getStartTime(){return this.properties.startTime}getEndTime(){return this.properties.endTime}getReplaySpeed(){return Object(i.b)(this.properties.replaySpeed)?this.properties.replaySpeed:1}disconnect(){this.dataSourceWorker.postMessage({message:"disconnect"})}onDisconnect(){return new Promise(e=>{new BroadcastChannel(r.a+this.id).onmessage=t=>{t.data.status===a.a.DISCONNECTED&&e()}})}async connect(){return this.dataSourceWorker.postMessage({message:"connect"}),this.isConnected()}async isConnected(){const e=new Promise(e=>{null!==this.dataSourceWorker&&(this.dataSourceWorker.onmessage=t=>{"is-connected"===t.data.message&&e(t.data.data)})});return null!==this.dataSourceWorker&&this.dataSourceWorker.postMessage({message:"is-connected"}),e}async getCurrentTime(){if(Object(i.b)(this.dataSynchronizer))return this.dataSynchronizer.getCurrentTime();{const e=new Promise(e=>{null!==this.dataSourceWorker&&(this.dataSourceWorker.onmessage=t=>{"last-timestamp"===t.data.message&&e(t.data.data)})});return null!==this.dataSourceWorker&&this.dataSourceWorker.postMessage({message:"last-timestamp"}),e}}getId(){return this.id}getName(){return this.name}updateUrl(e){this.currentRunningProperties={...this.properties,...e},null!==this.dataSourceWorker&&this.dataSourceWorker.postMessage({message:"update-url",data:e})}getCurrentRunningProperties(){return this.currentRunningProperties}terminate(){null!==this.dataSourceWorker&&this.dataSourceWorker.terminate()}},o=s(149),d=s.n(o);t.a=class extends n{constructor(e,t){super(e,{...t,protocol:"file"},new d.a)}}},168:function(e,t,s){var i=s(169);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,s(46).default)("6cba1d79",i,!1,{})},169:function(e,t,s){(t=s(44)(!1)).push([e.i,".osh-view {\n    width:100%;\n    height: 100%;\n}\n",""]),e.exports=t},170:function(e,t,s){var i=s(171);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,s(46).default)("93ae12fe",i,!1,{})},171:function(e,t,s){(t=s(44)(!1)).push([e.i,".osh-view > .deckgl-overlay {\n    position: relative !important;\n}\n",""]),e.exports=t},79:function(e,t,s){"use strict";s.d(t,"b",(function(){return i})),s.d(t,"a",(function(){return r}));const i="data-synchronizer-",r="datasource-data-"},95:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));const i={CONNECTED:"connected",DISCONNECTED:"disconnected"}}}]);