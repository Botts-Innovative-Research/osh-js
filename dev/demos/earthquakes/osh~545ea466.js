(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{10:function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return r})),i.d(t,"c",(function(){return a}));Math.pow(2,53);function s(e){return null!=e}function r(e){const[t,i,s]=e.match(/\w\w/g).map(e=>parseInt(e,16));return[t,i,s]}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}},147:function(e,t,i){"use strict";var s=i(10),r=i(87);t.a=class{constructor(e,t,i){this.id="DataSource-"+Object(s.c)(),this.name=e,this.properties={fetch:1,...t},this.dataSourceWorker=i,this.dataSynchronizer=null,this.currentRunningProperties={},this.initDataSource(t)}initDataSource(e){this.dataSourceWorker.postMessage({message:"init",id:this.id,properties:JSON.stringify(e),topic:r.a+this.id})}setDataSynchronizer(e){this.dataSynchronizer=e,this.dataSourceWorker.postMessage({message:"topic",topic:r.b+this.dataSynchronizer.id})}setTimeRange(e,t,i){this.updateUrl({...this.currentRunningProperties,startTime:e,endTime:t,replaySpeed:i})}getStartTime(){return this.properties.startTime}getEndTime(){return this.properties.endTime}getReplaySpeed(){return Object(s.b)(this.properties.replaySpeed)?this.properties.replaySpeed:1}disconnect(){this.dataSourceWorker.postMessage({message:"disconnect"})}async connect(){return this.dataSourceWorker.postMessage({message:"connect"}),this.isConnected()}async isConnected(){const e=new Promise(e=>{null!==this.dataSourceWorker&&(this.dataSourceWorker.onmessage=t=>{"is-connected"===t.data.message&&e(t.data.data)})});return null!==this.dataSourceWorker&&this.dataSourceWorker.postMessage({message:"is-connected"}),e}async getCurrentTime(){if(Object(s.b)(this.dataSynchronizer))return this.dataSynchronizer.getCurrentTime();{const e=new Promise(e=>{null!==this.dataSourceWorker&&(this.dataSourceWorker.onmessage=t=>{"last-timestamp"===t.data.message&&e(t.data.data)})});return null!==this.dataSourceWorker&&this.dataSourceWorker.postMessage({message:"last-timestamp"}),e}}getId(){return this.id}getName(){return this.name}updateUrl(e){this.currentRunningProperties={...this.properties,...e},null!==this.dataSourceWorker&&this.dataSourceWorker.postMessage({message:"update-url",data:e})}getCurrentRunningProperties(){return this.currentRunningProperties}terminate(){null!==this.dataSourceWorker&&this.dataSourceWorker.terminate()}}},155:function(e,t,i){"use strict";var s=i(10);const r=new class{constructor(){this.eventMap={}}remove(e,t){e in this.eventMap&&(this.eventMap[e]=this.eventMap[e].filter(e=>e.id!==t))}removeById(e){for(let t in this.eventMap)this.eventMap[t]=this.eventMap[t].filter(t=>t.id!==e)}observe(e,t,i="any"){Object(s.b)(e)&&Object(s.b)(t)&&Object(s.b)(i)&&(e in this.eventMap||(this.eventMap[e]=[]),this.eventMap[e].push({fn:t,id:i}))}fire(e,t){if(Object(s.b)(e)&&e in this.eventMap){let i=this.eventMap[e];for(let e=0;e<i.length;e++)i[e].fn(t)}}};var a=class{static remove(e,t="any"){r.remove("osh:"+e,t)}static removeById(e="any"){r.removeById(e)}static registerView(e){e.registerCallback()}static unregisterView(e){e.unregisterCallback()}static fire(e,t){t.name=e,r.fire("osh:"+e,t)}static observe(e,t,i="any"){r.observe("osh:"+e,t,i)}static observeDiv(e,t,i){document.getElementById(e).addEventListener(t,i)}static get EVENT(){return{SELECT_VIEW:"selectView",SHOW_VIEW:"showView",UAV_TAKEOFF:"uav:takeoff",UAV_GOTO:"uav:goto",UAV_LOOKAT:"uav:lookat",UAV_LAND:"uav:land",UAV_ORBIT:"uav:orbit",LOADING_START:"loading:start",LOADING_STOP:"loading:stop",ADD_VIEW_ITEM:"addViewItem",RESIZE:"resize",PTZ_SEND_REQUEST:"ptzSendRequest"}}},n=(i(168),i(87));const o="disconnected",d="data",l="status";var c=class{constructor(e,t,i){this.layers=[],this.viewItems=[],this.names={},this.lastRec={},this.selectedDataSources=[],this.dataSources=[],this.entity=null,this.id="view-"+Object(s.c)(),this.entity=null,this.dataSourceId=-1,Object(s.b)(i)&&Object(s.b)(i.dataSourceId)&&(this.dataSourceId=i.dataSourceId),Object(s.b)(i)&&Object(s.b)(i.entity)&&(this.entity=i.entity),this.css="",this.cssSelected="",Object(s.b)(i)&&Object(s.b)(i.css)&&(this.css=i.css),Object(s.b)(i)&&Object(s.b)(i.cssSelected)&&(this.cssSelected=i.cssSelected),this.init(e,t,i)}init(e,t,i){this.elementDiv=document.createElement("div"),this.elementDiv.setAttribute("id",this.id),this.elementDiv.setAttribute("class",this.css+" osh-view"),this.divId=this.id;let r=document.getElementById(e);if(Object(s.b)(r)&&null!==r?(r.appendChild(this.elementDiv),this.container=r):(document.body.appendChild(this.elementDiv),this.hide(),this.container=document.body),this.beforeAddingItems(i),Object(s.b)(t))for(let e=0;e<t.length;e++)this.addViewItem(t[e]);Object(s.b)(i)&&Object(s.b)(i.show)&&(document.getElementById(this.divId).style.display=i.show?"block":"none"),this.handleEvents();var a=this;this.registerCallback(),new MutationObserver(e=>{e.forEach((function(e){"style"===e.attributeName&&a.onResize()}))}).observe(this.elementDiv,{attributes:!0});new MutationObserver((function(e){Object(s.b)(document.getElementById(a.divId))||(this.disconnect(),a.destroy())})).observe(document.body,{childList:!0})}registerCallback(){if(Object(s.b)(this.dataSourceId)||Object(s.b)(this.entity)){const t=this;function e(e){new BroadcastChannel(n.a+e).onmessage=i=>{i.data.message&&"reset"===i.data.message?t.reset():i.data.type===d?t.setData(e,i.data.values):i.data.type===l&&i.data.status===o&&t.reset()}}if(null!==this.entity)for(let t of this.entity.getDataSources())e(t.id);else e(this.dataSourceId)}}unregisterCallback(){a.removeById(this.divId)}hide(){this.elementDiv.style.display="none"}onResize(){}attachTo(e){Object(s.b)(this.elementDiv.parentNode)&&this.elementDiv.parentNode.removeChild(this.elementDiv),document.getElementById(e).appendChild(this.elementDiv),"none"===this.elementDiv.style.display&&(this.elementDiv.style.display="block"),this.onResize()}beforeAddingItems(e){}getId(){return this.id}getDivId(){return this.divId}setData(e,t){}show(e){}destroy(){this.unregisterCallback()}addViewItem(e){if(this.viewItems.push(e),e.hasOwnProperty("layer")){let t=e.layer;this.layers.push(t),e.hasOwnProperty("name")&&(this.names[t.markerId]=e.name),t.viewItem=e,t.init(this);let i=t.getDataSourcesIds();for(let e=0;e<i.length;e++){const s=i[e];let r=this;new BroadcastChannel(n.a+s).onmessage=e=>{e.data.type===l&&e.data.status===o||e.data.type===d&&(t.setData(s,e.data,r),r.lastRec[s]=e.data)}}}}removeViewItem(e){if(this.viewItems.includes(e)){for(let t in e.layer.dataSourceToLayerMap)delete this.lastRec[t];this.viewItems=this.viewItems.filter(t=>t!==e)}this.layers=this.layers.filter(t=>t.id!==e.layer.id),delete this.names[e.layer.markerId]}removeViewItems(){for(const e of this.viewItems)this.removeViewItem(e)}handleEvents(){var e=this;a.observe(a.EVENT.SELECT_VIEW,t=>e.selectDataView(t.dataSourcesIds,t.entityId),this.divId),a.observe(a.EVENT.SHOW_VIEW,t=>e.show(t),this.divId),a.observe(a.EVENT.ADD_VIEW_ITEM,t=>{Object(s.b)(t.viewId)&&t.viewId===e.id&&e.addViewItem(t.viewItem)},this.divId),a.observe(a.EVENT.RESIZE+"-"+this.divId,t=>e.onResize(),this.divId)}selectDataView(e,t){if(Object(s.b)(this.dataSources)){this.selectedDataSources=e,this.selectedEntity=t;for(let e=0;e<this.dataSources.length;e++)this.setData(this.dataSources[e],this.lastRec[this.dataSources[e]])}}getDataSourcesId(){let e=[];-1!==this.dataSourceId&&e.push(this.dataSourceId);for(let t=0;t<this.viewItems.length;t++){let i=this.viewItems[t];if(i.hasOwnProperty("layer")){let t=i.layer;e=e.concat(t.getDataSourcesIds())}}return e}reset(){}};var h=class extends c{constructor(e,t,i){super(e,t,i),this.layerIdToMarkers={},this.layerIdToPolylines={}}addMarkerToLayer(e,t){e.getId()in this.layerIdToMarkers||(this.layerIdToMarkers[e.getId()]={}),this.layerIdToMarkers[e.getId()][e.markerId]=t}addPolylineToLayer(e,t){e.getId()in this.layerIdToPolylines||(this.layerIdToPolylines[e.getId()]={}),this.layerIdToPolylines[e.getId()][e.polylineId]=t}getMarker(e){return e.getId()in this.layerIdToMarkers?this.layerIdToMarkers[e.getId()][e.markerId]:null}getMarkers(){const e=[];for(let t in this.layerIdToMarkers)for(let i in this.layerIdToMarkers[t])e.push(this.layerIdToMarkers[t][i]);return e}getPolylines(){const e=[];for(let t in this.layerIdToPolylines)for(let i in this.layerIdToPolylines[t])e.push(this.layerIdToPolylines[t][i]);return e}getPolyline(e){return e.getId()in this.layerIdToPolylines?this.layerIdToPolylines[e.getId()][e.polylineId]:null}getLayer(e){for(let t of this.layers)if(t.id===e)return t;return null}removeViewItem(e){super.removeViewItem(e),this.removeMarkers(e.layer),this.removePolylines(e.layer)}removeMarkers(e){if(Object(s.b)(e.markerId)){const t=this.layerIdToMarkers[e.id];if(Object(s.b)(t))for(let e in t){const i=t[e];this.removeMarkerFromLayer(i)}delete this.layerIdToMarkers[e.id]}}removePolylines(e){if(Object(s.b)(e.polylineId)){const t=this.layerIdToPolylines[e.id];if(Object(s.b)(t))for(let e in t){const i=t[e];this.removePolylineFromLayer(i)}delete this.layerIdToPolylines[e.id]}}removeMarkerFromLayer(e){}removePolylineFromLayer(e){}onMarkerLeftClick(e,t,i,r){Object(s.b)(i.onLeftClick)&&i.onLeftClick.call(i,e,t,r)}onMarkerRightClick(e,t,i,r){Object(s.b)(i.onRightClick)&&i.onRightClick.call(i,e,t,r)}onMarkerMove(e,t,i,r){Object(s.b)(i.onMove)&&i.onMove.call(i,e,t,r)}onMarkerHover(e,t,i,r){Object(s.b)(i.onHover)&&i.onHover.call(i,e,t,r)}getLayerId(e){const t=e.split("$");return Object(s.b)(t)&&2===t.length?t[0]:null}getMarkerId(e){if(!Object(s.b)(e))return null;const t=e.split("$");return Object(s.b)(t)&&2===t.length?t[1]:null}},u=i(153),m=i(214),y=i(222),p=i(221),I=i(122),b=i(215);i(170);t.a=class extends h{constructor(e,t,i){super(e,t,i);let r=document.getElementById(this.divId).className;document.getElementById(this.divId).setAttribute("class",r+" "+this.css),this.autoZoomOnFirstMarker=!1,Object(s.b)(i)&&Object(s.b)(i.autoZoomOnFirstMarker)&&(this.autoZoomOnFirstMarker=i.autoZoomOnFirstMarker)}beforeAddingItems(e){this.initMap(e)}initMap(e){this.INITIAL_VIEW_STATE={longitude:0,latitude:0,zoom:2,bearing:0,pitch:0};const t=document.createElement("canvas");if(t.setAttribute("id",Object(s.c)()),t.setAttribute("style","width:100%;height:100%;position:relative;"),document.getElementById(this.divId).appendChild(t),this.deckLayers=[],Object(s.b)(e)&&Object(s.b)(e.deckProps)&&Object(s.b)(e.deckProps.layers))for(let t=0;t<e.deckProps.layers.length;t++){const i=e.deckProps.layers[t].id?e.deckProps.layers[t].id:"base_"+i;this.deckLayers.push(e.deckProps.layers[t])}else this.deckLayers.push(new b.a({id:"base",data:"https://c.tile.openstreetmap.org/{z}/{x}/{y}.png",minZoom:0,maxZoom:19,tileSize:256,renderSubLayers:e=>{const{bbox:{west:t,south:i,east:s,north:r}}=e.tile;return new p.a(e,{data:null,image:e.data,bounds:[t,i,s,r]})}}));let i={canvas:t.id,width:"100%",height:"100%",controller:!0,views:[new u.a],initialViewState:this.INITIAL_VIEW_STATE,onViewStateChange:({viewState:e})=>{},layers:this.deckLayers};Object(s.b)(e)&&Object(s.b)(i)&&(i={...i,...e.deckProps}),this.INITIAL_VIEW_STATE=i.initialViewState,this.deckgl=new m.a(i)}updateMarker(e){const t=e.id+"$"+e.markerId,i=e.markerId,r=new y.a({id:t,data:[{position:[e.location.x,e.location.y]}],pickable:!0,iconAtlas:e.icon,iconMapping:{marker:{x:0,y:0,anchorX:e.iconAnchor[0],anchorY:e.iconAnchor[1],width:e.iconSize[0],height:e.iconSize[1],mask:"#000000"!==e.iconColor}},getIcon:e=>"marker",sizeScale:e.iconScale,getPosition:e=>e.position,getSize:t=>e.iconScale,getColor:t=>Object(s.a)(e.iconColor),onHover:(t,s)=>this.onMarkerHover(i,t,e,s),onClick:(t,s)=>s.leftButton?this.onMarkerLeftClick(i,t,e,s):this.onMarkerRightClick(i,t,e,s)});this.addMarkerToLayer(e,r);const a={};this.autoZoomOnFirstMarker&&(this.autoZoomOnFirstMarker=!1,a.initialViewState={...this.INITIAL_VIEW_STATE,longitude:e.location.x,latitude:e.location.y,zoom:e.zoomLevel}),this.render(a)}updateMarkers(e,t,i){}updatePolyline(e){const t=e.id+"$"+e.polylineId,i=e.locations[e.polylineId].map(e=>[e.x,e.y,e.z]),s=[{weight:e.weight,name:e.id,color:e.color,path:i}],r=new I.a({id:t,data:s,widthUnits:"pixels",widthMinPixels:5,getPath:e=>e.path,getColor:e=>e.color,getWidth:e=>e.weight});this.addPolylineToLayer(e,r),this.render({})}removeMarker(e){super.removeMarkers(e),this.render({})}removePolylines(e){super.removePolylines(e),this.render({})}render(e){const t=this.getMarkers(),i=this.getPolylines(),s={layers:[...this.deckLayers,...i,...t]};this.deckgl.setProps({...e,...s})}}},168:function(e,t,i){var s=i(169);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,i(46).default)("6cba1d79",s,!1,{})},169:function(e,t,i){(t=i(44)(!1)).push([e.i,".osh-view {\n    width:100%;\n    height: 100%;\n}\n",""]),e.exports=t},170:function(e,t,i){var s=i(171);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,i(46).default)("93ae12fe",s,!1,{})},171:function(e,t,i){(t=i(44)(!1)).push([e.i,".osh-view > .deckgl-overlay {\n    position: relative !important;\n}\n",""]),e.exports=t},87:function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return r}));const s="data-synchronizer-",r="datasource-data-"}}]);