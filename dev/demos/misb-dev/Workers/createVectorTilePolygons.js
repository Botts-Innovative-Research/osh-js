define(["./AttributeCompression-212262a3","./Matrix2-92b7fb9d","./Color-0181dacd","./when-8166c7dd","./IndexDatatype-797210ca","./ComponentDatatype-9ed50558","./OrientedBoundingBox-ed23852c","./createTaskProcessorWorker","./RuntimeError-4fdc4459","./Transforms-62a339c3","./combine-a5c4cc47","./WebGLConstants-0664004c","./EllipsoidTangentPlane-5d8b4bd3","./AxisAlignedBoundingBox-b0cd1e39","./IntersectionTests-4f28a69c","./Plane-049255eb"],(function(e,a,n,r,t,i,o,s,d,f,c,u,h,l,g,p){"use strict";var b=new a.Cartesian3,m=new a.Ellipsoid,y=new a.Rectangle,v={min:void 0,max:void 0,indexBytesPerElement:void 0};var C=new a.Cartesian3,I=new a.Cartesian3,w=new a.Cartesian3,x=new a.Cartesian3,A=new a.Cartesian3,E=new a.Cartographic,N=new a.Rectangle;return s((function(s,d){var f;!function(e){var n=new Float64Array(e),r=0;v.indexBytesPerElement=n[r++],v.min=n[r++],v.max=n[r++],a.Cartesian3.unpack(n,r,b),r+=a.Cartesian3.packedLength,a.Ellipsoid.unpack(n,r,m),r+=a.Ellipsoid.packedLength,a.Rectangle.unpack(n,r,y)}(s.packedBuffer),f=2===v.indexBytesPerElement?new Uint16Array(s.indices):new Uint32Array(s.indices);var c,u,h,l=new Uint16Array(s.positions),g=new Uint32Array(s.counts),p=new Uint32Array(s.indexCounts),T=new Uint32Array(s.batchIds),B=new Uint32Array(s.batchTableColors),k=new Array(g.length),L=b,O=m,U=y,P=v.min,F=v.max,S=s.minimumHeights,D=s.maximumHeights;r.defined(S)&&r.defined(D)&&(S=new Float32Array(S),D=new Float32Array(D));var R=l.length/2,M=l.subarray(0,R),_=l.subarray(R,2*R);e.AttributeCompression.zigZagDeltaDecode(M,_);var G=new Float64Array(3*R);for(c=0;c<R;++c){var Y=M[c],V=_[c],H=i.CesiumMath.lerp(U.west,U.east,Y/32767),W=i.CesiumMath.lerp(U.south,U.north,V/32767),z=a.Cartographic.fromRadians(H,W,0,E),Z=O.cartographicToCartesian(z,C);a.Cartesian3.pack(Z,G,3*c)}var j=g.length,q=new Array(j),J=new Array(j),K=0,Q=0;for(c=0;c<j;++c)q[c]=K,J[c]=Q,K+=g[c],Q+=p[c];var X,$=new Float32Array(3*R*2),ee=new Uint16Array(2*R),ae=new Uint32Array(J.length),ne=new Uint32Array(p.length),re=[],te={};for(c=0;c<j;++c)h=B[c],r.defined(te[h])?(te[h].positionLength+=g[c],te[h].indexLength+=p[c],te[h].batchIds.push(c)):te[h]={positionLength:g[c],indexLength:p[c],offset:0,indexOffset:0,batchIds:[c]};var ie=0,oe=0;for(h in te)if(te.hasOwnProperty(h)){(X=te[h]).offset=ie,X.indexOffset=oe;var se=2*X.positionLength,de=2*X.indexLength+6*X.positionLength;ie+=se,oe+=de,X.indexLength=de}var fe=[];for(h in te)te.hasOwnProperty(h)&&(X=te[h],fe.push({color:n.Color.fromRgba(parseInt(h)),offset:X.indexOffset,count:X.indexLength,batchIds:X.batchIds}));for(c=0;c<j;++c){var ce=(X=te[h=B[c]]).offset,ue=3*ce,he=ce,le=q[c],ge=g[c],pe=T[c],be=P,me=F;r.defined(S)&&r.defined(D)&&(be=S[c],me=D[c]);var ye=Number.POSITIVE_INFINITY,ve=Number.NEGATIVE_INFINITY,Ce=Number.POSITIVE_INFINITY,Ie=Number.NEGATIVE_INFINITY;for(u=0;u<ge;++u){var we=a.Cartesian3.unpack(G,3*le+3*u,C);O.scaleToGeodeticSurface(we,we);var xe=O.cartesianToCartographic(we,E),Ae=xe.latitude,Ee=xe.longitude;ye=Math.min(Ae,ye),ve=Math.max(Ae,ve),Ce=Math.min(Ee,Ce),Ie=Math.max(Ee,Ie);var Ne=O.geodeticSurfaceNormal(we,I),Te=a.Cartesian3.multiplyByScalar(Ne,be,w),Be=a.Cartesian3.add(we,Te,x);Te=a.Cartesian3.multiplyByScalar(Ne,me,Te);var ke=a.Cartesian3.add(we,Te,A);a.Cartesian3.subtract(ke,L,ke),a.Cartesian3.subtract(Be,L,Be),a.Cartesian3.pack(ke,$,ue),a.Cartesian3.pack(Be,$,ue+3),ee[he]=pe,ee[he+1]=pe,ue+=6,he+=2}(U=N).west=Ce,U.east=Ie,U.south=ye,U.north=ve,k[c]=o.OrientedBoundingBox.fromRectangle(U,P,F,O);var Le=X.indexOffset,Oe=J[c],Ue=p[c];for(ae[c]=Le,u=0;u<Ue;u+=3){var Pe=f[Oe+u]-le,Fe=f[Oe+u+1]-le,Se=f[Oe+u+2]-le;re[Le++]=2*Pe+ce,re[Le++]=2*Fe+ce,re[Le++]=2*Se+ce,re[Le++]=2*Se+1+ce,re[Le++]=2*Fe+1+ce,re[Le++]=2*Pe+1+ce}for(u=0;u<ge;++u){var De=u,Re=(u+1)%ge;re[Le++]=2*De+1+ce,re[Le++]=2*Re+ce,re[Le++]=2*De+ce,re[Le++]=2*De+1+ce,re[Le++]=2*Re+1+ce,re[Le++]=2*Re+ce}X.offset+=2*ge,X.indexOffset=Le,ne[c]=Le-ae[c]}re=t.IndexDatatype.createTypedArray($.length/3,re);for(var Me=fe.length,_e=0;_e<Me;++_e){for(var Ge=fe[_e].batchIds,Ye=0,Ve=Ge.length,He=0;He<Ve;++He)Ye+=ne[Ge[He]];fe[_e].count=Ye}var We=function(e,a,r){var t=a.length,i=2+t*o.OrientedBoundingBox.packedLength+1+function(e){for(var a=e.length,r=0,t=0;t<a;++t)r+=n.Color.packedLength+3+e[t].batchIds.length;return r}(r),s=new Float64Array(i),d=0;s[d++]=e,s[d++]=t;for(var f=0;f<t;++f)o.OrientedBoundingBox.pack(a[f],s,d),d+=o.OrientedBoundingBox.packedLength;var c=r.length;s[d++]=c;for(var u=0;u<c;++u){var h=r[u];n.Color.pack(h.color,s,d),d+=n.Color.packedLength,s[d++]=h.offset,s[d++]=h.count;var l=h.batchIds,g=l.length;s[d++]=g;for(var p=0;p<g;++p)s[d++]=l[p]}return s}(2===re.BYTES_PER_ELEMENT?t.IndexDatatype.UNSIGNED_SHORT:t.IndexDatatype.UNSIGNED_INT,k,fe);return d.push($.buffer,re.buffer,ae.buffer,ne.buffer,ee.buffer,We.buffer),{positions:$.buffer,indices:re.buffer,indexOffsets:ae.buffer,indexCounts:ne.buffer,batchIds:ee.buffer,packedBuffer:We.buffer}}))}));