define(["./AttributeCompression-212262a3","./Transforms-62a339c3","./Matrix2-92b7fb9d","./when-8166c7dd","./TerrainEncoding-315b224c","./IndexDatatype-797210ca","./RuntimeError-4fdc4459","./ComponentDatatype-9ed50558","./OrientedBoundingBox-ed23852c","./createTaskProcessorWorker","./combine-a5c4cc47","./WebGLConstants-0664004c","./EllipsoidTangentPlane-5d8b4bd3","./AxisAlignedBoundingBox-b0cd1e39","./IntersectionTests-4f28a69c","./Plane-049255eb"],(function(e,i,t,n,r,s,h,u,o,d,p,a,f,l,c,g){"use strict";var m=function(e,i,t,r,s,u){if(!n.defined(e))throw new h.DeveloperError("threshold is required.");if(!n.defined(i))throw new h.DeveloperError("keepAbove is required.");if(!n.defined(t))throw new h.DeveloperError("u0 is required.");if(!n.defined(r))throw new h.DeveloperError("u1 is required.");if(!n.defined(s))throw new h.DeveloperError("u2 is required.");var o,d,p;n.defined(u)?u.length=0:u=[],i?(o=t<e,d=r<e,p=s<e):(o=t>e,d=r>e,p=s>e);var a,f,l,c,g,m,x=o+d+p;return 1===x?o?(a=(e-t)/(r-t),f=(e-t)/(s-t),u.push(1),u.push(2),1!==f&&(u.push(-1),u.push(0),u.push(2),u.push(f)),1!==a&&(u.push(-1),u.push(0),u.push(1),u.push(a))):d?(l=(e-r)/(s-r),c=(e-r)/(t-r),u.push(2),u.push(0),1!==c&&(u.push(-1),u.push(1),u.push(0),u.push(c)),1!==l&&(u.push(-1),u.push(1),u.push(2),u.push(l))):p&&(g=(e-s)/(t-s),m=(e-s)/(r-s),u.push(0),u.push(1),1!==m&&(u.push(-1),u.push(2),u.push(1),u.push(m)),1!==g&&(u.push(-1),u.push(2),u.push(0),u.push(g))):2===x?o||t===e?d||r===e?p||s===e||(f=(e-t)/(s-t),l=(e-r)/(s-r),u.push(2),u.push(-1),u.push(0),u.push(2),u.push(f),u.push(-1),u.push(1),u.push(2),u.push(l)):(m=(e-s)/(r-s),a=(e-t)/(r-t),u.push(1),u.push(-1),u.push(2),u.push(1),u.push(m),u.push(-1),u.push(0),u.push(1),u.push(a)):(c=(e-r)/(t-r),g=(e-s)/(t-s),u.push(0),u.push(-1),u.push(1),u.push(0),u.push(c),u.push(-1),u.push(2),u.push(0),u.push(g)):3!==x&&(u.push(0),u.push(1),u.push(2)),u},x=32767,v=16383,w=[],C=[],B=[],y=new t.Cartographic,I=new t.Cartesian3,b=[],E=[],A=[],z=[],M=[],N=new t.Cartesian3,V=new i.BoundingSphere,R=new o.OrientedBoundingBox,D=new t.Cartesian2,H=new t.Cartesian3;function T(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}T.prototype.clone=function(e){return n.defined(e)||(e=new T),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},T.prototype.initializeIndexed=function(e,i,t,n,r){this.uBuffer=e,this.vBuffer=i,this.heightBuffer=t,this.normalBuffer=n,this.index=r,this.first=void 0,this.second=void 0,this.ratio=void 0},T.prototype.initializeFromClipResult=function(e,i,t){var n=i+1;return-1!==e[i]?t[e[i]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=t[e[n]],++n,this.second=t[e[n]],++n,this.ratio=e[n],++n),n},T.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},T.prototype.isIndexed=function(){return n.defined(this.index)},T.prototype.getH=function(){return n.defined(this.index)?this.heightBuffer[this.index]:u.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},T.prototype.getU=function(){return n.defined(this.index)?this.uBuffer[this.index]:u.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},T.prototype.getV=function(){return n.defined(this.index)?this.vBuffer[this.index]:u.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var O=new t.Cartesian2,U=-1,F=[new t.Cartesian3,new t.Cartesian3],P=[new t.Cartesian3,new t.Cartesian3];function S(i,n){++U;var r=F[U],s=P[U];return r=e.AttributeCompression.octDecode(i.first.getNormalX(),i.first.getNormalY(),r),s=e.AttributeCompression.octDecode(i.second.getNormalX(),i.second.getNormalY(),s),I=t.Cartesian3.lerp(r,s,i.ratio,I),t.Cartesian3.normalize(I,I),e.AttributeCompression.octEncode(I,n),--U,n}T.prototype.getNormalX=function(){return n.defined(this.index)?this.normalBuffer[2*this.index]:(O=S(this,O)).x},T.prototype.getNormalY=function(){return n.defined(this.index)?this.normalBuffer[2*this.index+1]:(O=S(this,O)).y};var k=[];function q(e,i,t,r,s,h,u,o,d){if(0!==u.length){for(var p=0,a=0;a<u.length;)a=k[p++].initializeFromClipResult(u,a,o);for(var f=0;f<p;++f){var l=k[f];if(l.isIndexed())l.newIndex=h[l.index],l.uBuffer=e,l.vBuffer=i,l.heightBuffer=t,d&&(l.normalBuffer=r);else{var c=l.getKey();if(n.defined(h[c]))l.newIndex=h[c];else{var g=e.length;e.push(l.getU()),i.push(l.getV()),t.push(l.getH()),d&&(r.push(l.getNormalX()),r.push(l.getNormalY())),l.newIndex=g,h[c]=g}}}3===p?(s.push(k[0].newIndex),s.push(k[1].newIndex),s.push(k[2].newIndex)):4===p&&(s.push(k[0].newIndex),s.push(k[1].newIndex),s.push(k[2].newIndex),s.push(k[0].newIndex),s.push(k[2].newIndex),s.push(k[3].newIndex))}}return k.push(new T),k.push(new T),k.push(new T),k.push(new T),d((function(e,n){var h=e.isEastChild,d=e.isNorthChild,p=h?v:0,a=h?x:v,f=d?v:0,l=d?x:v,c=b,g=E,O=A,U=M;c.length=0,g.length=0,O.length=0,U.length=0;var F=z;F.length=0;var P={},S=e.vertices,k=e.indices;k=k.subarray(0,e.indexCountWithoutSkirts);var W,X,K,Y,L,_=r.TerrainEncoding.clone(e.encoding),G=_.hasVertexNormals,J=0,Z=e.vertexCountWithoutSkirts,j=e.minimumHeight,Q=e.maximumHeight,$=new Array(Z),ee=new Array(Z),ie=new Array(Z),te=G?new Array(2*Z):void 0;for(X=0,K=0;X<Z;++X,K+=2){var ne=_.decodeTextureCoordinates(S,X,D);if(W=_.decodeHeight(S,X),Y=u.CesiumMath.clamp(ne.x*x|0,0,x),L=u.CesiumMath.clamp(ne.y*x|0,0,x),ie[X]=u.CesiumMath.clamp((W-j)/(Q-j)*x|0,0,x),Y<20&&(Y=0),L<20&&(L=0),x-Y<20&&(Y=x),x-L<20&&(L=x),$[X]=Y,ee[X]=L,G){var re=_.getOctEncodedNormal(S,X,H);te[K]=re.x,te[K+1]=re.y}(h&&Y>=v||!h&&Y<=v)&&(d&&L>=v||!d&&L<=v)&&(P[X]=J,c.push(Y),g.push(L),O.push(ie[X]),G&&(U.push(te[K]),U.push(te[K+1])),++J)}var se=[];se.push(new T),se.push(new T),se.push(new T);var he,ue=[];for(ue.push(new T),ue.push(new T),ue.push(new T),X=0;X<k.length;X+=3){var oe=k[X],de=k[X+1],pe=k[X+2],ae=$[oe],fe=$[de],le=$[pe];se[0].initializeIndexed($,ee,ie,te,oe),se[1].initializeIndexed($,ee,ie,te,de),se[2].initializeIndexed($,ee,ie,te,pe);var ce=m(v,h,ae,fe,le,w);(he=0)>=ce.length||(he=ue[0].initializeFromClipResult(ce,he,se))>=ce.length||(he=ue[1].initializeFromClipResult(ce,he,se))>=ce.length||(he=ue[2].initializeFromClipResult(ce,he,se),q(c,g,O,U,F,P,m(v,d,ue[0].getV(),ue[1].getV(),ue[2].getV(),C),ue,G),he<ce.length&&(ue[2].clone(ue[1]),ue[2].initializeFromClipResult(ce,he,se),q(c,g,O,U,F,P,m(v,d,ue[0].getV(),ue[1].getV(),ue[2].getV(),C),ue,G)))}var ge=h?-32767:0,me=d?-32767:0,xe=[],ve=[],we=[],Ce=[],Be=Number.MAX_VALUE,ye=-Be,Ie=B;Ie.length=0;var be=t.Ellipsoid.clone(e.ellipsoid),Ee=t.Rectangle.clone(e.childRectangle),Ae=Ee.north,ze=Ee.south,Me=Ee.east,Ne=Ee.west;for(Me<Ne&&(Me+=u.CesiumMath.TWO_PI),X=0;X<c.length;++X)(Y=Math.round(c[X]))<=p?(xe.push(X),Y=0):Y>=a?(we.push(X),Y=x):Y=2*Y+ge,c[X]=Y,(L=Math.round(g[X]))<=f?(ve.push(X),L=0):L>=l?(Ce.push(X),L=x):L=2*L+me,g[X]=L,(W=u.CesiumMath.lerp(j,Q,O[X]/x))<Be&&(Be=W),W>ye&&(ye=W),O[X]=W,y.longitude=u.CesiumMath.lerp(Ne,Me,Y/x),y.latitude=u.CesiumMath.lerp(ze,Ae,L/x),y.height=W,be.cartographicToCartesian(y,I),Ie.push(I.x),Ie.push(I.y),Ie.push(I.z);var Ve=i.BoundingSphere.fromVertices(Ie,t.Cartesian3.ZERO,3,V),Re=o.OrientedBoundingBox.fromRectangle(Ee,Be,ye,be,R),De=new r.EllipsoidalOccluder(be).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(Ve.center,Ie,3,Ve.center,Be,N),He=ye-Be,Te=new Uint16Array(c.length+g.length+O.length);for(X=0;X<c.length;++X)Te[X]=c[X];var Oe=c.length;for(X=0;X<g.length;++X)Te[Oe+X]=g[X];for(Oe+=g.length,X=0;X<O.length;++X)Te[Oe+X]=x*(O[X]-Be)/He;var Ue,Fe=s.IndexDatatype.createTypedArray(c.length,F);if(G){var Pe=new Uint8Array(U);n.push(Te.buffer,Fe.buffer,Pe.buffer),Ue=Pe.buffer}else n.push(Te.buffer,Fe.buffer);return{vertices:Te.buffer,encodedNormals:Ue,indices:Fe.buffer,minimumHeight:Be,maximumHeight:ye,westIndices:xe,southIndices:ve,eastIndices:we,northIndices:Ce,boundingSphere:Ve,orientedBoundingBox:Re,horizonOcclusionPoint:De}}))}));