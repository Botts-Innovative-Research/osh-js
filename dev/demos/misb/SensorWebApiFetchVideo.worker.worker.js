!function(){"use strict";function e(e){return null!=e}function t(t,s="letiable"){if(!e(t))throw s+" must be defined";return t}function s(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}Math.pow(2,53);const r="disconnected",i="closed-error";var n=class{constructor(e,t){this.url=e,this.properties=t,this.id="DataConnector-"+s(),this.reconnectTimeout=12e4,this.status=r,this.reconnectionInterval=-1}checkAndClearReconnection(){-1!==this.reconnectionInterval&&(clearInterval(this.reconnectionInterval),this.reconnectionInterval=-1)}disconnect(){this.checkStatus(r),this.checkAndClearReconnection()}setUrl(e){this.url=e}getId(){return this.id}getUrl(){return this.url}setReconnectTimeout(e){this.reconnectTimeout=e}onReconnect(){return!0}connect(){}forceReconnect(){this.disconnect(),this.connect()}onChangeStatus(e){}checkStatus(e){e!==this.status&&(this.onChangeStatus(e),this.status=e)}onDisconnect(){}onConnect(){}},o=class extends n{constructor(e,t){super(e,t),this.interval=-1,this.lastReceiveTime=0}doRequest(t="",s){if(!this.init){let n=this.getUrl()+t;e(s)&&(n+="?"+s),this.closed=!1,this.init=!0,this.ws=new WebSocket(n),this.ws.binaryType="arraybuffer",this.checkStatus("connecting"),console.warn("WebSocket stream connecting"),this.ws.onopen=function(e){this.checkAndClearReconnection(),this.checkStatus("connected"),console.warn("WebSocket stream connected")}.bind(this),this.ws.onmessage=function(e){this.lastReceiveTime=Date.now(),e.data.byteLength>0&&this.onMessage(e.data)}.bind(this),this.ws.onerror=function(e){console.error("WebSocket stream error"),this.checkStatus(i),this.init=!1,this.lastReceiveTime=-1,this.createReconnection()}.bind(this),this.ws.onclose=e=>{console.warn("WebSocket stream closed: ",e.reason,e.code),1e3===e.code||this.closed?this.checkStatus(r):(this.checkStatus(i),this.createReconnection())},-1!==this.reconnectionInterval&&(clearInterval(this.reconnectionInterval),this.reconnectionInterval=-1)}}connect(){this.doRequest()}createReconnection(){!this.closed&&-1===this.reconnectionInterval&&this.onReconnect()&&(this.reconnectionInterval=setInterval(function(){let e=Date.now()-this.lastReceiveTime;(-1===this.lastReceiveTime||e>=this.reconnectTimeout)&&(console.warn("trying to reconnect",this.url),this.init=!1,this.connect())}.bind(this),this.reconnectTimeout))}disconnect(){super.disconnect(),this.init=!1,this.closed=!0,null!=this.ws&&this.ws.readyState!==WebSocket.CLOSED&&this.ws.close()}onMessage(e){}isConnected(){return null!=this.ws&&this.ws.readyState===WebSocket.OPEN}},a=class extends n{constructor(e){super(e),this.lastReceiveTime=-1,this.interval=-1,this.broadcastChannel=null}connect(){null===this.broadcastChannel&&(this.broadcastChannel=new BroadcastChannel(this.getUrl()),this.broadcastChannel.onmessage=e=>{this.lastReceiveTime=Date.now(),this.onMessage(e.data.data)},this.broadcastChannel.onerror=e=>{console.error("BroadcastChannel stream error: "+e),this.broadcastChannel.close(),this.init=!1,this.lastReceiveTime=-1,this.opened=!1},this.opened=!0,-1===this.interval&&(this.interval=setInterval(function(){let e=Date.now()-this.lastReceiveTime;(-1===this.lastReceiveTime||e>=this.reconnectTimeout)&&(console.warn(`trying to reconnect after ${this.reconnectTimeout} ..`),this.reconnect())}.bind(this),this.reconnectTimeout)))}disconnect(){this.fullDisconnect(!0)}fullDisconnect(e){null!=this.broadcastChannel&&(this.broadcastChannel.close(),this.broadcastChannel=null),e&&clearInterval(this.interval),this.opened=!1}reconnect(){this.onReconnect(),this.init&&this.fullDisconnect(!1),this.connect()}onMessage(e){}close(){this.disconnect()}isConnected(){return null!==this.broadcastChannel&&this.opened}};const c="data";var h=class extends n{constructor(t,s){super(t,s),this.method="POST",e(s)&&(s.method&&(this.method=s.method),s.headers&&(this.headers=s.headers))}async doRequest(t="",s,r){let i=this.getUrl()+t;e(s)&&(i+="?"+s);const n=fetch(i,{method:this.method,headers:this.headers}).then((function(e){return e.arrayBuffer()})),o=await n;return this.onMessage(o),o}onError(e){}onMessage(e){}disconnect(){}connect(){return this.doRequest()}isConnected(){return!1}},l=class{constructor(t){this.networkProperties=t,this._network={},this._network.info={connector:this.createInfoConnector({protocol:"http",tls:t.tls,endpointUrl:t.endpointUrl})},e(t.connector)?this._network.stream={connector:t.connector}:e(t.stream)&&(this._network.stream={connector:this.createStreamConnector(t)})}createInfoConnector(e){t(e.endpointUrl,"endpointUrl"),t(e.protocol,"protocol");let s=e.endpointUrl;s.endsWith("/")&&(s=s.substring(0,s.length-1));const r=e.tls?"s":"",i=e.protocol+r+"://"+s;if("http"===e.protocol)return new h(i,{responseType:e.responseFormat||"application/json",method:"GET"});if("mqtt"===e.protocol);else if("ws"===e.protocol)return new o(i)}createStreamConnector(e){t(e.endpointUrl,"endpointUrl"),t(e.stream,"stream");let s=e.endpointUrl;s.endsWith("/")&&(s=s.substring(0,s.length-1));const r=e.tls?"s":"",i=e.stream+r+"://"+s;if("http"===e.stream)return new h(i,{responseFormat:e.responseFormat||"application/json",responseType:e.responseType||"application/json",method:"GET"});if("mqtt"===e.stream);else if("ws"===e.stream)return new o(i)}setStreamProtocol(e,t="arraybuffer"){this._network.stream.connector.disconnect(),this._network.stream={connector:this.createStreamConnector({...this.networkProperties,stream:e,responseType:t})}}connect(){console.log(this._network.stream.connector),this._network.stream.connector.connect()}},p=class{constructor(e,t,s,r,i){this.url=e,this.filter=t,this.pageSize=s,this.parser=r,this.connector=i,this.nextOffset=0,this.parseData=[],this.init=!1,this.cursorPosition=0,this.total=0}hasNext(){return this.cursorPosition<=this.nextOffset||this.cursorPosition<this.parseData.length}async fetchData(){const e=await this.connector.doRequest(this.url,`${this.filter.toQueryString()}&offset=${this.nextOffset}&limit=${this.pageSize}`,this.filter.props.responseType);await this.onFetchData(e)}async onFetchData(e){await this.parseResponse(e)}async parseResponse(e){let t=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e)));for(let e=0;e<t.items.length;e++)this.parseData.push(await this.parser.parseData(t.items[e]));this.nextOffset=this.parseNextOffset(t)}parseNextOffset(t){const s=t.links;if(e(s))for(let e=0;e<s.length;e++)if("next"===s[e].rel){const t=new URL(s[e].href);return parseInt(t.searchParams.get("offset"))}return-1}async nextPage(e){(0===this.parseData.length||this.nextOffset>0&&(this.nextOffset>this.parseData.length||this.cursorPosition===this.nextOffset))&&await this.fetchData();const t=Math.min(this.cursorPosition+this.pageSize,this.parseData.length),s=this.parseData.slice(this.cursorPosition,t);return this.cursorPosition+=s.length,s}previousPage(e){this.cursorPosition=this.cursorPosition-this.pageSize;let t=this.pageSize;return this.cursorPosition<0&&(t=this.cursorPosition+this.pageSize,this.cursorPosition=0),this.parseData.slice(this.cursorPosition,this.cursorPosition+t)}hasPrevious(){return this.cursorPosition>0}},d=class{constructor(e){this.props=e}toQueryString(t=[]){let s="",r="";for(let i in this.props)(0===t.length||t.includes(i))&&e(this.props[i])&&(Array.isArray(this.props[i])?s+=r+i+"="+encodeURIComponent(this.props[i].join()):s+=r+i+"="+encodeURIComponent(this.props[i]),r="&");return s}},m=class extends d{constructor(e){super({q:void 0,bbox:void 0,location:void 0,observedProperty:void 0,featureOfInterest:void 0,select:void 0,format:"application/json",validTime:"1970-01-01T00:00:00Z/2055-01-01T00:00:00Z",phenomenonTime:"1970-01-01T00:00:00Z/2055-01-01T00:00:00Z",resultTime:"1970-01-01T00:00:00Z/2055-01-01T00:00:00Z",...e})}},u=class{buildUrl(t){let s="";if(s="service="+t.service,s+="&version=2.0&",t.responseFormat&&(s+="&responseFormat="+t.responseFormat),e(t.customUrlParams)&&Object.keys(t.customUrlParams).length>0){s+="&";for(let e in t.customUrlParams)s+=e+"="+t.customUrlParams[e]+"&";s.endsWith("&")&&(s=s.slice(0,-1))}return s}},f=class extends d{constructor(e){super({phenomenonTime:void 0,resultTime:void 0,featureOfInterest:void 0,select:void 0,bbox:void 0,location:void 0,format:"application/json",replaySpeed:void 0,...e})}},w={datastreams:{search:"/api/datastreams",by_id:"/api/datastreams/{id}",observations:"/api/datastreams/{id}/observations"},systems:{search:"/api/systems",by_id:"/api/systems/{id}",details:"/api/systems/{id}/details",fois:"/api/systems/{id}/featuresOfInterest",members:"/api/systems/{id}/members",datastreams:"/api/systems/{id}/datastreams",history:"/api/systems/{id}/history",history_ver:"/api/systems/{id}/history/{ver}"},observations:{search:"/api/observations",by_id:"/api/observations/{id}"},fois:{search:"/api/featuresOfInterest",by_id:"/api/featuresOfInterest/{id}"}},T=class extends u{buildUrl(t){let s=super.buildUrl(t);s+="&request=GetResult",s+="&offering="+t.offeringID,s+="&observedProperty="+t.observedProperty;const r=e(t.lastTimeStamp)?t.lastTimeStamp:t.startTime;return this.lastStartTime=t.startTime,s+="&temporalFilter=phenomenonTime,"+r+"/"+t.endTime,t.replaySpeed&&(s+="&replaySpeed="+t.replaySpeed),s}},y=class extends T{parseTimeStamp(e){let t=String.fromCharCode.apply(null,new Uint8Array(e));return new Date(JSON.parse(t).time).getTime()}parseData(e){let t=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e))),s={};for(let e in t)"time"!==e&&(s[e]=t[e]);return s}buildUrl(e){}},S=class extends T{parseTimeStamp(e){let t=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e)));return new Date(t.phenomenonTime).getTime()}parseData(e){return e instanceof ArrayBuffer?JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e))).result:e.result}buildUrl(e){}},g=class extends l{constructor(e,t){super(t),this.properties=e,this.parser=new S(t)}streamObservations(e=new f,t=function(){}){this._network.stream.connector.onMessage=t,this._network.stream.connector.doRequest(w.datastreams.observations.replace("{id}",this.properties.id),e.toQueryString(),"arraybuffer")}searchObservations(e=new f,t=10){return new p(w.datastreams.observations.replace("{id}",this.properties.id),e,t,this.parser,this._network.info.connector)}},b=class extends u{constructor(e){super(),this.networkProperties=e}parseData(e){return new g({id:e.id,name:e.name,system:e.system,validTime:e.validTime,phenomenonTime:e.phenomenonTime,resultTime:e.resultTime,observedProperties:e.observedProperties,formats:e.formats},{stream:"ws",...this.networkProperties})}parseTimeStamp(e){return 0}buildUrl(e){}},v=class extends l{constructor(e){super(e),this.parser=new b(e)}async searchDataStreams(e=new m,t=10){return new p(w.datastreams.search,e,t,this.parser,this._network.info.connector)}async getDataStreamById(e,t=new m){const s=await this._network.info.connector.doRequest(w.datastreams.by_id.replace("{id}",e),t.toQueryString(["select","format"]),t.props.format);return this.parser.parseData(s)}},x=class extends d{constructor(e){super({q:void 0,bbox:void 0,location:void 0,parent:void 0,select:void 0,format:"application/json",validTime:"1970-01-01T00:00:00Z/2055-01-01T00:00:00Z",...e})}},P=class extends d{constructor(e){super({q:void 0,bbox:void 0,location:void 0,validTime:"1970-01-01T00:00:00Z/2055-01-01T00:00:00Z",parent:void 0,select:void 0,featureOfInterest:void 0,format:"application/json",...e})}},C=class extends l{constructor(e,t){super(t),this.properties=e}},I=class extends u{constructor(e){super(),this.networkProperties=e}parseData(e){return new C({id:e.id,type:e.type,geometry:e.geometry||void 0,bbox:e.bbox||void 0,properties:e.properties},this.networkProperties)}parseTimeStamp(e){return 0}buildUrl(e){}},k=class extends l{constructor(e,t){super(t),this.properties=e,this.systemParser=new O(t),this.dataStreamParser=new b(t),this.featureOfInterestParser=new I(t)}async getDetails(e=new x){return this._network.info.connector.doRequest(w.systems.details.replace("{id}",this.properties.id),e.toQueryString(["select","format"]),e.props.format)}async searchSubSystems(e=new x,t=10){return e.props.parent=this.properties.id,new p(w.systems.search,e,t,this.systemParser,this._network.info.connector)}async searchDataStreams(e=new m,t=10){return new p(w.systems.datastreams.replace("{id}",this.properties.id),e,t,this.dataStreamParser,this._network.info.connector)}async searchFeaturesOfInterest(e=new P,t=10){return new p(w.systems.fois.replace("{id}",this.properties.id),e,t,this.featureOfInterestParser,this._network.info.connector)}},O=class extends u{constructor(e){super(),this.networkProperties=e}parseData(e){return new k({id:e.id,type:e.type,...e.properties},this.networkProperties)}parseTimeStamp(e){return 0}buildUrl(e){}},D=class extends l{constructor(e){super(e),this.parser=new O(e)}async searchSystems(e=new x,t=10){return new p(w.systems.search,e,t,this.parser,this._network.info.connector)}async getSystemById(e,t=new x){const s=await this._network.info.connector.doRequest(w.systems.by_id.replace("{id}",e),t.toQueryString(["select","format"]),t.props.format);return this.parser.parseData(s)}},R=class extends l{constructor(e){super(e),this.parser=new b(e)}async searchFeaturesOfInterest(e=new P,t=10){return new p("/featuresOfInterest",e,t,this.parser,this._network.info.connector)}async getFeatureOfInterestById(e,t=new P){const s=await this._network.info.connector.doRequest(`/featuresOfInterest/${e}`,t.toQueryString(["select","format"],t.props.format));return this.parser.parseData(s)}},U=class extends l{constructor(e,t){super(t),this.properties=e}},F=class extends u{constructor(e){super(),this.networkProperties=e}parseData(e){return new U({id:e.id,datastreamId:e.datastreamId,foiId:e.foiId,phenomenonTime:e.phenomenonTime,resultTime:e.resultTime,result:e.result},this.networkProperties)}parseTimeStamp(e){return 0}buildUrl(e){}},_=class extends l{constructor(e){super(e),this.parser=new F(e)}async searchObservations(e=new f,t=10){return new p("/observations",e,t,this.parser,this._network.info.connector)}async getObservationById(e,t=new f){const s=await this._network.info.connector.doRequest(`/observations/${e}`,t.toQueryString(["select","format"],t.props.format));return this.parser.parseData(s)}},M=class extends T{parseTimeStamp(e){return 1e3*new DataView(e).getFloat64(0,!1)}parseData(e){return{frameData:new Uint8Array(e,12,e.byteLength-12),roll:0}}buildUrl(e){return super.buildUrl(e)}},z=class extends M{buildUrl(e){let t=super.buildUrl(e);return e.foiId&&""!==e.of&&(t+="&featureOfInterest="+e.foiId),t}};let A=new class extends class extends class{constructor(e,t){this.parser=e,this.connector=null,this.reconnectTimeout=1e4,this.values=[],this.version=-Number.MAX_SAFE_INTEGER,this.id=s(),this.initialized=!1}init(e,t,s){this.dataSourceId=s,null!==this.connector&&(this.connector.disconnect(),this.connector=null),this.setTopic(t);const r=e;this.handleProperties(r),this.createDataConnector(this.properties),this.initialized=!0}handleProperties(t){e(t.bufferingTime)&&(this.bufferingTime=t.bufferingTime),e(t.timeOut)&&(this.timeOut=t.timeOut),e(t.reconnectTimeout)&&(this.reconnectTimeout=t.reconnectTimeout),this.properties=t}async createDataConnector(t,s){this.updatedProperties=t;const r=t.tls?"s":"",i=t.protocol+r+"://"+t.endpointUrl;e(s)?this.connector=s:t.protocol.startsWith("ws")?this.connector=new o(i):t.protocol.startsWith("http")?this.connector=new h(i,{responseType:t.responseType||"arraybuffer",method:"GET"}):"topic"===t.protocol&&(this.connector=new a(i)),await this.setUpConnector(t)}async setUpConnector(e){null!==this.connector&&(this.connector.setReconnectTimeout(this.reconnectTimeout),this.connector.onMessage=this.onMessage.bind(this),this.connector.onChangeStatus=this.onChangeStatus.bind(this),await this.updateAferCreatingConnector(e))}async updateAferCreatingConnector(e){}setTopic(t){this.topic!==t&&(e(this.broadcastChannel)&&(console.warn(`Replace old topic ${this.topic} by ${t}`),this.broadcastChannel.close()),this.broadcastChannel=new BroadcastChannel(t),this.topic=t)}connect(){null!==this.connector&&this.connector.doRequest("",this.parser.buildUrl(this.updatedProperties))}disconnect(){null!==this.connector&&this.connector.disconnect()}async onMessage(t){const s=await Promise.resolve(this.parser.parseData(t));if(Array.isArray(s))for(let t=0;t<s.length;t++)this.values.push({data:s[t],version:this.version}),e(this.batchSize)&&this.values.length>=this.batchSize&&this.flush();else this.values.push({data:s,version:this.version});this.isConnected()?e(this.batchSize)&&0!==this.values.length&&this.values.length>=this.batchSize&&this.flush():this.flushAll()}onChangeStatus(e){e===r&&this.flushAll(),this.broadcastChannel.postMessage({type:"status",status:e,dataSourceId:this.dataSourceId})}updateProperties(e){this.disconnect(),this.createDataConnector({...this.properties,...e}),this.version++,this.connect()}flushAll(){for(;this.values.length>0;)this.flush()}flush(){let t=this.values.length;e(this.batchSize)&&this.values.length>this.batchSize&&(t=this.batchSize),this.broadcastChannel.postMessage({dataSourceId:this.dataSourceId,type:c,values:this.values.splice(0,t)})}isConnected(){return null!==this.connector&&this.connector.isConnected()}handleMessage(e,t){let s;if("init"===e.message)this.initialized||this.init(e.properties,e.topic,e.id),s=this.initialized;else if("connect"===e.message)this.connect();else if("disconnect"===e.message)this.disconnect();else if("topic"===e.message)this.setTopic(e.topic);else if("update-url"===e.message)this.updateProperties(e.data);else if("is-connected"===e.message)s=this.isConnected();else{if("is-init"!==e.message)return;s=this.initialized}t.postMessage({message:e.message,data:s,messageId:e.messageId})}}{constructor(e){super(e),this.lastTimeStamp=null,this.lastStartTime="now",this.timeShift=0,this.timeBroadcastChannel=null}async createDataConnector(t,s){super.createDataConnector({...t,timeShift:this.timeShift},s);const r=this.parser&&this.parser.lastStartTime||t.startTime;this.connector.onReconnect=()=>("now"!==r&&this.connector.setUrl(this.parser.buildUrl({...t,lastTimeStamp:e(this.lastTimeStamp)?new Date(this.lastTimeStamp).toISOString():t.startTime})),!0)}handleProperties(t){super.handleProperties(t),e(t.timeShift)&&(this.timeShift=t.timeShift),"now"===t.startTime?this.batchSize=1:(e(t.replaySpeed)&&(e(t.batchSize)||(this.batchSize=1)),e(t.batchSize)&&(this.batchSize=t.batchSize))}async onMessage(t){const s=await Promise.resolve(this.parser.parseTimeStamp(t)+this.timeShift),r=await Promise.resolve(this.parser.parseData(t));if(Array.isArray(r))for(let e=0;e<r.length;e++)this.values.push({data:r[e],timeStamp:s,version:this.version});else this.values.push({data:r,timeStamp:s,version:this.version});this.lastTimeStamp=s,("now"===this.parser.lastStartTime||e(this.batchSize)&&this.values.length>=this.batchSize)&&(this.flush(),null!==this.timeBroadcastChannel&&this.timeBroadcastChannel.postMessage({timestamp:this.lastTimeStamp,type:"time"}))}getLastTimeStamp(){return this.lastTimeStamp}async updateProperties(t){try{this.disconnect(),this.timeBroadcastChannel.postMessage({dataSourceId:this.dataSourceId,type:"time-changed"});let s=new Date(this.lastTimeStamp).toISOString();t.hasOwnProperty("startTime")?s=t.startTime:"now"===this.properties.startTime&&(s="now"),this.version++,await this.createDataConnector({...this.properties,...t,lastTimeStamp:s}),e(t)&&e(t.reconnect)&&t.reconnect&&this.connect()}catch(e){console.error(e)}}handleMessage(e,t){let s;if(super.handleMessage(e,t),"last-timestamp"===e.message)s=this.getLastTimeStamp();else{if("topic"!==e.message)return;this.setTimeTopic(e.timeTopic)}t.postMessage({message:e.message,data:s,messageId:e.messageId})}setTimeTopic(e){this.timeTopic!==e&&(null!==this.timeBroadcastChannel&&(console.warn(`Replace old topic ${this.timeTopic} by ${e}`),this.timeBroadcastChannel.close()),this.timeBroadcastChannel=new BroadcastChannel(e),this.timeTopic=e)}}{constructor(e){super(e)}async updateAferCreatingConnector(t){const s={...t,connector:this.connector};let r,i,n="mqtt"===this.properties.protocol||"ws"===this.properties.protocol;if("/systems"===this.properties.collection)i=this.createSystemFilter(t),r=new D(s).searchSystems(i,t.batchSize),n=!1,e(this.parser)||(this.parser=new y);else if("/fois"===this.properties.collection)i=this.createFeatureOfInterestFilter(t),r=new R(s).searchFeaturesOfInterest(i,t.batchSize),n=!1,e(this.parser)||(this.parser=new y);else if(this.properties.collection.startsWith("/datastreams")){i=this.createDataStreamFilter(t);const o=new RegExp("\\/(.*\\/)(.*)\\/observations");if(o.test(this.properties.collection)){i=this.createObservationFilter(t);const a=o.exec(this.properties.collection);let c=new g({id:a[2]},s);n?this.streamObject=c:r=c.searchObservations(i,t.batchSize),e(this.parser)||(this.parser=new S)}else r=new v(s).searchDataStreams(i,t.batchSize),e(this.parser)||(this.parser=new y)}else"/observations"===this.properties.collection&&(r=new _(s).searchObservations(),n=!1,e(this.parser)||(this.parser=new y));n?await this.setupStream(r):await this.setupNonStream(r),this.filter=i}async setupStream(e){this.connect=this.connectStream}async setupNonStream(e){this.collection=await e,this.onMessage=this.onMessageNonStream}async connectStream(){this.streamObject.streamObservations(this.filter,this.onMessage.bind(this))}async connect(){if(e(this.collection))for(;this.collection.hasNext();){const e=await this.collection.nextPage();await this.onMessage(e)}}onMessageNonStream(e){this.broadcastChannel.postMessage({dataSourceId:this.dataSourceId,type:c,values:[...e]})}createSystemFilter(t){const s={};return e(t.keywords)&&(s.q=t.keywords),e(t.roi)&&(s.location=s.roi),e(t.parentId)&&(s.parent=t.parentId),e(t.responseFormat)&&(s.format=t.responseFormat),e(t.validTime)&&(s.validTime=t.validTime),e(t.phenomenonTime)&&e(t.startTime)&&(s.phenomenonTime=t.startTime+"/"+t.endTime),e(t.resultTime)&&(s.resultTime=t.resultTime),e(t.excludedProps)&&(s.select=t.excludedProps.map((e=>"!"+e))),e(t.includedProps)&&(e(s.select)||(s.select=[]),s.select.concat(t.includedProps)),new x(s)}createFeatureOfInterestFilter(t){const s={};return e(t.keywords)&&(s.q=t.keywords),e(t.roi)&&(s.location=s.roi),e(t.parentId)&&(s.parent=t.parentId),e(t.responseFormat)&&(s.format=t.responseFormat),e(t.validTime)&&(s.validTime=t.validTime),e(t.phenomenonTime)&&e(t.startTime)&&(s.phenomenonTime=t.startTime+"/"+t.endTime),e(t.resultTime)&&(s.resultTime=t.resultTime),e(t.excludedProps)&&(s.select=t.excludedProps.map((e=>"!"+e))),e(t.includedProps)&&(e(s.select)||(s.select=[]),s.select.concat(t.includedProps)),new P(s)}createObservationFilter(t){const s={};return e(t.roi)&&(s.location=s.roi),e(t.responseFormat)&&(s.format=t.responseFormat),e(t.replaySpeed)&&(s.replaySpeed=t.replaySpeed),e(t.startTime)&&(s.phenomenonTime=t.startTime+"/"+t.endTime),e(t.resultTime)&&(s.resultTime=t.resultTime),e(t.resultTime)&&(s.resultTime=t.resultTime),e(t.featureOfInterest)&&(s.featureOfInterest=t.featureOfInterest),e(t.excludedProps)&&(s.select=t.excludedProps.map((e=>"!"+e))),e(t.includedProps)&&(e(s.select)||(s.select=[]),s.select.concat(t.includedProps)),new f(s)}createDataStreamFilter(t){const s={};return e(t.keywords)&&(s.q=t.keywords),e(t.roi)&&(s.location=s.roi),e(t.responseFormat)&&(s.format=t.responseFormat),e(t.phenomenonTime)&&e(t.startTime)&&(s.phenomenonTime=t.startTime+"/"+t.endTime),e(t.resultTime)&&(s.resultTime=t.resultTime),e(t.observedProperty)&&(s.observedProperty=t.observedProperty),e(t.featureOfInterest)&&(s.featureOfInterest=t.featureOfInterest),e(t.excludedProps)&&(s.select=t.excludedProps.map((e=>"!"+e))),e(t.includedProps)&&(e(s.select)||(s.select=[]),s.select.concat(t.includedProps)),new m(s)}}(new class extends z{});self.onmessage=e=>{A.handleMessage(e.data,self)}}();