define(["./arrayRemoveDuplicates-198208a4","./BoundingRectangle-ab1365ab","./Transforms-62a339c3","./Matrix2-92b7fb9d","./RuntimeError-4fdc4459","./ComponentDatatype-9ed50558","./CoplanarPolygonGeometryLibrary-ce606f0c","./when-8166c7dd","./GeometryAttribute-6f4c3b93","./GeometryAttributes-50becc99","./GeometryInstance-c790ce17","./GeometryPipeline-54fb0bb4","./IndexDatatype-797210ca","./PolygonGeometryLibrary-e5495823","./PolygonPipeline-7fb6627c","./VertexFormat-c0801687","./combine-a5c4cc47","./WebGLConstants-0664004c","./OrientedBoundingBox-ed23852c","./EllipsoidTangentPlane-5d8b4bd3","./AxisAlignedBoundingBox-b0cd1e39","./IntersectionTests-4f28a69c","./Plane-049255eb","./AttributeCompression-212262a3","./EncodedCartesian3-4a314cb8","./ArcType-13a53523","./EllipsoidRhumbLine-51654311"],(function(e,t,n,a,r,o,i,s,l,p,c,y,u,m,d,g,b,h,v,f,C,x,P,A,w,F,G){"use strict";var L=new a.Cartesian3,E=new t.BoundingRectangle,T=new a.Cartesian2,k=new a.Cartesian2,D=new a.Cartesian3,_=new a.Cartesian3,V=new a.Cartesian3,R=new a.Cartesian3,I=new a.Cartesian3,M=new a.Cartesian3,B=new n.Quaternion,H=new a.Matrix3,O=new a.Matrix3,z=new a.Cartesian3;function S(e,t,r,i,s,c,y,m){var g=e.positions,b=d.PolygonPipeline.triangulate(e.positions2D,e.holes);b.length<3&&(b=[0,1,2]);var h=u.IndexDatatype.createTypedArray(g.length,b.length);h.set(b);var v=H;if(0!==i){var f=n.Quaternion.fromAxisAngle(c,i,B);if(v=a.Matrix3.fromQuaternion(f,v),t.tangent||t.bitangent){f=n.Quaternion.fromAxisAngle(c,-i,B);var C=a.Matrix3.fromQuaternion(f,O);y=a.Cartesian3.normalize(a.Matrix3.multiplyByVector(C,y,y),y),t.bitangent&&(m=a.Cartesian3.normalize(a.Cartesian3.cross(c,y,m),m))}}else v=a.Matrix3.clone(a.Matrix3.IDENTITY,v);var x=k;t.st&&(x.x=r.x,x.y=r.y);for(var P=g.length,A=3*P,w=new Float64Array(A),F=t.normal?new Float32Array(A):void 0,G=t.tangent?new Float32Array(A):void 0,E=t.bitangent?new Float32Array(A):void 0,D=t.st?new Float32Array(2*P):void 0,_=0,V=0,R=0,I=0,M=0,z=0;z<P;z++){var S=g[z];if(w[_++]=S.x,w[_++]=S.y,w[_++]=S.z,t.st){var N=s(a.Matrix3.multiplyByVector(v,S,L),T);a.Cartesian2.subtract(N,x,N);var Q=o.CesiumMath.clamp(N.x/r.width,0,1),j=o.CesiumMath.clamp(N.y/r.height,0,1);D[M++]=Q,D[M++]=j}t.normal&&(F[V++]=c.x,F[V++]=c.y,F[V++]=c.z),t.tangent&&(G[I++]=y.x,G[I++]=y.y,G[I++]=y.z),t.bitangent&&(E[R++]=m.x,E[R++]=m.y,E[R++]=m.z)}var U=new p.GeometryAttributes;return t.position&&(U.position=new l.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:w})),t.normal&&(U.normal=new l.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:F})),t.tangent&&(U.tangent=new l.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),t.bitangent&&(U.bitangent=new l.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E})),t.st&&(U.st=new l.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:D})),new l.Geometry({attributes:U,indices:h,primitiveType:l.PrimitiveType.TRIANGLES})}function N(e){var t=(e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT)).polygonHierarchy;r.Check.defined("options.polygonHierarchy",t);var n=s.defaultValue(e.vertexFormat,g.VertexFormat.DEFAULT);this._vertexFormat=g.VertexFormat.clone(n),this._polygonHierarchy=t,this._stRotation=s.defaultValue(e.stRotation,0),this._ellipsoid=a.Ellipsoid.clone(s.defaultValue(e.ellipsoid,a.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=m.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+g.VertexFormat.packedLength+a.Ellipsoid.packedLength+2}N.fromPositions=function(e){return e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT),r.Check.defined("options.positions",e.positions),new N({polygonHierarchy:{positions:e.positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},N.pack=function(e,t,n){return r.Check.typeOf.object("value",e),r.Check.defined("array",t),n=s.defaultValue(n,0),n=m.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,n),a.Ellipsoid.pack(e._ellipsoid,t,n),n+=a.Ellipsoid.packedLength,g.VertexFormat.pack(e._vertexFormat,t,n),n+=g.VertexFormat.packedLength,t[n++]=e._stRotation,t[n]=e.packedLength,t};var Q=a.Ellipsoid.clone(a.Ellipsoid.UNIT_SPHERE),j=new g.VertexFormat,U={polygonHierarchy:{}};return N.unpack=function(e,t,n){r.Check.defined("array",e),t=s.defaultValue(t,0);var o=m.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=o.startingIndex,delete o.startingIndex;var i=a.Ellipsoid.unpack(e,t,Q);t+=a.Ellipsoid.packedLength;var l=g.VertexFormat.unpack(e,t,j);t+=g.VertexFormat.packedLength;var p=e[t++],c=e[t];return s.defined(n)||(n=new N(U)),n._polygonHierarchy=o,n._ellipsoid=a.Ellipsoid.clone(i,n._ellipsoid),n._vertexFormat=g.VertexFormat.clone(l,n._vertexFormat),n._stRotation=p,n.packedLength=c,n},N.createGeometry=function(t){var r=t._vertexFormat,s=t._polygonHierarchy,p=t._stRotation,d=s.positions;if(!((d=e.arrayRemoveDuplicates(d,a.Cartesian3.equalsEpsilon,!0)).length<3)){var g=D,b=_,h=V,v=I,f=M;if(i.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(d,R,v,f)){if(g=a.Cartesian3.cross(v,f,g),g=a.Cartesian3.normalize(g,g),!a.Cartesian3.equalsEpsilon(R,a.Cartesian3.ZERO,o.CesiumMath.EPSILON6)){var C=t._ellipsoid.geodeticSurfaceNormal(R,z);a.Cartesian3.dot(g,C)<0&&(g=a.Cartesian3.negate(g,g),v=a.Cartesian3.negate(v,v))}var x=i.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(R,v,f),P=i.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(R,v,f);r.tangent&&(b=a.Cartesian3.clone(v,b)),r.bitangent&&(h=a.Cartesian3.clone(f,h));var A=m.PolygonGeometryLibrary.polygonsFromHierarchy(s,x,!1),w=A.hierarchy,F=A.polygons;if(0!==w.length){d=w[0].outerRing;for(var G=n.BoundingSphere.fromPoints(d),L=m.PolygonGeometryLibrary.computeBoundingRectangle(g,P,d,p,E),T=[],k=0;k<F.length;k++){var B=new c.GeometryInstance({geometry:S(F[k],r,L,p,P,g,b,h)});T.push(B)}var H=y.GeometryPipeline.combineInstances(T)[0];H.attributes.position.values=new Float64Array(H.attributes.position.values),H.indices=u.IndexDatatype.createTypedArray(H.attributes.position.values.length/3,H.indices);var O=H.attributes;return r.position||delete O.position,new l.Geometry({attributes:O,indices:H.indices,primitiveType:H.primitiveType,boundingSphere:G})}}}},function(e,t){return s.defined(t)&&(e=N.unpack(e,t)),N.createGeometry(e)}}));