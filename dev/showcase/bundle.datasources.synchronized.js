!function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=4)}([function(e,t,i){e.exports=function(){return new Worker(i.p+"WorkerName.d24f0b97e0fa1688214a.js")}},function(e,t,i){e.exports=function(){return new Worker(i.p+"WorkerName.4080b64c659b90da1edd.js")}},function(e,t,i){e.exports=function(){return new Worker(i.p+"WorkerName.67220eaed0489609a22d.js")}},function(e,t,i){e.exports=function(){return new Worker(i.p+"WorkerName.050bb054eeb311b472fd.js")}},function(e,t,i){"use strict";i.r(t);const s=document.getElementById("datasource-gps"),r=document.getElementById("datasource-orientation"),n=document.getElementById("datasource-video"),a=document.getElementById("error"),o=document.getElementById("last-gps"),c=document.getElementById("last-orient"),p=document.getElementById("last-video"),u=document.getElementById("current-time");let d=0;const h="data",m="time";Math.pow(2,53);function l(e){return null!=e}function g(e,t="letiable"){if(!l(e))throw t+" must be defined";return e}function S(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}var y=class{constructor(e,t){this.id="DataSource-"+S(),this.name=e,this.properties=t,this.currentRunningProperties={},this.eventSubscriptionMap={},this.initialized=!1,this.init=void 0,this.messagesMap={}}getId(){return this.id}getName(){return this.name}getCurrentRunningProperties(){return this.currentRunningProperties}terminate(){null!==this.dataSourceWorker&&this.dataSourceWorker.terminate()}getTopicId(){return"datasource-data-"+this.id}getVersion(){return 0}subscribe(e,t){for(let i=0;i<t.length;i++)t[i]in this.eventSubscriptionMap||(this.eventSubscriptionMap[t[i]]=[]),this.eventSubscriptionMap[t[i]].push(e)}async createWorker(e){}async updateProperties(e){return this.currentRunningProperties={...this.properties,...e},new Promise(t=>{this.postMessage({message:"update-url",data:e},t)})}async connect(){await this.checkInit(),await this.doConnect()}async initDataSource(){return new Promise(async e=>{this.dataSourceWorker=await this.createWorker(this.properties),this.handleWorkerMessage(),this.postMessage({message:"init",id:this.id,properties:this.properties,topic:this.getTopicId()},function(t){new BroadcastChannel(this.getTopicId()).onmessage=e=>{const t=e.data.type;if(t in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[t].length;i++)this.eventSubscriptionMap[t][i](e.data)},this.initialized=t,e()}.bind(this))})}async checkInit(){return new Promise(async(e,t)=>{l(this.init)||(this.init=this.initDataSource()),await this.init,e()})}async doConnect(){return new Promise(async e=>{this.postMessage({message:"connect"},e)})}async isConnected(){return new Promise(async e=>{await this.checkInit(),this.postMessage({message:"is-connected"},e)})}async disconnect(){return new Promise(async e=>{await this.checkInit(),this.postMessage({message:"disconnect"},e)})}postMessage(e,t){const i=S();this.dataSourceWorker.postMessage({...e,messageId:i}),l(t)&&(this.messagesMap[i]=t)}handleWorkerMessage(){this.dataSourceWorker.onmessage=e=>{const t=e.data.messageId;t in this.messagesMap&&(this.messagesMap[t](e.data.data),delete this.messagesMap[t])}}onDisconnect(){}reset(){}};var f=class extends y{constructor(e,t){super(e,t),g(t,"Some properties must be defined"),g(t.startTime,"startTime must must be defined"),g(t.endTime,"startTime must must be defined"),this.timeSync=null}getTimeTopicId(){return"datasource-time-"+this.id}getStartTime(){return this.properties.startTime}getEndTime(){return this.properties.endTime}getMinTime(){return this.properties.minTime}getMaxTime(){return this.properties.maxTime}getReplaySpeed(){return l(this.currentRunningProperties)&&l(this.currentRunningProperties.replaySpeed)?this.currentRunningProperties.replaySpeed:l(this.properties.replaySpeed)?this.properties.replaySpeed:1}async setDataSynchronizer(e){return new Promise(async(t,i)=>{await this.checkInit();const s="data-synchronizer-"+e.id;this.timeSync=e,this.postMessage({message:"topic",topic:s,timeTopic:this.getTimeTopicId()},t)})}async initDataSource(e){return await super.initDataSource(e),new Promise(async e=>{this.postMessage({message:"topic",topic:this.getTopicId(),timeTopic:this.getTimeTopicId()},function(){new BroadcastChannel(this.getTimeTopicId()).onmessage=e=>{const t=e.data.type;if(t in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[t].length;i++)this.eventSubscriptionMap[t][i](e.data)},e()}.bind(this))})}async setTimeRange(e,t,i,s=!1){let r={};return l(i)&&(r={replaySpeed:i}),this.updateProperties({...this.currentRunningProperties,startTime:e,endTime:t,...r,reconnect:s})}async getCurrentTime(){return l(this.timeSync)?this.timeSync.getCurrentTime():new Promise(e=>{this.postMessage({message:"last-timestamp"},e)})}},T=i(0),w=i.n(T);i(3);var b=class extends f{constructor(e,t){super(e,{timeShift:0,reconnectTimeout:5e3,tls:!1,...t},new w.a)}async createWorker(e){return new w.a}},M=i(1),v=i.n(M);var x=class extends f{constructor(e,t){super(e,{timeShift:0,reconnectTimeout:5e3,tls:!1,...t})}async createWorker(e){return new v.a}},I=i(2),k=i.n(I);var P=class{constructor(e){this.bufferingTime=1e3,this.currentTime=Date.now(),this.id=S(),this.dataSources=e.dataSources||[],this.replaySpeed=e.replaySpeed||1,this.timerResolution=e.timerResolution||5,this.initialized=!1,this.properties={},this.properties.replaySpeed=this.replaySpeed,this.eventSubscriptionMap={},this.messagesMap={}}getTopicId(){return"data-synchronizer-"+this.id}getTimeTopicId(){return"data-synchronizer-time-"+this.id}initEventSubscription(){new BroadcastChannel(this.getTopicId()).onmessage=e=>{const t=e.data.type;if(t in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[t].length;i++)this.eventSubscriptionMap[t][i](e.data)},new BroadcastChannel(this.getTimeTopicId()).onmessage=e=>{const t=e.data.type;if(t in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[t].length;i++)this.eventSubscriptionMap[t][i](e.data)}}getStartTime(){if(0===this.dataSources.length)throw"dataSource array is empty";return this.dataSources[0].currentRunningProperties.startTime}getEndTime(){if(0===this.dataSources.length)throw"dataSource array is empty";return this.dataSources[0].currentRunningProperties.endTime}getMinTime(){if(0===this.dataSources.length)throw"dataSource array is empty";return l(this.dataSources[0].properties.minTime)?this.dataSources[0].properties.minTime:this.dataSources[0].properties.startTime}getMaxTime(){if(0===this.dataSources.length)throw"dataSource array is empty";return l(this.dataSources[0].properties.maxTime)?this.dataSources[0].properties.maxTime:this.dataSources[0].properties.endTime}getReplaySpeed(){return this.replaySpeed}terminate(){null!==this.synchronizerWorker&&(this.synchronizerWorker.terminate(),this.synchronizerWorker=null);for(let e of this.dataSources)e.terminate()}subscribe(e,t){for(let i=0;i<t.length;i++)t[i]in this.eventSubscriptionMap||(this.eventSubscriptionMap[t[i]]=[]),this.eventSubscriptionMap[t[i]].push(e)}async initDataSources(){return new Promise(async(e,t)=>{try{const t=[];for(let e of this.dataSources){const i=await this.createDataSourceForWorker(e);t.push(i)}this.synchronizerWorker=new k.a,this.handleWorkerMessage(),this.postMessage({message:"init",dataSources:t,replaySpeed:this.replaySpeed,timerResolution:this.timerResolution,dataTopic:this.getTopicId(),timeTopic:this.getTimeTopicId()},function(){this.initEventSubscription(),this.initialized=!0,e()}.bind(this))}catch(e){console.log(e),t(e)}})}async createDataSourceForWorker(e){const t={bufferingTime:e.properties.bufferingTime||0,timeOut:e.properties.timeOut||0,id:e.id,name:e.name};try{await e.setDataSynchronizer(this),e.properties.replaySpeed=this.replaySpeed}catch(e){throw console.error("Cannot set the synchronizer to this DataSource",e),e}return t}async addDataSource(e){return new Promise(async t=>{const i=await this.createDataSourceForWorker(e);this.dataSources.push(e),this.postMessage({message:"add",dataSources:[i]},t)})}async push(e,t){return new Promise((i,s)=>{null!==this.synchronizerWorker&&this.postMessage({type:"data",dataSourceId:e,data:t},i)})}async connect(){await this.checkInit(),await this.doConnect()}async checkInit(){return new Promise(async(e,t)=>{l(this.init)||(this.init=this.initDataSources()),await this.init,e()})}async doConnect(){for(let e of this.dataSources)await e.connect()}async disconnect(){await this.reset();for(let e of this.dataSources)await e.disconnect()}async setReplaySpeed(e){return new Promise(t=>{this.replaySpeed=e,this.properties.replaySpeed=e,this.postMessage({message:"replay-speed",replaySpeed:e},t)})}async setTimeRange(e,t,i,s=!1){this.replaySpeed!==i&&await this.setReplaySpeed(i),await this.reset();for(let r of this.dataSources)r.setTimeRange(e,t,i,s)}async reset(){return new Promise(async e=>{await this.checkInit(),this.postMessage({message:"reset"},e)})}async getCurrentTime(){return new Promise(e=>{this.postMessage({message:"current-time"},e)})}async isConnected(){for(let e of this.dataSources)if(!await e.isConnected())return!1;return!0}postMessage(e,t){const i=S();this.synchronizerWorker.postMessage({...e,messageId:i}),l(t)&&(this.messagesMap[i]=t)}handleWorkerMessage(){this.synchronizerWorker.onmessage=e=>{const t=e.data.messageId;t in this.messagesMap&&(this.messagesMap[t](e.data.data),delete this.messagesMap[t])}}};const W="2015-12-19T21:04:29.231Z",O="2015-12-19T21:09:19.675Z",D=new x("drone-Video",{protocol:"ws",service:"SOS",endpointUrl:"sensiasoft.net:8181/sensorhub/sos",offeringID:"urn:mysos:solo:video2",observedProperty:"http://sensorml.com/ont/swe/property/VideoFrame",startTime:W,endTime:O,replaySpeed:10,bufferingTime:800,timeOut:1e3}),R=new b("android-GPS",{protocol:"ws",service:"SOS",endpointUrl:"sensiasoft.net:8181/sensorhub/sos",offeringID:"urn:mysos:solo:nav2",observedProperty:"http://www.opengis.net/def/property/OGC/0/PlatformLocation",startTime:W,endTime:O,replaySpeed:10,bufferingTime:800,timeOut:1e3}),C=new b("android-Heading",{protocol:"ws",service:"SOS",endpointUrl:"sensiasoft.net:8181/sensorhub/sos",offeringID:"urn:mysos:solo:nav2",observedProperty:"http://www.opengis.net/def/property/OGC/0/PlatformOrientation",startTime:W,endTime:O,replaySpeed:10,bufferingTime:800,timeOut:1e3}),z=new P({replaySpeed:10,timerResolution:5,dataSources:[D,R,C]});z.connect(),D.subscribe(e=>function(e){let t;for(let i=0;i<e.length;i++)t=e[i],t.data.frameData=e[i].data.frameData.slice(0,10),n.value=JSON.stringify([t])+"\n";p.innerText=new Date(e[e.length-1].timeStamp).toISOString()+" - Video",u.innerText=new Date(e[e.length-1].timeStamp).toISOString()+" - Current"}(e.values),[h]),R.subscribe(e=>{return t=e.values,s.value=JSON.stringify(t),o.innerText=new Date(t[t.length-1].timeStamp).toISOString()+" - Location",void(u.innerText=new Date(t[t.length-1].timeStamp).toISOString()+" - Current");var t},[h]),C.subscribe(e=>{return t=e.values,r.value=JSON.stringify(t)+"\n",c.innerText=new Date(t[t.length-1].timeStamp).toISOString()+" - Orientation",void(u.innerText=new Date(t[t.length-1].timeStamp).toISOString()+" - Current");var t},[h]),z.subscribe(e=>{return(t=e.timestamp)<d&&(a.value=new Date(t).toISOString()+" < "+new Date(d).toISOString()+"\n"),void(d=t);var t},[m]),z.connect()}]);