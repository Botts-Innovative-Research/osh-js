!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=10)}([function(t,e,i){"use strict";var s,r=function(){return void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s},a=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}(),o=[];function n(t){for(var e=-1,i=0;i<o.length;i++)if(o[i].identifier===t){e=i;break}return e}function h(t,e){for(var i={},s=[],r=0;r<t.length;r++){var a=t[r],h=e.base?a[0]+e.base:a[0],c=i[h]||0,d="".concat(h," ").concat(c);i[h]=c+1;var u=n(d),p={css:a[1],media:a[2],sourceMap:a[3]};-1!==u?(o[u].references++,o[u].updater(p)):o.push({identifier:d,updater:g(p,e),references:1}),s.push(d)}return s}function c(t){var e=document.createElement("style"),s=t.attributes||{};if(void 0===s.nonce){var r=i.nc;r&&(s.nonce=r)}if(Object.keys(s).forEach((function(t){e.setAttribute(t,s[t])})),"function"==typeof t.insert)t.insert(e);else{var o=a(t.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(e)}return e}var d,u=(d=[],function(t,e){return d[t]=e,d.filter(Boolean).join("\n")});function p(t,e,i,s){var r=i?"":s.media?"@media ".concat(s.media," {").concat(s.css,"}"):s.css;if(t.styleSheet)t.styleSheet.cssText=u(e,r);else{var a=document.createTextNode(r),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(a,o[e]):t.appendChild(a)}}function l(t,e,i){var s=i.css,r=i.media,a=i.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),a&&btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleSheet)t.styleSheet.cssText=s;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(s))}}var m=null,f=0;function g(t,e){var i,s,r;if(e.singleton){var a=f++;i=m||(m=c(e)),s=p.bind(null,i,a,!1),r=p.bind(null,i,a,!0)}else i=c(e),s=l.bind(null,i,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return s(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;s(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=r());var i=h(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var s=0;s<i.length;s++){var r=n(i[s]);o[r].references--}for(var a=h(t,e),c=0;c<i.length;c++){var d=n(i[c]);0===o[d].references&&(o[d].updater(),o.splice(d,1))}i=a}}}},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",s=t[3];if(!s)return i;if(e&&"function"==typeof btoa){var r=(o=s,n=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),h="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),"/*# ".concat(h," */")),a=s.sources.map((function(t){return"/*# sourceURL=".concat(s.sourceRoot||"").concat(t," */")}));return[i].concat(a).concat([r]).join("\n")}var o,n,h;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i,s){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(s)for(var a=0;a<this.length;a++){var o=this[a][0];null!=o&&(r[o]=!0)}for(var n=0;n<t.length;n++){var h=[].concat(t[n]);s&&r[h[0]]||(i&&(h[2]?h[2]="".concat(i," and ").concat(h[2]):h[2]=i),e.push(h))}},e}},function(t,e,i){var s=i(0),r=i(9);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var a={insert:"head",singleton:!1},o=(s(r,a),r.locals?r.locals:{});t.exports=o},function(t,e,i){t.exports=function(){return new Worker(i.p+"WorkerName.4058e9ce6e77d3efa848.js")}},function(t,e,i){t.exports=function(){return new Worker(i.p+"WorkerName.233c73788ce0524d26c7.js")}},function(t,e,i){t.exports=function(){return new Worker(i.p+"WorkerName.e282f61ebdccb37600bb.js")}},function(t,e,i){t.exports=function(){return new Worker(i.p+"WorkerName.076572a926dab679a73f.js")}},function(t,e,i){var s=i(0),r=i(8);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var a={insert:"head",singleton:!1},o=(s(r,a),r.locals?r.locals:{});t.exports=o},function(t,e,i){(e=i(1)(!1)).push([t.i,".osh-view {\n    width:100%;\n    height: 100%;\n}\n",""]),t.exports=e},function(t,e,i){(e=i(1)(!1)).push([t.i,".ffmpeg-info{\n    position:absolute;\n    font-size: 12px;\n    color:#FFFFFF;\n    padding:2px;\n    font-weight: bold;\n    background-color: rgba(0, 0, 0, 0.3);\n    box-shadow: 2px 2px 2px 1px rgba(0, 0, 0, 0.3);\n    z-index: 10;\n}\n",""]),t.exports=e},function(t,e,i){"use strict";i.r(e);Math.pow(2,53);function s(t){return null!=t}function r(t){return s(t)&&null!==t}function a(t,e){return r(t)&&typeof t===e}function o(t,e="letiable"){if(!s(t))throw e+" must be defined";return t}function n(t,e="letiable"){if(!s(t)||!t)throw e;return t}function h(t,e,i="letiable"){if(o(t,i),typeof t!==e)throw i+" must be of type "+e;return t}function c(t,e="letiable"){if(o(t,e),!Array.isArray(t))throw e+" must be an array";return t}function d(t,e){return h(t,"function",e)}function u(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}function p(t){return t.charAt(0).toUpperCase()+t.slice(1)}var l=i(3),m=i.n(l);const f="replay",g="realTime";var v=class{constructor(t,e){this.id="DataSource-"+u(),this.name=t,this.properties=e,this.eventSubscriptionMap={},this.init=void 0,this.messagesMap={},this.mode=g,s(e.mode)&&(this.mode=e.mode)}getId(){return this.id}getName(){return this.name}terminate(){null!==this.dataSourceWorker&&this.dataSourceWorker.terminate()}getTopicId(){return"datasource-data-"+this.id}getVersion(){return 0}subscribe(t,e){for(let i=0;i<e.length;i++)e[i]in this.eventSubscriptionMap||(this.eventSubscriptionMap[e[i]]=[]),this.eventSubscriptionMap[e[i]].push(t)}async createWorker(t){return new m.a}async updateProperties(t){return this.properties={...this.properties,...t},new Promise(e=>{this.postMessage({message:"update-properties",data:t},e)})}async connect(){await this.checkInit(),await this.doConnect()}async initDataSource(){return new Promise(async(t,e)=>{this.dataSourceWorker=await this.createWorker(this.properties),this.handleWorkerMessage(),this.postMessage({message:"init",id:this.id,properties:this.properties,topics:{data:this.getTopicId()}},async e=>{new BroadcastChannel(this.getTopicId()).onmessage=async t=>{await this.handleMessage(t)},t(e)})})}async handleMessage(t){const e=t.data.type;if(e in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[e].length;i++)this.eventSubscriptionMap[e][i](t.data)}async checkInit(){return new Promise(async(t,e)=>{s(this.init)||(this.init=this.initDataSource()),await this.init,t()})}async doConnect(){return new Promise(async t=>{this.postMessage({message:"connect"},t)})}async isConnected(){return new Promise(async t=>{await this.checkInit(),this.postMessage({message:"is-connected"},t)})}async disconnect(){return new Promise(async t=>{await this.checkInit(),this.postMessage({message:"disconnect"},t)})}postMessage(t,e){const i=u();this.dataSourceWorker.postMessage({...t,messageId:i}),s(e)&&(this.messagesMap[i]=e)}handleWorkerMessage(){this.dataSourceWorker.onmessage=t=>{const e=t.data.messageId;e in this.messagesMap&&(this.messagesMap[e](t.data.data),delete this.messagesMap[e])}}async onDisconnect(){}reset(){}};var y=class extends v{constructor(t,e){super(t,e),o(e,"Some properties must be defined"),this.dataSynchronizer=void 0}getTimeTopicId(){return"datasource-time-"+this.id}getStartTime(){return this.properties.startTime}getMode(){return this.properties.mode}getEndTime(){return this.properties.endTime}getMinTime(){return this.properties.minTime}getMaxTime(){return this.properties.maxTime}setMinTime(t){this.properties.minTime=t}setMaxTime(t){this.properties.maxTime=t}getReplaySpeed(){return this.properties.replaySpeed}setReplaySpeed(t){this.properties.replaySpeed=t}async setDataSynchronizer(t){return new Promise(async(e,i)=>{await this.checkInit();const s="data-synchronizer-"+t.id;this.dataSynchronizer=t,this.postMessage({message:"topics",topics:{data:s,time:this.getTimeTopicId(),sync:t.getTimeTopicId()}},e)})}async disconnect(){return new Promise(async t=>{await this.checkInit(),this.postMessage({message:"disconnect"},t)})}async doConnect(){return new Promise(async t=>{let e=this.properties.startTime;if(s(this.dataSynchronizer)){let t=(await this.dataSynchronizer.getCurrentTime()).data;s(t)&&(e=new Date(t).toISOString())}this.postMessage({message:"connect",startTime:e},t)})}async initDataSource(t){return await super.initDataSource(t),new Promise(async(t,e)=>{this.postMessage({message:"topics",topics:{data:this.getTopicId(),time:this.getTimeTopicId()}},async()=>{new BroadcastChannel(this.getTimeTopicId()).onmessage=async t=>{await this.handleTimeMessage(t)},t()})})}async handleTimeMessage(t){const e=t.data.type;if(e in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[e].length;i++)this.eventSubscriptionMap[e][i](t.data)}async setTimeRange(t=this.getStartTime(),e=this.getEndTime(),i=this.getReplaySpeed(),s=!1,r=this.getMode()){return this.updateProperties({startTime:t,endTime:e,replaySpeed:i,reconnect:s,mode:r})}};var T=class extends y{constructor(t,e){super(t,{protocol:"ws",service:"SOS",timeShift:0,reconnectTimeout:5e3,reconnectRetry:10,tls:!1,type:"SosGetResult",mode:g,prefetchBatchSize:250,prefetchBatchDuration:5e3,...e})}};var w=class{constructor(t){this.properties=t,this.init(t)}init(t=this.properties){if(this.data=[],this.propsById={},this.dataSourcesToFn=void 0,this.props={id:"layer-"+u(),filter:!0,name:"",description:"",visible:!0,timestamp:!0},this.dataSourceIds=void 0,s(t.name)&&(this.props.name=t.name),s(t.description)&&(this.props.description=t.description),s(t.dataSourceId)&&(this.dataSourceIds=[t.dataSourceId]),s(t.dataSourceIds)&&(this.dataSourceIds=t.dataSourceIds),this.dataSourceIds||(this.dataSourceIds=[]),s(t.visible)&&(this.props.visible=t.visible),s(t.timestamp)&&(this.props.timestamp=t.timestamp),s(t.onLeftClick)&&d(t.onLeftClick)&&(this.props.onLeftClick=t.onLeftClick),s(t.onRightClick)&&d(t.onRightClick)&&(this.props.onRightClick=t.onRightClick),s(t.onHover)&&d(t.onHover)&&(this.props.onHover=t.onHover),this.initEvents(),this.checkFn("filter")){let t=(t,e,i)=>{this.props.filter=this.getFunc("filter")(t,e,i)};this.addFn(this.getDataSourcesIdsByProperty("filter"),t)}else{this.properties.filter=function(t,e,i){return!0};let t=async(t,e,i)=>{this.props.filter=await this.getFunc("filter")(t,e,i)};this.addFn(this.getDataSourcesIdsByProperty("filter"),t)}if(this.checkFn("getVisible")){let t=async(t,e,i)=>{this.updateProperty("visible",await this.getFunc("getVisible")(t,e,i))};this.addFn(this.getDataSourcesIdsByProperty("getVisible"),t)}if(this.checkFn("getTimestamp")){let t=async(t,e,i)=>{this.updateProperty("timestamp",await this.getFunc("getTimestamp")(t,e,i))};this.addFn(this.getDataSourcesIdsByProperty("getTimestamp"),t)}if(this.checkFn("getName")){let t=async(t,e,i)=>{this.updateProperty("name",await this.getFunc("getName")(t,e,i))};this.addFn(this.getDataSourcesIdsByProperty("getName"),t)}if(this.checkFn("getDescription")){let t=async(t,e,i)=>{this.updateProperty("description",await this.getFunc("getDescription")(t,e,i))};this.addFn(this.getDataSourcesIdsByProperty("getDescription"),t)}}getFunc(t){return this.properties[t].handler||this.properties[t]}checkFn(t){let e=this.properties[t];if(a(e,"function"))return o(this.dataSourceIds,"dataSourceIds"),!0;{let i=r(e);return i&&(c(e.dataSourceIds,t+".dataSourceIds"),d(e.handler,t+".handler")),i}}initEvents(){}clear(){}getId(){return this.props.id}select(t){}addFn(t,e,i=!1){s(this.dataSourcesToFn)||(this.dataSourcesToFn={});for(let r=0;r<t.length;r++){let a=t[r];s(this.dataSourcesToFn[a])||(this.dataSourcesToFn[a]=[]),i?this.dataSourcesToFn[a].unshift(e):this.dataSourcesToFn[a].push(e)}}async setData(t,e,i={}){if(this.data=[],i.dataSourceId=t,s(this.dataSourcesToFn)&&t in this.dataSourcesToFn){let s=this.dataSourcesToFn[t];this.props.filter=!0;for(let t=0;t<e.length;t++){for(let r=0;r<s.length&&(await s[r](e[t].data,e[t].data.timestamp,i),this.props.filter);r++);this.props.filter&&this.data.push({...this.props,...this.propsById[this.getId()]})}}}getDataSourcesIds(){if(s(this.dataSourcesToFn)){let t=[];for(let e in this.dataSourcesToFn)t.push(e);return t}return o(this.dataSourceIds,"dataSourceId must be defined"),this.dataSourceIds}getDataSourcesIdsByProperty(t){return this.properties[t].dataSourceIds||this.dataSourceIds}getProps(){return{type:this.type,values:this.data}}reset(){this.init(this.properties)}updateProperty(t,e){this.propsById[this.getId()][t]=e}checkExistingProps(t){return t in this.propsById}setProps(t,e){this.propsById[t]=e}setId(t,e){this.props.id=t,this.checkExistingProps(t)||this.setProps(t,e())}definedId(t,e){if(this.checkFn("get"+p(t))){let i=async(i,s,r)=>{const a=await this.getFunc("get"+p(t))(i,s,r);this.setId(a,()=>({...e,[t]:a}))};this.addFn(this.getDataSourcesIdsByProperty("get"+p(t)),i,!0)}else this.setId(this.getId(),()=>({...e,[t]:this.getId()}))}getCurrentProps(){return this.propsById[this.getId()]}getIds(){return Object.keys(this.propsById)}};var x=class extends w{constructor(t){super(t),this.type="binaryData"}init(t=this.properties){super.init(t);const e={frameData:void 0};if(s(t.frameData)&&(this.props.frameData=t.frameData),this.definedId("dataId",e),s(t.getFrameData)){let t=async(t,e,i)=>{this.updateProperty("frameData",await this.getFunc("getFrameData")(t,e,i))};this.addFn(this.getDataSourcesIdsByProperty("getFrameData"),t)}}};var S=class extends x{constructor(t){super(t),this.type="videoData"}init(t=this.properties){super.init(t);const e={roll:0};if(s(t.roll)&&(e.roll=t.roll),this.definedId("videoDataId",e),s(t.getRoll)){let t=async(t,e,i)=>{this.updateProperty("roll",await this.getFunc("getRoll")(t,e,i))};this.addFn(this.getDataSourcesIdsByProperty("getRoll"),t)}}};i(7);const b="closed-error",D="data",R="status",I="time-changed";var E=class{constructor(t){this.layers=[],this.lastRec={},this.dataSources=[],this.broadcastChannels=[],this.id="view-"+u(),this.css="",s(t)&&s(t.css)&&(this.css=t.css),o(t&&t.supportedLayers,"supportedLayers"),c(t.supportedLayers,"supportedLayers"),n(t.supportedLayers.length>0,"supportedLayers.length === 0"),this.supportedLayers=t.supportedLayers,this.init(t)}init(t){this.properties=t,this.elementDiv=document.createElement("div"),this.elementDiv.setAttribute("id",this.id),this.elementDiv.setAttribute("class",this.css+" osh-view"),this.divId=this.id;let e=s(t.container)?t.container:document.body,i=document.getElementById(e);if(s(i)&&null!==i?(i.appendChild(this.elementDiv),this.container=i):(document.body.appendChild(this.elementDiv),this.hide(),this.container=document.body),this.beforeAddingItems(t),s(t)){if(s(t.layers))for(let e=0;e<t.layers.length;e++)this.addLayer(t.layers[e]);s(t.visible)&&(document.getElementById(this.divId).style.display=t.visible?"block":"none")}const r=this;new MutationObserver(t=>{t.forEach((function(t){"style"===t.attributeName&&r.onResize()}))}).observe(this.elementDiv,{attributes:!0});new MutationObserver((function(t){s(document.getElementById(r.divId))||(this.disconnect(),r.destroy())})).observe(document.body,{childList:!0})}hide(){this.elementDiv.style.display="none"}onResize(){}attachTo(t){s(this.elementDiv.parentNode)&&this.elementDiv.parentNode.removeChild(this.elementDiv),document.getElementById(t).appendChild(this.elementDiv),"none"===this.elementDiv.style.display&&(this.elementDiv.style.display="block"),this.onResize()}beforeAddingItems(t){}getId(){return this.id}getDivId(){return this.divId}async setData(t,e){}show(t){}destroy(){for(let t of this.broadcastChannels)t.close();this.broadcastChannels=[]}addLayer(t){n(this.supportedLayers.includes(t.type),"this layer is not supported: "+t.type+", should be "+this.supportedLayers),this.layers.push(t);let e=t.getDataSourcesIds();for(let i=0;i<e.length;i++){const s=e[i];let r=this;const a=new BroadcastChannel("datasource-data-"+s);a.onmessage=async e=>{if(e.data.type===R&&e.data.status===b)r.reset();else if(e.data.type===D){const i=this;await t.setData(s,e.data.values),await i.setData(s,t.getProps()),r.lastRec[s]=e.data}};const o=new BroadcastChannel("datasource-time-"+s);o.onmessage=t=>{t.data.type===I&&r.reset()},this.broadcastChannels.push(a),this.broadcastChannels.push(o)}}removeAllFromLayer(t){if(this.layers.includes(t)){for(let e in t.dataSourcesToFn)delete this.lastRec[e];t.reset()}}removeAllFromLayers(){for(let t of this.layers)this.removeAllFromLayer(t)}getDataSourcesId(){let t=[];for(let e=0;e<this.layers.length;e++){let i=this.layers[e];t=t.concat(i.getDataSourcesIds())}return t}reset(){this.removeAllFromLayers()}};var A=class extends E{constructor(t){super(t),this.fps=0,this.width=1920,this.height=1080,this.showTime=!1,this.showStats=!1,this.statistics={averageFps:0,frames:0,firstTime:0,bitRate:0,averageBitRate:0},this.framerate=29.67,s(t)&&(s(t.framerate)&&(this.framerate=t.framerate),s(t.directPlay)&&(this.directPlay=t.directPlay),s(t.codec)&&(this.codec=t.codec),s(t.showTime)&&(this.showTime=t.showTime),s(t.showStats)&&(this.showStats=t.showStats),s(t.width)&&(this.width=t.width),s(t.height)&&(this.height=t.height));let e,i,r=document.getElementById(this.divId);(this.showTime||this.showStats)&&(this.textDiv=document.createElement("div"),this.textDiv.setAttribute("width",""+this.width),this.textDiv.setAttribute("height",15),this.textDiv.setAttribute("class","ffmpeg-info"),this.showTime&&(this.textFpsDiv=document.createElement("div"),this.textFpsDiv.setAttribute("class","ffmpeg-fps"),this.textDiv.appendChild(this.textFpsDiv)),this.showStats&&(this.textStatsDiv=document.createElement("div"),this.textStatsDiv.setAttribute("class","ffmpeg-stats"),this.textDiv.appendChild(this.textStatsDiv)),r.appendChild(this.textDiv)),this.domNode=r,s(document.hidden)?(e="hidden",i="visibilitychange"):s(document.msHidden)?(e="msHidden",i="msvisibilitychange"):s(document.webkitHidden)&&(e="webkitHidden",i="webkitvisibilitychange");const a=this;document.addEventListener(i,(function(){document.hidden?a.skipFrame=!0:a.skipFrame=!1}),!1)}updateStatistics(t){if(this.statistics.frames++,this.statistics.pktSize+=t,0===this.statistics.firstTime)return void(this.statistics.firstTime=performance.now());const e=performance.now();e-this.statistics.firstTime<1e3||(this.statistics.averageFps=(this.statistics.frames-1)/((e-this.statistics.firstTime)/1e3),this.statistics.averageBitRate=(this.statistics.pktSize-t)/((e-this.statistics.firstTime)/1e3),this.statistics.frames=1,this.statistics.pktSize=t,this.statistics.firstTime=e)}onUpdated(t){}destroy(){}onAfterDecoded(t,e){}};var P=class extends E{constructor(t){if(super({supportedLayers:["videoData"],...t}),this.timestamp=null,s(t.showTime)&&t.showTime&&(this.timestamp=document.createElement("div"),this.timestamp.setAttribute("class","video-time"),document.getElementById(this.divId).appendChild(this.timestamp)),this.imgTag=document.createElement("img"),this.imgTag.setAttribute("class","video-mjpeg"),this.rotation=0,void 0!==t&&void 0!==t.rotation){this.rotation=t.rotation*Math.PI/180,this.canvas=document.createElement("canvas"),this.canvas.width=640,this.canvas.height=480;var e=this.canvas.getContext("2d");e.translate(0,480),e.rotate(this.rotation),document.getElementById(this.divId).appendChild(this.canvas)}else document.getElementById(this.divId).appendChild(this.imgTag)}async setData(t,e){if("videoData"===e.type){const t=e.values;for(let e=0;e<t.length;e++)this.updateVideo(t[e])}}updateVideo(t){let e=new Blob([t.frameData.data]),i=window.URL.createObjectURL(e),s=this.imgTag.src;this.imgTag.src=i,null!==this.timestamp&&(this.timestamp.innerHTML=new Date(t.timestamp).toISOString()),window.URL.revokeObjectURL(s)}selectDataView(t,e){t.indexOf(this.dataSourceId)>-1||s(this.entity)&&this.entity.getId()===e?document.getElementById(this.divId).setAttribute("class",this.css+" "+this.cssSelected):document.getElementById(this.divId).setAttribute("class",this.css)}reset(){this.imgTag.src=""}async getCanvas(){return this.canvas}},C=(i(2),i(4)),F=i.n(C);var M=class{constructor(t){t=t||{},this.canvasElement=t.canvas||document.createElement("canvas"),this.canvasElement.setAttribute("id",u()),this.contextOptions=t.contextOptions,this.type=t.type||"yuv420",this.customYUV444=t.customYUV444,this.conversionType=t.conversionType||"rec601",this.width=t.width||640,this.height=t.height||320,this.animationTime=t.animationTime||0,this.canvasElement.width=this.width,this.canvasElement.height=this.height,this.init()}init(){this.initContextGL(),this.contextGL&&(this.initProgram(),this.initBuffers(),this.initTextures()),"yuv420"===this.type?(this.drawNextOuptutPictureGL=t=>{var e=this.contextGL,i=this.texturePosBuffer,s=this.uTexturePosBuffer,r=this.vTexturePosBuffer,a=this.yTextureRef,o=this.uTextureRef,n=this.vTextureRef,h=t.yData,c=t.uData,d=t.vData,u=this.width,p=this.height,l=t.yDataPerRow||u,m=t.yRowCnt||p,f=t.uDataPerRow||u/2,g=t.uRowCnt||p/2,v=t.vDataPerRow||f,y=t.vRowCnt||g;let T=90*Math.round(t.roll/90);T>180&&(T-=360),90==Math.abs(T)?(this.canvasElement.width=this.height,this.canvasElement.height=this.width,e.viewport(0,0,p,u)):(this.canvasElement.width=this.width,this.canvasElement.height=this.height,e.viewport(0,0,u,p));var w=p/m,x=u/l,S=new Float32Array([x,0,0,0,x,w,0,w]);e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,S,e.DYNAMIC_DRAW),this.customYUV444?(w=p/g,x=u/f):(w=p/2/g,x=u/2/f);var b=new Float32Array([x,0,0,0,x,w,0,w]);e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,b,e.DYNAMIC_DRAW),this.customYUV444?(w=p/y,x=u/v):(w=p/2/y,x=u/2/v);var D=new Float32Array([x,0,0,0,x,w,0,w]);e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,D,e.DYNAMIC_DRAW),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,l,m,0,e.LUMINANCE,e.UNSIGNED_BYTE,h),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,f,g,0,e.LUMINANCE,e.UNSIGNED_BYTE,c),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,v,y,0,e.LUMINANCE,e.UNSIGNED_BYTE,d),e.uniform1f(this.rollUniform,T*Math.PI/180),e.drawArrays(e.TRIANGLE_STRIP,0,4)},this.drawNextOuptutPictureBitmapGL=t=>{var e=this.contextGL,i=this.texturePosBuffer,s=this.yTextureRef,r=t.yData,a=this.width,o=this.height,n=o/o,h=a/a,c=new Float32Array([h,0,0,0,h,n,0,n]);e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,c,e.DYNAMIC_DRAW),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.drawArrays(e.TRIANGLE_STRIP,0,4)}):"yuv422"===this.type&&(this.drawNextOuptutPictureGL=t=>{var e=this.contextGL,i=this.texturePosBuffer,s=this.textureRef,r=t.data,a=this.width,o=this.height,n=t.dataPerRow||2*a,h=t.rowCnt||o;e.viewport(0,0,a,o);var c=o/h,d=a/(n/2),u=new Float32Array([d,0,0,0,d,c,0,c]);e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,u,e.DYNAMIC_DRAW),e.uniform2f(e.getUniformLocation(this.shaderProgram,"resolution"),n,o),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,n,h,0,e.LUMINANCE,e.UNSIGNED_BYTE,r),e.drawArrays(e.TRIANGLE_STRIP,0,4)})}isWebGL(){return this.contextGL}initContextGL(){for(var t=this.canvasElement,e=null,i=["webgl","experimental-webgl","moz-webgl","webkit-3d"],s=0;!e&&s<i.length;){var r=i[s];try{e=this.contextOptions?t.getContext(r,this.contextOptions):t.getContext(r)}catch(t){e=null}e&&"function"==typeof e.getParameter||(e=null),++s}this.contextGL=e}initProgram(){var t,e,i=this.contextGL;"yuv420"===this.type?(t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","uniform float roll;","void main()","{","  vec4 ctr = vec4(0.5, 0.5, 0, 0);","  mat4 rotMatrix = mat4( cos(roll), -sin(roll), 0, 0,","                         sin(roll),  cos(roll), 0, 0,","                         0,          0,         1, 0,","                         0,          0,         0, 1);","  gl_Position = vertexPos;","  textureCoord = mat2(rotMatrix) * (texturePos.xy - vec2(ctr)) + vec2(ctr);","  uTextureCoord = mat2(rotMatrix) * (uTexturePos.xy - vec2(ctr)) + vec2(ctr);","  vTextureCoord = mat2(rotMatrix) * (vTexturePos.xy - vec2(ctr)) + vec2(ctr);","}"].join("\n"),e=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n")):"yuv422"===this.type&&(t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","}"].join("\n"),e=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform highp vec2 resolution;","uniform mat4 YUV2RGB;","void main(void) {","  highp float texPixX = 1.0 / resolution.x;","  highp float logPixX = 2.0 / resolution.x;","  highp float logHalfPixX = 4.0 / resolution.x;","  highp float steps = floor(textureCoord.x / logPixX);","  highp float uvSteps = floor(textureCoord.x / logHalfPixX);","  highp float y = texture2D(sampler, vec2((logPixX * steps) + texPixX, textureCoord.y)).r;","  highp float u = texture2D(sampler, vec2((logHalfPixX * uvSteps), textureCoord.y)).r;","  highp float v = texture2D(sampler, vec2((logHalfPixX * uvSteps) + texPixX + texPixX, textureCoord.y)).r;","  gl_FragColor = vec4(y, u, v, 1.0) * YUV2RGB;","}"].join("\n"));var s=[];s="rec709"===this.conversionType?[1.16438,0,1.79274,-.97295,1.16438,-.21325,-.53291,.30148,1.16438,2.1124,0,-1.1334,0,0,0,1]:[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];var r=i.createShader(i.VERTEX_SHADER);i.shaderSource(r,t),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+i.getShaderInfoLog(r));var a=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(a,e),i.compileShader(a),i.getShaderParameter(a,i.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+i.getShaderInfoLog(a));var o=i.createProgram();i.attachShader(o,r),i.attachShader(o,a),i.linkProgram(o),i.getProgramParameter(o,i.LINK_STATUS)||console.log("Program failed to compile: "+i.getProgramInfoLog(o)),i.useProgram(o);var n=i.getUniformLocation(o,"YUV2RGB");i.uniformMatrix4fv(n,!1,s),this.rollUniform=i.getUniformLocation(o,"roll"),this.shaderProgram=o}initBuffers(){var t=this.contextGL,e=this.shaderProgram,i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),t.STATIC_DRAW);var s=t.getAttribLocation(e,"vertexPos");if(t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),this.animationTime){var r=this.animationTime,a=0,o=function(){var i=1*(a+=15)/r;a>=r?i=1:setTimeout(o,15);var s=-1*i,n=1*i,h=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,new Float32Array([n,n,s,n,n,s,s,s]),t.STATIC_DRAW);var c=t.getAttribLocation(e,"vertexPos");t.enableVertexAttribArray(c),t.vertexAttribPointer(c,2,t.FLOAT,!1,0,0);try{t.drawArrays(t.TRIANGLE_STRIP,0,4)}catch(t){}};o()}var n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var h=t.getAttribLocation(e,"texturePos");if(t.enableVertexAttribArray(h),t.vertexAttribPointer(h,2,t.FLOAT,!1,0,0),this.texturePosBuffer=n,"yuv420"===this.type){var c=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var d=t.getAttribLocation(e,"uTexturePos");t.enableVertexAttribArray(d),t.vertexAttribPointer(d,2,t.FLOAT,!1,0,0),this.uTexturePosBuffer=c;var u=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW);var p=t.getAttribLocation(e,"vTexturePos");t.enableVertexAttribArray(p),t.vertexAttribPointer(p,2,t.FLOAT,!1,0,0),this.vTexturePosBuffer=u}}initTextures(){var t=this.contextGL,e=this.shaderProgram;if("yuv420"===this.type){var i=this.initTexture(),s=t.getUniformLocation(e,"ySampler");t.uniform1i(s,0),this.yTextureRef=i;var r=this.initTexture(),a=t.getUniformLocation(e,"uSampler");t.uniform1i(a,1),this.uTextureRef=r;var o=this.initTexture(),n=t.getUniformLocation(e,"vSampler");t.uniform1i(n,2),this.vTextureRef=o}else if("yuv422"===this.type){var h=this.initTexture(),c=t.getUniformLocation(e,"sampler");t.uniform1i(c,0),this.textureRef=h}}initTexture(){var t=this.contextGL,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),e}drawNextOutputPicture(t,e,i,s){this.contextGL?this.drawNextOuptutPictureGL(t,e,i,s):this.drawNextOuptutPictureRGBA(t,e,i,s)}drawNextOuptutPictureRGBA(t,e,i,s){var r=s,a=this.canvasElement.getContext("2d"),o=a.getImageData(0,0,t,e);o.data.set(r),null===i?a.putImageData(o,0,0):a.putImageData(o,-i.left,-i.top,0,0,i.width,i.height)}resize(t,e){this.canvasElement.width=t,this.canvasElement.height=e,this.width=t,this.height=e}};const B="array";var _=class extends A{constructor(t){if(super({supportedLayers:["videoData"],...t}),!1 in window)throw Error("WebCodec API is not supported");if(this.codecMap={vp9:"vp09.02.10.10.01.09.16.09.01",vp8:"vp08.00.41.08",h264:"avc1.42e01e"},this.codec=this.codecMap.h264,s(t.codec)){if(!t.codec in this.codecMap)throw Error("The codec properties.codec is not supported, the list of supported codec: this.codecMap");this.codec=this.codecMap[t.codec]}this.canvasElt=this.createCanvas(this.width,this.height),this.domNode.appendChild(this.canvasElt)}createCanvas(t,e,i){const r=document.createElement("canvas");return r.setAttribute("width",t),r.setAttribute("height",e),s(i)&&r.setAttribute("style",i),r}updateCanvasSize(t,e){this.canvasElt.setAttribute("width",t),this.canvasElt.setAttribute("height",e)}async setData(t,e){if("videoData"===e.type){const t=e.values;for(let e=0;e<t.length;e++)this.updateVideo(t[e])}}updateVideo(t){this.skipFrame||(this.codecConfigured||(this.codec=this.codecMap[t.frameData.compression.toLowerCase()],this.initDecoder()),this.decode(t.frameData.data.length,t.frameData.data,t.timestamp,t.roll||0))}reset(){}initDecoder(){this.gl=this.canvasElt.getContext("bitmaprenderer"),this.decodeWorker=new F.a,this.decodeWorker.postMessage({init:{codec:this.codec,width:this.width,height:this.height}}),this.decodeWorker.onmessage=t=>{if(t.data.init)this.codecConfigured=!0;else if(this.codecConfigured){const e=t.data.bitmap,i=t.data.width,r=t.data.height;if(!s(e))return void console.warn("Bitmap is undefined, skipping this frame..");this.handleDocodedFrame(e,i,r)}}}async handleDocodedFrame(t,e,i){try{this.width===e&&this.height===i||(this.width=e,this.height=i,this.updateCanvasSize(e,i)),this.gl.transferFromImageBitmap(t),this.onAfterDecoded(t,B),this.updateStatistics(event.data.pktSize),this.showTime&&(this.textFpsDiv.innerText=new Date(event.data.timestamp).toISOString()+" "),this.showStats&&(this.textStatsDiv.innerText=this.statistics.averageFps.toFixed(2)+" fps, "+(this.statistics.averageBitRate/1e3).toFixed(2)+" kB/s @"),this.onUpdated(this.statistics)}catch(t){console.error(t)}finally{t.close()}}async decode(t,e,i,s){this.codecConfigured?this.decodeWorker.postMessage({pktSize:t,pktData:e,roll:s,codec:this.codec,timestamp:i},[e.buffer]):console.warn("decoder has not been initialized yet")}destroy(){super.destroy()}async getCanvas(){return this.canvasElt}drawFrame(t){throw Error("Not supported operation")}},k=i(5),L=i.n(k);var U=class extends A{constructor(t){super({supportedLayers:["videoData"],...t}),this.directPlay=!1,this.codec="h264",this.yuvCanvas=this.createCanvas(this.width,this.height),this.domNode.appendChild(this.yuvCanvas.canvasElement),this.buf=[],this.bufferingTime=2e3}createCanvas(t,e,i){return new M({width:t,height:e,contextOptions:{preserveDrawingBuffer:!0}})}async setData(t,e){if("videoData"===e.type){const t=e.values;for(let e=0;e<t.length;e++)this.updateVideo(t[e])}}async updateVideo(t){if(!this.skipFrame)return null==this.decodeWorker&&this.initFFMPEG_DECODER_WORKER(t.frameData.compression),this.decode(t.frameData.data.length,t.frameData.data,t.timestamp,t.roll||0)}reset(){this.skipFrame=!0,this.decodeWorker.postMessage({message:"release"});let t=new Uint8Array(1);t[0]=128,this.yuvCanvas.drawNextOuptutPictureGL({yData:t,yDataPerRow:1,yRowCnt:1,uData:t,uDataPerRow:1,uRowCnt:1,vData:t,vDataPerRow:1,vRowCnt:1}),this.skipFrame=!1}initFFMPEG_DECODER_WORKER(t){this.decodeWorker=new L.a,this.decodeWorker.id=u(),this.decodeWorker.postMessage({message:"init",codec:t.toLowerCase()});const e=this;this.decodeWorker.onmessage=function(t){let i=t.data;e.drawFrame(i),this.onAfterDecoded(i,B),this.updateStatistics(i.pktSize),this.showTime&&(this.textFpsDiv.innerText=new Date(i.timestamp).toISOString()+" "),this.showStats&&(this.textStatsDiv.innerText=this.statistics.averageFps.toFixed(2)+" fps, "+(this.statistics.averageBitRate/1e3).toFixed(2)+" kB/s @"+e.yuvCanvas.width+"x"+e.yuvCanvas.height+"\n "+this.codec),this.onUpdated(this.statistics)}.bind(this)}drawFrame(t){this.yuvCanvas.canvasElement.drawing=!0,this.width===t.frame_width&&this.height===t.frame_height||(this.yuvCanvas.resize(t.frame_width,t.frame_height),this.width=t.frame_width,this.height=t.frame_height),this.yuvCanvas.drawNextOuptutPictureGL({yData:t.frameYData,yDataPerRow:t.frame_width,yRowCnt:t.frame_height,uData:t.frameUData,uDataPerRow:t.frame_width/2,uRowCnt:t.frame_height/2,vData:t.frameVData,vDataPerRow:t.frame_width/2,vRowCnt:t.frame_height/2,roll:t.roll}),this.yuvCanvas.canvasElement.drawing=!1}async decode(t,e,i,s){if(t>0){let r=e.buffer;this.decodeWorker.postMessage({message:"data",pktSize:t,pktData:r,roll:s,byteOffset:e.byteOffset,codec:this.codec,timestamp:i,dataSourceId:this.dataSourceId},[r]),e=null}}destroy(){super.destroy(),s(this.interval)&&clearInterval(this.interval),s(this.decodeWorker)&&(this.decodeWorker.postMessage({message:"release"}),this.decodeWorker.terminate())}async getCanvas(){return this.yuvCanvas.canvasElement}};var N=class extends E{constructor(t){super({supportedLayers:["videoData"],...t}),this.videoView=void 0,this.canvasResolve=void 0}createVideoView(t){"jpeg"===t?this.videoView=new P({...this.properties,layers:[]}):"useWebCodecApi"in this.properties&&this.properties.useWebCodecApi?this.videoView=new _({...this.properties,layers:[]}):this.videoView=new U({...this.properties,layers:[]}),this.hide(),this.canvasResolve&&this.canvasResolve(this.videoView.getCanvas()),this.videoView.onAfterDecoded=(t,e)=>{this.onDecode(t,e)}}async setData(t,e){if("videoData"===e.type){const t=e.values;for(let e=0;e<t.length;e++)s(this.videoView)||this.createVideoView(t[e].frameData.compression.toLowerCase()),await this.videoView.updateVideo(t[e])}}async getVideoCanvas(){if(s(this.videoView))return this.videoView.getCanvas();{const t=this;return new Promise(async e=>{t.canvasResolve=e})}}reset(){super.reset(),s(this.videoView)&&this.videoView.reset()}destroy(){console.warn("Destroying VideoView"),super.destroy(),s(this.videoView)&&this.videoView.destroy()}onDecode(t,e){}},W=i(6),V=i.n(W);var O=class{constructor(t){o(t.startTime,"startTime"),o(t.startTime,"endTime"),this.bufferingTime=1e3,this.currentTime=Date.now(),this.id=u(),this.dataSources=t.dataSources||[],this.replaySpeed=t.replaySpeed||1,this.timerResolution=t.timerResolution||5,this.masterTimeRefreshRate=t.masterTimeRefreshRate||250,this.mode=t.mode||f,this.initialized=!1,this.properties={},this.properties.replaySpeed=this.replaySpeed,this.properties.startTime=t.startTime,this.properties.endTime=t.endTime,this.eventSubscriptionMap={},this.messagesMap={}}getTopicId(){return"data-synchronizer-"+this.id}getTimeTopicId(){return"data-synchronizer-time-"+this.id}initEventSubscription(){new BroadcastChannel(this.getTopicId()).onmessage=t=>{const e=t.data.type;if(e in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[e].length;i++)this.eventSubscriptionMap[e][i](t.data)},new BroadcastChannel(this.getTimeTopicId()).onmessage=t=>{const e=t.data.type;if(e in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[e].length;i++)this.eventSubscriptionMap[e][i](t.data)}}getStartTime(){if(0===this.dataSources.length)throw"dataSource array is empty";return this.dataSources[0].properties.startTime}getEndTime(){if(0===this.dataSources.length)throw"dataSource array is empty";return this.dataSources[0].properties.endTime}getMinTime(){if(0===this.dataSources.length)throw"dataSource array is empty";return s(this.dataSources[0].properties.minTime)?this.dataSources[0].properties.minTime:this.dataSources[0].properties.startTime}getMaxTime(){if(0===this.dataSources.length)throw"dataSource array is empty";return s(this.dataSources[0].properties.maxTime)?this.dataSources[0].properties.maxTime:this.dataSources[0].properties.endTime}setMinTime(t){for(let e of this.dataSources)e.setMinTime(t)}setMaxTime(t){for(let e of this.dataSources)e.setMaxTime(t)}getReplaySpeed(){return this.replaySpeed}terminate(){null!==this.synchronizerWorker&&(this.synchronizerWorker.terminate(),this.synchronizerWorker=null);for(let t of this.dataSources)t.terminate()}subscribe(t,e){for(let i=0;i<e.length;i++)e[i]in this.eventSubscriptionMap||(this.eventSubscriptionMap[e[i]]=[]),this.eventSubscriptionMap[e[i]].push(t)}async initDataSources(){return new Promise(async(t,e)=>{try{const e=[];let i=this.mode;for(let t of this.dataSources){const s=await this.createDataSourceForWorker(t);e.push(s),i=t.mode}this.synchronizerWorker=new V.a,this.handleWorkerMessage(),await this.postMessage({message:"init",dataSources:e,replaySpeed:this.replaySpeed,timerResolution:this.timerResolution,masterTimeRefreshRate:this.masterTimeRefreshRate,startTime:this.properties.startTime,endTime:this.properties.endTime,mode:i,topics:{data:this.getTopicId(),time:this.getTimeTopicId()}},function(){this.initEventSubscription(),this.initialized=!0,t()}.bind(this),!1)}catch(t){console.log(t),e(t)}})}async createDataSourceForWorker(t){const e={bufferingTime:t.properties.bufferingTime||0,timeOut:t.properties.timeOut||0,id:t.id,name:t.name};try{await t.setDataSynchronizer(this),t.properties.replaySpeed=this.replaySpeed}catch(t){throw console.error("Cannot set the synchronizer to this DataSource",t),t}return e}async addDataSource(t,e=!1){if(e)return new Promise(async e=>{const i=await this.createDataSourceForWorker(t);this.dataSources.push(t),await this.postMessage({message:"add",dataSources:[i]}),await t.connect(),e()});this.dataSources.push(t)}async removeDataSource(t,e=!1){if(e)return new Promise(async e=>{this.dataSources=this.dataSources.filter(e=>e.id!==t.getId()),await this.postMessage({message:"remove",dataSources:[t.getId()]}),await t.disconnect(),e()});this.dataSources=this.dataSources.filter(e=>e.id!==t.getId())}async push(t,e){return new Promise(async(i,s)=>{null!==this.synchronizerWorker&&await this.postMessage({type:"data",dataSourceId:t,data:e},i)})}async connect(){await this.checkInit(),await this.doConnect()}async checkInit(){const t=this;return new Promise(async(e,i)=>{s(t.init)||(t.init=t.initDataSources()),await t.init,e()})}async doConnect(){return new Promise(async t=>{for(let t of this.dataSources)await t.connect();await this.postMessage({message:"connect"},t)})}async disconnect(){await this.reset();for(let t of this.dataSources)await t.disconnect()}async setReplaySpeed(t){return new Promise(async e=>{this.replaySpeed=t,this.properties.replaySpeed=t,await this.postMessage({message:"replay-speed",replaySpeed:t},e)})}async setTimeRange(t=this.getStartTime(),e=this.getEndTime(),i=this.getReplaySpeed(),s=!1,r=this.mode){return new Promise(async a=>{this.properties.startTime=t,this.properties.endTime=e,await this.postMessage({message:"update-properties",mode:r,replaySpeed:i,startTime:t,endTime:e},()=>{for(let a of this.dataSources)a.setTimeRange(t,e,i,s,r);this.mode=r,a()})})}async updateProperties(t){for(let e of this.dataSources)e.updateProperties(t)}async reset(){return new Promise(async t=>{await this.checkInit(),await this.postMessage({message:"reset"},t)})}async getCurrentTime(){return new Promise(async t=>{await this.postMessage({message:"current-time"},t)})}async isConnected(){for(let t of this.dataSources)if(!await t.isConnected())return!1;return!0}async postMessage(t,e,i=!0){i&&await this.checkInit();const r=u();this.synchronizerWorker.postMessage({...t,messageId:r}),s(e)&&(this.messagesMap[r]=e)}handleWorkerMessage(){this.synchronizerWorker.onmessage=t=>{const e=t.data.messageId;e in this.messagesMap&&(this.messagesMap[e](t.data.data),delete this.messagesMap[e])}}};let G=new T("drone-Video",{endpointUrl:"sensiasoft.net/sensorhub/sos",offeringID:"urn:mysos:solo:video2",observedProperty:"http://sensorml.com/ont/swe/property/VideoFrame",startTime:"2015-12-19T21:04:30Z",endTime:"2015-12-19T21:09:19Z",mode:f,tls:!0});new N({container:"video-h264-container",css:"video-h264",name:"UAV Video",showTime:!0,showStats:!0,useWebCodecApi:!0,layers:[new S({dataSourceId:G.id,getFrameData:t=>t.videoFrame,getTimestamp:t=>t.timestamp})]});new O({masterTimeRefreshRate:250,replaySpeed:1,startTime:"2015-12-19T21:04:30Z",endTime:"2015-12-19T21:09:19Z",dataSources:[G]}).connect()}]);