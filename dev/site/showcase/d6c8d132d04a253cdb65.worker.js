!function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);Math.pow(2,53);function s(e){return null!=e}function o(e,t="letiable"){if(!s(e))throw t+" must be defined";return e}function r(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}const i="connecting",c="connected",a="disconnected",h="closed-error";var l=class{constructor(e,t){this.url=e,this.properties=t,this.id="DataConnector-"+r(),this.reconnectTimeout=12e4,this.status=a,this.reconnectionInterval=-1}checkAndClearReconnection(){-1!==this.reconnectionInterval&&(clearInterval(this.reconnectionInterval),this.reconnectionInterval=-1)}disconnect(){this.checkStatus(a),this.checkAndClearReconnection()}setUrl(e){this.url=e}getId(){return this.id}getUrl(){return this.url}setReconnectTimeout(e){this.reconnectTimeout=e}onReconnect(){return!0}connect(){}forceReconnect(){this.disconnect(),this.connect()}onChangeStatus(e){}checkStatus(e){e!==this.status&&(this.onChangeStatus(e),this.status=e)}onDisconnect(){}onConnect(){}};var u=class extends l{constructor(e){super(e),this.interval=-1,this.lastReceiveTime=0}async connect(){this.init||(this.closed=!1,this.init=!0,this.ws=new WebSocket(this.getUrl()),this.ws.binaryType="arraybuffer",this.checkStatus(i),console.warn("WebSocket stream connecting"),this.ws.onopen=function(e){this.checkAndClearReconnection(),this.checkStatus(c),console.warn("WebSocket stream connected")}.bind(this),this.ws.onmessage=function(e){this.lastReceiveTime=Date.now(),e.data.byteLength>0&&this.onMessage(e.data)}.bind(this),this.ws.onerror=function(e){console.error("WebSocket stream error"),this.checkStatus(h),this.init=!1,this.lastReceiveTime=-1,this.createReconnection()}.bind(this),this.ws.onclose=e=>{console.warn("WebSocket stream closed: ",e.reason,e.code),1e3===e.code||this.closed?this.checkStatus(a):(this.checkStatus(h),this.createReconnection())},-1!==this.reconnectionInterval&&(clearInterval(this.reconnectionInterval),this.reconnectionInterval=-1))}createReconnection(){!this.closed&&-1===this.reconnectionInterval&&this.onReconnect()&&(this.reconnectionInterval=setInterval(function(){let e=Date.now()-this.lastReceiveTime;(-1===this.lastReceiveTime||e>=this.reconnectTimeout)&&(console.warn("trying to reconnect",this.url),this.init=!1,this.connect())}.bind(this),this.reconnectTimeout))}disconnect(){super.disconnect(),this.init=!1,this.closed=!0,null!=this.ws&&this.ws.readyState!==WebSocket.CLOSED&&this.ws.close()}onMessage(e){}isConnected(){return null!=this.ws&&this.ws.readyState===WebSocket.OPEN}};var d=class extends l{constructor(e,t){super(e),this.method="POST",this.responseType="arraybuffer",s(t)&&(t.method&&(this.method=t.method),t.responseType&&(this.responseType=t.responseType))}sendRequest(e,t){let n=this,o=new XMLHttpRequest;o.withCredentials=!0,o.timeout=6e4,null===e?(s(t)?o.open("GET",this.getUrl()+"?"+t,!0):o.open("GET",this.getUrl(),!0),o.responseType=this.responseType,o.onload=e=>{o.response&&n.onMessage(o.response),n.checkStatus(a)},o.ontimeout=e=>{console.log("Timeout"),n.checkStatus(a)},n.checkStatus(c),o.send(null)):(o.open("POST",this.getUrl(),!0),o.setRequestHeader("Content-Type","text/xml"),o.send(e),n.checkStatus(c),o.onreadystatechange=()=>{o.readyState<4||4===o.readyState&&(200===o.status&&o.status<300?n.onSuccess(o.responseText):n.onError(""),n.checkStatus(a))})}onError(e){}onSuccess(e){}connect(){this.sendRequest(null)}isConnected(){return!1}};var p=class extends l{constructor(e){super(e),this.lastReceiveTime=-1,this.interval=-1,this.broadcastChannel=null}connect(){null===this.broadcastChannel&&(this.broadcastChannel=new BroadcastChannel(this.getUrl()),this.broadcastChannel.onmessage=e=>{this.lastReceiveTime=Date.now(),this.onMessage(e.data.data)},this.broadcastChannel.onerror=e=>{console.error("BroadcastChannel stream error: "+e),this.broadcastChannel.close(),this.init=!1,this.lastReceiveTime=-1,this.opened=!1},this.opened=!0,-1===this.interval&&(this.interval=setInterval(function(){let e=Date.now()-this.lastReceiveTime;(-1===this.lastReceiveTime||e>=this.reconnectTimeout)&&(console.warn(`trying to reconnect after ${this.reconnectTimeout} ..`),this.reconnect())}.bind(this),this.reconnectTimeout)))}disconnect(){this.fullDisconnect(!0)}fullDisconnect(e){null!=this.broadcastChannel&&(this.broadcastChannel.close(),this.broadcastChannel=null),e&&clearInterval(this.interval),this.opened=!1}reconnect(){this.onReconnect(),this.init&&this.fullDisconnect(!1),this.connect()}onMessage(e){}close(){this.disconnect()}isConnected(){return null!==this.broadcastChannel&&this.opened}};const f="data",m="status";var v=class{constructor(e){this.parser=e,this.connector=null,this.reconnectTimeout=1e4,this.values=[],this.version=-Number.MAX_SAFE_INTEGER}createConnector(e,t,n){this.dataSourceId=n,null!==this.connector&&(this.connector.disconnect(),this.connector=null),this.broadcastChannel=new BroadcastChannel(t);const o=JSON.parse(e);s(o.bufferingTime)&&(this.bufferingTime=o.bufferingTime),s(o.timeOut)&&(this.timeOut=o.timeOut),s(o.reconnectTimeout)&&(this.reconnectTimeout=o.reconnectTimeout),"now"===o.startTime?this.batchSize=1:(s(o.replaySpeed)&&(s(o.batchSize)||(this.batchSize=1)),s(o.batchSize)&&(this.batchSize=o.batchSize)),this.properties=o,this.createDataConnector(this.properties)}createDataConnector(e){const t=this.parser.buildUrl(e);e.protocol.startsWith("ws")?this.connector=new u(t):e.protocol.startsWith("http")?(this.connector=new d(t),this.connector.responseType=e.responseType||"arraybuffer"):"topic"===e.protocol&&(this.connector=new p(t)),null!==this.connector&&(this.connector.setReconnectTimeout(this.reconnectTimeout),this.connector.onMessage=this.onMessage.bind(this),this.connector.onChangeStatus=this.onChangeStatus.bind(this))}setTopic(e){s(this.broadcastChannel)&&this.broadcastChannel.close(),this.broadcastChannel=new BroadcastChannel(e),this.topic=e}connect(){null!==this.connector&&this.connector.connect()}disconnect(){null!==this.connector&&this.connector.disconnect()}async onMessage(e){const t=await Promise.resolve(this.parser.parseData(e));if(Array.isArray(t))for(let e=0;e<t.length;e++)this.values.push({data:t[e],version:this.version}),s(this.batchSize)&&this.values.length>=this.batchSize&&this.flush();else this.values.push({data:t,version:this.version});this.isConnected()?s(this.batchSize)&&0!==this.values.length&&this.values.length>=this.batchSize&&this.flush():this.flushAll()}onChangeStatus(e){e===a&&this.flushAll(),this.broadcastChannel.postMessage({type:m,status:e,dataSourceId:this.dataSourceId})}updateProperties(e){this.disconnect(),this.createDataConnector({...this.properties,...e}),this.version++,this.connect()}flushAll(){for(;this.values.length>0;)this.flush()}flush(){let e=this.values.length;s(this.batchSize)&&this.values.length>this.batchSize&&(e=this.batchSize),this.broadcastChannel.postMessage({dataSourceId:this.dataSourceId,type:f,values:this.values.splice(0,e)})}isConnected(){return null!==this.connector&&this.connector.isConnected()}handleMessage(e,t){"init"===e.message?this.createConnector(e.properties,e.topic,e.id):"connect"===e.message?this.connect():"disconnect"===e.message?this.disconnect():"topic"===e.message?this.setTopic(e.topic):"update-url"===e.message?this.updateProperties(e.data):"is-connected"===e.message&&t.postMessage({message:"is-connected",data:this.isConnected()})}};var b=class{buildUrl(e){let t="";if(t+=e.protocol+"://",t+=e.endpointUrl+"?",t+="service="+e.service,t+="&version=2.0&",e.responseFormat&&(t+="&responseFormat="+e.responseFormat),s(e.customUrlParams)&&Object.keys(e.customUrlParams).length>0){t+="&";for(let n in e.customUrlParams)t+=n+"="+e.customUrlParams[n]+"&";t.endsWith("&")&&(t=t.slice(0,-1))}return t}};class g{constructor(e="undefined"){this.originalXml=e}setXml(e){this.originalXml=e}static get arrayNodeSet(){return new Set(["featureMember","offering","observableProperty","field","coordinate","item","quality","member","interval","AllowedValues/value"])}static get numericalNodeSet(){return new Set(["nilValue","paddingBytes-after","paddingBytes-before","byteLength","significantBits","bitLength","Time/value","Quantity/value","Count/value"])}toJson(){var e=this.originalXml,t={}.pos||0,n="<".charCodeAt(0),s=">".charCodeAt(0),o="-".charCodeAt(0),r="/".charCodeAt(0),i="!".charCodeAt(0),c="'".charCodeAt(0),a='"'.charCodeAt(0),h=g.arrayNodeSet,l=g.numericalNodeSet;function u(e){return h.has(e)}function d(){var n=t;return-2===(t=e.indexOf("<",t)-1)&&(t=e.length),e.slice(n,t+1)}function p(){for(var n=t;-1==="\n\t>/= ".indexOf(e[t])&&e[t];)t++;return e.slice(n,t)}function f(e){var t=e.indexOf(":");return t>0?e.substring(t+1):e}function m(){var h={};for(t++,h.type=f(p());e.charCodeAt(t)!==s&&e[t];){var b=e.charCodeAt(t);if(b>64&&b<91||b>96&&b<123){for(var g=p(),C=f(g),S=e.charCodeAt(t);S&&S!==c&&S!==a&&!(S>64&&S<91||S>96&&S<123)&&S!==s;)t++,S=e.charCodeAt(t);if(S===c||S===a){var y=v();if(-1===t)return h}else y=null,t--;g.startsWith("xmlns:")||(h[C]=y)}t++}return e.charCodeAt(t-1)!==r?(t++,function(c){for(;e[t];)if(e.charCodeAt(t)==n){if(e.charCodeAt(t+1)===r)return void((t=e.indexOf(">",t))+1&&(t+=1));if(e.charCodeAt(t+1)===i){if(e.charCodeAt(t+2)==o){for(;-1!==t&&(e.charCodeAt(t)!==s||e.charCodeAt(t-1)!=o||e.charCodeAt(t-2)!=o||-1==t);)t=e.indexOf(">",t+1);-1===t&&(t=e.length)}else for(t+=2;e.charCodeAt(t)!==s&&e[t];)t++;t++;continue}var a=m(),h=a.type;if("type"===h)continue;var p=h.charAt(0)==h.charAt(0).toLowerCase();if(p&&a.hasOwnProperty("value"))u(h)?(c.hasOwnProperty(h)||(c[h]=[]),c[h].push(a.value)):c[h]=a.value;else{if(p)for(var f in delete a.type,a)"object"==typeof a[f]&&"name"!==f&&(Object.assign(a,a[f]),delete a[f]);u(h)?(c.hasOwnProperty(h)||(c[h]=[]),c[h].push(a)):c[h]=a}}else{var v=d();v.trim().length>0&&(l.has(c.type)?c.value=parseFloat(v):c.value=v),t++}}(h)):t++,h}function v(){var n=e[t],s=++t;return t=e.indexOf(n,s),e.slice(s,t)}var b=m();return b.pos=t,b}}var C=g;const S=new v(new class extends b{async parseData(e){let t=new C(e);t.setXml(e);const n=t.toJson();return o(n.GetFeatureOfInterestResponse,"json.GetFeatureOfInterestResponse does not exist"),o(n.GetFeatureOfInterestResponse.featureMember,"json.GetFeatureOfInterestResponse.featureMember does not exist"),n.GetFeatureOfInterestResponse.featureMember}buildUrl(e){let t=super.buildUrl({responseFormat:"application/xml",...e});return t+="&request=GetFeatureOfInterest",s(e.procedureId)&&(t+="&procedure="+e.procedureId),t}});self.onmessage=e=>{S.handleMessage(e.data,self)}}]);