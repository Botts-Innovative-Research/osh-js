!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){e.exports=function(){return new Worker(r.p+"WorkerName.29269d1a5378f5ecadd1.js")}},function(e,t,r){e.exports=function(){return new Worker(r.p+"WorkerName.03861611935887e8ded3.js")}},function(e,t,r){e.exports=function(){return new Worker(r.p+"WorkerName.d2332a2c4a88cc438914.js")}},function(e,t,r){"use strict";r.r(t);const i=document.getElementById("datasource-gps"),n=document.getElementById("datasource-orientation"),s=document.getElementById("datasource-video"),o=document.getElementById("error"),a=document.getElementById("last-gps"),c=document.getElementById("last-orient"),u=document.getElementById("last-video"),p=document.getElementById("current-time");let d=0,h=0,m=0,l=0;const S="data",g="time";Math.pow(2,53);function y(e){return null!=e}function f(e,t="letiable"){if(!y(e))throw t+" must be defined";return e}function T(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}const b="disconnected";var v=class{constructor(e,t,r){this.id="DataSource-"+T(),this.name=e,this.properties=t,this.dataSourceWorker=r,this.currentRunningProperties={},this.eventSubscriptionMap={},this.initDataSource(t)}initDataSource(e){this.dataSourceWorker.postMessage({message:"init",id:this.id,properties:JSON.stringify(e),topic:this.getTopicId()});new BroadcastChannel(this.getTopicId()).onmessage=e=>{const t=e.data.type;if(t in this.eventSubscriptionMap)for(let r=0;r<this.eventSubscriptionMap[t].length;r++)this.eventSubscriptionMap[t][r](e.data)}}disconnect(){this.dataSourceWorker.postMessage({message:"disconnect"})}onDisconnect(){return new Promise(e=>{new BroadcastChannel(this.getTopicId()).onmessage=t=>{t.data.status===b&&e()}})}async connect(){return this.dataSourceWorker.postMessage({message:"connect"}),this.isConnected()}async isConnected(){const e=new Promise(e=>{null!==this.dataSourceWorker&&(this.dataSourceWorker.onmessage=t=>{"is-connected"===t.data.message&&e(t.data.data)})});return null!==this.dataSourceWorker&&this.dataSourceWorker.postMessage({message:"is-connected"}),e}getId(){return this.id}getName(){return this.name}updateProperties(e){this.currentRunningProperties={...this.properties,...e},null!==this.dataSourceWorker&&this.dataSourceWorker.postMessage({message:"update-url",data:e})}getCurrentRunningProperties(){return this.currentRunningProperties}terminate(){null!==this.dataSourceWorker&&this.dataSourceWorker.terminate()}getTopicId(){return"datasource-data-"+this.id}getVersion(){return 0}subscribe(e,t){for(let r=0;r<t.length;r++)t[r]in this.eventSubscriptionMap||(this.eventSubscriptionMap[t[r]]=[]),this.eventSubscriptionMap[t[r]].push(e)}};var x=class extends v{constructor(e,t,r){super(e,t,r),f(t,"Some properties must be defined"),f(t.startTime,"startTime must must be defined"),f(t.endTime,"startTime must must be defined"),this.timeSync=null}setDataSynchronizer(e){this.timeSync=e,this.dataSourceWorker.postMessage({message:"topic",topic:"data-synchronizer-"+this.timeSync.id,timeTopic:this.getTimeTopicId()})}initDataSource(e){super.initDataSource(e),this.dataSourceWorker.postMessage({message:"topic",topic:this.getTopicId(),timeTopic:this.getTimeTopicId()});new BroadcastChannel(this.getTimeTopicId()).onmessage=e=>{const t=e.data.type;if(t in this.eventSubscriptionMap)for(let r=0;r<this.eventSubscriptionMap[t].length;r++)this.eventSubscriptionMap[t][r](e.data)}}setTimeRange(e,t,r,i=!1){let n={};y(r)&&(n={replaySpeed:r}),this.updateProperties({...this.currentRunningProperties,startTime:e,endTime:t,...n,reconnect:i})}getStartTime(){return this.properties.startTime}getEndTime(){return this.properties.endTime}getMinTime(){return this.properties.minTime}getMaxTime(){return this.properties.maxTime}getReplaySpeed(){return y(this.currentRunningProperties)&&y(this.currentRunningProperties.replaySpeed)?this.currentRunningProperties.replaySpeed:y(this.properties.replaySpeed)?this.properties.replaySpeed:1}async getCurrentTime(){if(y(this.timeSync))return this.timeSync.getCurrentTime();{const e=new Promise(e=>{null!==this.dataSourceWorker&&(this.dataSourceWorker.onmessage=t=>{"last-timestamp"===t.data.message&&e(t.data.data)})});return null!==this.dataSourceWorker&&this.dataSourceWorker.postMessage({message:"last-timestamp"}),e}}updateProperties(e){super.updateProperties(e)}getTimeTopicId(){return"datasource-time-"+this.id}},w=r(0),k=r.n(w);var W=class extends x{constructor(e,t){super(e,{timeShift:0,reconnectTimeout:5e3,...t},new k.a)}},M=r(1),I=r.n(M);var O=class extends x{constructor(e,t){super(e,{timeShift:0,reconnectTimeout:5e3,...t},new I.a)}},P=r(2),z=r.n(P);var D=class{constructor(e){if(!y(e.dataSources))throw"You must specify a dataSource array";this.bufferingTime=1e3,this.currentTime=Date.now(),this.id=T(),this.dataSources=[],this.replaySpeed=1,this.timerResolution=5,this.initialized=!1,y(e.replaySpeed)&&(this.replaySpeed=e.replaySpeed),y(e.timerResolution)&&(this.timerResolution=e.timerResolution),this.initWorker(e.dataSources,this.timerResolution),this.properties={},this.properties.replaySpeed=this.replaySpeed,this.eventSubscriptionMap={},this.initEventSubscription()}initWorker(e,t){const r=[];for(let t of e){const e=this.createDataSourceForWorker(t);r.push(e),this.dataSources.push(t)}this.synchronizerWorker=new z.a,this.synchronizerWorker.onmessage=e=>{"initialized"===e.data.message&&(this.initialized=!0,console.log("datasynchronizer initialized"))},this.synchronizerWorker.postMessage({message:"init",dataSources:r,replaySpeed:this.replaySpeed,timerResolution:t,dataTopic:this.getTopicId(),timeTopic:this.getTimeTopicId()})}initEventSubscription(){new BroadcastChannel(this.getTopicId()).onmessage=e=>{const t=e.data.type;if(t in this.eventSubscriptionMap)for(let r=0;r<this.eventSubscriptionMap[t].length;r++)this.eventSubscriptionMap[t][r](e.data)},new BroadcastChannel(this.getTimeTopicId()).onmessage=e=>{const t=e.data.type;if(t in this.eventSubscriptionMap)for(let r=0;r<this.eventSubscriptionMap[t].length;r++)this.eventSubscriptionMap[t][r](e.data)}}createDataSourceForWorker(e){const t={bufferingTime:e.properties.bufferingTime||0,timeOut:e.properties.timeOut||0,id:e.id,name:e.name};try{e.setDataSynchronizer(this),e.properties.replaySpeed=this.replaySpeed}catch(e){console.error("Cannot set the synchronizer to this DataSource",e)}return t}addDataSource(e){const t=this.createDataSourceForWorker(e);this.dataSources.push(e),this.synchronizerWorker.postMessage({message:"add",dataSources:[t]})}push(e,t){null!==this.synchronizerWorker&&this.synchronizerWorker.postMessage({type:"data",dataSourceId:e,data:t})}connect(){let e=()=>{this.initialized?this.doConnect():setTimeout(e,100)};e()}doConnect(){for(let e of this.dataSources)e.connect()}disconnect(){this.reset();for(let e of this.dataSources)e.disconnect()}getStartTime(){if(0===this.dataSources.length)throw"dataSource array is empty";return this.dataSources[0].currentRunningProperties.startTime}getEndTime(){if(0===this.dataSources.length)throw"dataSource array is empty";return this.dataSources[0].currentRunningProperties.endTime}getMinTime(){if(0===this.dataSources.length)throw"dataSource array is empty";return y(this.dataSources[0].properties.minTime)?this.dataSources[0].properties.minTime:this.dataSources[0].properties.startTime}getMaxTime(){if(0===this.dataSources.length)throw"dataSource array is empty";return y(this.dataSources[0].properties.maxTime)?this.dataSources[0].properties.maxTime:this.dataSources[0].properties.endTime}getReplaySpeed(){return this.replaySpeed}setReplaySpeed(e){this.replaySpeed=e,this.properties.replaySpeed=e,this.synchronizerWorker.postMessage({message:"replay-speed",replaySpeed:e})}setTimeRange(e,t,r,i=!1){this.replaySpeed!==r&&this.setReplaySpeed(r),this.reset();for(let n of this.dataSources)n.setTimeRange(e,t,r,i)}reset(){null!==this.synchronizerWorker&&this.synchronizerWorker.postMessage({message:"reset"})}terminate(){null!==this.synchronizerWorker&&(this.synchronizerWorker.terminate(),this.synchronizerWorker=null);for(let e of this.dataSources)e.terminate()}async getCurrentTime(){const e=new Promise(e=>{null!==this.synchronizerWorker&&(this.synchronizerWorker.onmessage=t=>{"current-time"===t.data.message&&e(t.data.data)})});return null!==this.synchronizerWorker&&this.synchronizerWorker.postMessage({message:"current-time"}),e}getTopicId(){return"data-synchronizer-"+this.id}getTimeTopicId(){return"data-synchronizer-time-"+this.id}async isConnected(){for(let e of this.dataSources)if(!await e.isConnected())return!1;return!0}subscribe(e,t){for(let r=0;r<t.length;r++)t[r]in this.eventSubscriptionMap||(this.eventSubscriptionMap[t[r]]=[]),this.eventSubscriptionMap[t[r]].push(e)}};const R="2015-12-19T21:04:29.231Z",C="2015-12-19T21:09:19.675Z",B=new O("drone-Video",{protocol:"ws",service:"SOS",endpointUrl:"sensiasoft.net:8181/sensorhub/sos",offeringID:"urn:mysos:solo:video2",observedProperty:"http://sensorml.com/ont/swe/property/VideoFrame",startTime:R,endTime:C,replaySpeed:100,bufferingTime:500,timeOut:1e3}),E=new W("android-GPS",{protocol:"ws",service:"SOS",endpointUrl:"sensiasoft.net:8181/sensorhub/sos",offeringID:"urn:mysos:solo:nav2",observedProperty:"http://www.opengis.net/def/property/OGC/0/PlatformLocation",startTime:R,endTime:C,replaySpeed:100,bufferingTime:500,timeOut:1e3}),N=new W("android-Heading",{protocol:"ws",service:"SOS",endpointUrl:"sensiasoft.net:8181/sensorhub/sos",offeringID:"urn:mysos:solo:nav2",observedProperty:"http://www.opengis.net/def/property/OGC/0/PlatformOrientation",startTime:R,endTime:C,replaySpeed:100,bufferingTime:500,timeOut:1e3}),j=new D({replaySpeed:100,timerResolution:5,dataSources:[B,E,N]});j.connect(),B.subscribe(e=>function(e){let t;for(let r=0;r<e.length;r++)t=e[r],t.data.frameData=e[r].data.frameData.slice(0,10),++m%1e3==0?s.value=JSON.stringify([t])+"\n":s.value+=JSON.stringify([t])+"\n";u.innerText=new Date(e[e.length-1].timeStamp).toISOString()+" - Video",p.innerText=new Date(e[e.length-1].timeStamp).toISOString()+" - Current"}(e.values),[S]),E.subscribe(e=>{return t=e.values,++d%100==0?i.value=JSON.stringify(t)+"\n":i.value+=JSON.stringify(t)+"\n",a.innerText=new Date(t[t.length-1].timeStamp).toISOString()+" - Location",void(p.innerText=new Date(t[t.length-1].timeStamp).toISOString()+" - Current");var t},[S]),N.subscribe(e=>{return t=e.values,++h%100==0?n.value=JSON.stringify(t)+"\n":n.value+=JSON.stringify(t)+"\n",c.innerText=new Date(t[t.length-1].timeStamp).toISOString()+" - Orientation",void(p.innerText=new Date(t[t.length-1].timeStamp).toISOString()+" - Current");var t},[S]),j.subscribe(e=>{return(t=e.timestamp)<l&&(o.value+=new Date(t).toISOString()+" < "+new Date(l).toISOString()+"\n"),void(l=t);var t},[g]),j.connect()}]);