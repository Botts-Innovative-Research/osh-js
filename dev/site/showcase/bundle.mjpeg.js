!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=6)}([function(e,t,s){e.exports=function(){return new Worker(s.p+"WorkerName.64e494d98c9dfda4c59e.js")}},function(e,t,s){e.exports=function(){return new Worker(s.p+"WorkerName.8173c0c5d8ed7ab66023.js")}},function(e,t,s){var i=s(3),n=s(4);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var r={insert:"head",singleton:!1},a=(i(n,r),n.locals?n.locals:{});e.exports=a},function(e,t,s){"use strict";var i,n=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},r=function(){var e={};return function(t){if(void 0===e[t]){var s=document.querySelector(t);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}e[t]=s}return e[t]}}(),a=[];function o(e){for(var t=-1,s=0;s<a.length;s++)if(a[s].identifier===e){t=s;break}return t}function c(e,t){for(var s={},i=[],n=0;n<e.length;n++){var r=e[n],c=t.base?r[0]+t.base:r[0],d=s[c]||0,u="".concat(c," ").concat(d);s[c]=d+1;var h=o(u),p={css:r[1],media:r[2],sourceMap:r[3]};-1!==h?(a[h].references++,a[h].updater(p)):a.push({identifier:u,updater:y(p,t),references:1}),i.push(u)}return i}function d(e){var t=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var n=s.nc;n&&(i.nonce=n)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(t);else{var a=r(e.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}return t}var u,h=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function p(e,t,s,i){var n=s?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=h(t,n);else{var r=document.createTextNode(n),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(r,a[t]):e.appendChild(r)}}function l(e,t,s){var i=s.css,n=s.media,r=s.sourceMap;if(n?e.setAttribute("media",n):e.removeAttribute("media"),r&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var m=null,f=0;function y(e,t){var s,i,n;if(t.singleton){var r=f++;s=m||(m=d(t)),i=p.bind(null,s,r,!1),n=p.bind(null,s,r,!0)}else s=d(t),i=l.bind(null,s,t),n=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(s)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else n()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=n());var s=c(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<s.length;i++){var n=o(s[i]);a[n].references--}for(var r=c(e,t),d=0;d<s.length;d++){var u=o(s[d]);0===a[u].references&&(a[u].updater(),a.splice(u,1))}s=r}}}},function(e,t,s){(t=s(5)(!1)).push([e.i,".osh-view {\n    width:100%;\n    height: 100%;\n}\n",""]),e.exports=t},function(e,t,s){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var s=function(e,t){var s=e[1]||"",i=e[3];if(!i)return s;if(t&&"function"==typeof btoa){var n=(a=i,o=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(c," */")),r=i.sources.map((function(e){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(e," */")}));return[s].concat(r).concat([n]).join("\n")}var a,o,c;return[s].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(s,"}"):s})).join("")},t.i=function(e,s,i){"string"==typeof e&&(e=[[null,e,""]]);var n={};if(i)for(var r=0;r<this.length;r++){var a=this[r][0];null!=a&&(n[a]=!0)}for(var o=0;o<e.length;o++){var c=[].concat(e[o]);i&&n[c[0]]||(s&&(c[2]?c[2]="".concat(s," and ").concat(c[2]):c[2]=s),t.push(c))}},t}},function(e,t,s){"use strict";s.r(t);Math.pow(2,53);function i(e){return null!=e}function n(e){return i(e)&&null!==e}function r(e,t){return n(e)&&typeof e===t}function a(e,t="letiable"){if(!i(e))throw t+" must be defined";return e}function o(e,t="letiable"){if(!i(e)||!e)throw t;return e}function c(e,t,s="letiable"){if(a(e,s),typeof e!==t)throw s+" must be of type "+t;return e}function d(e,t="letiable"){if(a(e,t),!Array.isArray(e))throw t+" must be an array";return e}function u(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}const h="closed-error";var p=class{constructor(e,t){this.id="DataSource-"+u(),this.name=e,this.properties=t,this.currentRunningProperties={},this.eventSubscriptionMap={},this.initialized=!1,this.init=void 0,this.messagesMap={}}getId(){return this.id}getName(){return this.name}getCurrentRunningProperties(){return this.currentRunningProperties}terminate(){null!==this.dataSourceWorker&&this.dataSourceWorker.terminate()}getTopicId(){return"datasource-data-"+this.id}getVersion(){return 0}subscribe(e,t){for(let s=0;s<t.length;s++)t[s]in this.eventSubscriptionMap||(this.eventSubscriptionMap[t[s]]=[]),this.eventSubscriptionMap[t[s]].push(e)}async createWorker(e){}async updateProperties(e){return this.currentRunningProperties={...this.properties,...e},new Promise(t=>{this.postMessage({message:"update-url",data:e},t)})}async connect(){await this.checkInit(),await this.doConnect()}async initDataSource(){return new Promise(async e=>{this.dataSourceWorker=await this.createWorker(this.properties),this.handleWorkerMessage(),this.postMessage({message:"init",id:this.id,properties:this.properties,topic:this.getTopicId()},async t=>{new BroadcastChannel(this.getTopicId()).onmessage=async e=>{this.handleMessage(e)},this.initialized=t,e()})})}async handleMessage(e){const t=e.data.type;if(t in this.eventSubscriptionMap)for(let s=0;s<this.eventSubscriptionMap[t].length;s++)this.eventSubscriptionMap[t][s](e.data)}async checkInit(){return new Promise(async(e,t)=>{i(this.init)||(this.init=this.initDataSource()),await this.init,e()})}async doConnect(){return new Promise(async e=>{this.postMessage({message:"connect"},e)})}async isConnected(){return new Promise(async e=>{await this.checkInit(),this.postMessage({message:"is-connected"},e)})}async disconnect(){return new Promise(async e=>{await this.checkInit(),this.postMessage({message:"disconnect"},e)})}postMessage(e,t){const s=u();this.dataSourceWorker.postMessage({...e,messageId:s}),i(t)&&(this.messagesMap[s]=t)}handleWorkerMessage(){this.dataSourceWorker.onmessage=e=>{const t=e.data.messageId;t in this.messagesMap&&(this.messagesMap[t](e.data.data),delete this.messagesMap[t])}}async onDisconnect(){}reset(){}};var l=class extends p{constructor(e,t){super(e,t),a(t,"Some properties must be defined"),a(t.startTime,"startTime must must be defined"),a(t.endTime,"startTime must must be defined"),this.timeSync=null}getTimeTopicId(){return"datasource-time-"+this.id}getStartTime(){return this.properties.startTime}getEndTime(){return this.properties.endTime}getMinTime(){return this.properties.minTime}getMaxTime(){return this.properties.maxTime}getReplaySpeed(){return i(this.currentRunningProperties)&&i(this.currentRunningProperties.replaySpeed)?this.currentRunningProperties.replaySpeed:i(this.properties.replaySpeed)?this.properties.replaySpeed:1}async setDataSynchronizer(e){return new Promise(async(t,s)=>{await this.checkInit();const i="data-synchronizer-"+e.id;this.timeSync=e,this.postMessage({message:"topic",topic:i,timeTopic:this.getTimeTopicId()},t)})}async initDataSource(e){return await super.initDataSource(e),new Promise(async e=>{this.postMessage({message:"topic",topic:this.getTopicId(),timeTopic:this.getTimeTopicId()},async()=>{new BroadcastChannel(this.getTimeTopicId()).onmessage=async e=>{this.handleTimeMessage(e)},e()})})}async handleTimeMessage(e){const t=e.data.type;if(t in this.eventSubscriptionMap)for(let s=0;s<this.eventSubscriptionMap[t].length;s++)this.eventSubscriptionMap[t][s](e.data)}async setTimeRange(e,t,s,n=!1){let r={};return i(s)&&(r={replaySpeed:s}),this.updateProperties({...this.currentRunningProperties,startTime:e,endTime:t,...r,reconnect:n})}async getCurrentTime(){return i(this.timeSync)?this.timeSync.getCurrentTime():new Promise(e=>{this.postMessage({message:"last-timestamp"},e)})}},m=s(0),f=s.n(m);s(1);var y=class extends l{constructor(e,t){super(e,{timeShift:0,reconnectTimeout:5e3,tls:!1,...t})}async createWorker(e){return new f.a}};s(2);const g="data",v="status",S="time-changed";var b=class{constructor(e){this.properties=e,this.dataSourcesToFn=void 0,this.data=[],this.props={},this.props.id="layer-"+u(),this.props.name="",this.props.description="",this.props.dataSourceId="",this.props.visible=!0,this.props.filter=!0,i(e.name)&&(this.props.name=e.name),i(e.description)&&(this.props.description=e.description),i(e.dataSourceId)&&(this.props.dataSourceId=e.dataSourceId),i(e.visible)&&(this.props.visible=e.visible),this.initEvents();const t=this;if(this.checkFn("filter")){let e=function(e,s,i){t.props.filter=t.getFunc("filter")(e,s,i)};this.addFn(t.getDataSourcesIdsByProperty("filter"),e)}else{this.properties.filter=function(e,t,s){return!0};let e=async function(e,s,i){t.props.filter=await t.getFunc("filter")(e,s,i)};this.addFn(t.getDataSourcesIdsByProperty("filter"),e)}if(this.checkFn("getVisible")){let e=async function(e,s,i){t.props.visible=await t.getFunc("getVisible")(e,s,i)};this.addFn(t.getDataSourcesIdsByProperty("getVisible"),e)}}saveState(){this.initialState={...this.props}}restoreState(){this.props={...this.initialState}}getFunc(e){return this.properties[e].handler||this.properties[e]}checkFn(e){let t=this.properties[e];if(r(t,"function"))return a(this.properties.dataSourceId,"dataSourceId"),!0;{let s=n(t);return s&&(d(t.dataSourceIds,e+".dataSourceIds"),function(e,t){c(e,"function",t)}(t.handler,e+".handler")),s}}initEvents(){}clear(){}getId(){return this.id}select(e){}addFn(e,t){i(this.dataSourcesToFn)||(this.dataSourcesToFn={});for(let s=0;s<e.length;s++){let n=e[s];i(this.dataSourcesToFn[n])||(this.dataSourcesToFn[n]=[]),this.dataSourcesToFn[n].push(t)}}async setData(e,t,s={}){if(this.data=[],s.dataSourceId=e,i(this.dataSourcesToFn)&&e in this.dataSourcesToFn){let i=this.dataSourcesToFn[e];for(let e=0;e<t.length;e++){for(let n=0;n<i.length&&(await i[n](t[e].data,t[e].timeStamp,s),this.props.filter);n++);this.props.filter&&this.data.push({...this.props})}}}getDataSourcesIds(){if(i(this.dataSourcesToFn)){let e=[];for(let t in this.dataSourcesToFn)e.push(t);return e}return a(this.properties.dataSourceId,"dataSourceId must be defined"),[this.properties.dataSourceId]}getDataSourcesIdsByProperty(e){return this.properties[e].dataSourceIds||[this.properties.dataSourceId]}init(){}getProps(){return{type:this.type,values:this.data}}reset(){this.restoreState()}};var I=class extends b{constructor(e){super(e),this.type="data"}async setData(e,t,s){this.props.data=t}getProps(){return{type:this.type,values:this.props.data}}};var T=class{constructor(e){this.layers=[],this.lastRec={},this.dataSources=[],this.id="view-"+u(),this.css="",i(e)&&i(e.css)&&(this.css=e.css),a(e&&e.supportedLayers,"supportedLayers"),d(e.supportedLayers,"supportedLayers"),o(e.supportedLayers.length>0,"supportedLayers.length === 0"),this.supportedLayers=e.supportedLayers,this.init(e)}init(e){this.properties=e,this.elementDiv=document.createElement("div"),this.elementDiv.setAttribute("id",this.id),this.elementDiv.setAttribute("class",this.css+" osh-view"),this.divId=this.id;let t=i(e.container)?e.container:document.body,s=document.getElementById(t);if(i(s)&&null!==s?(s.appendChild(this.elementDiv),this.container=s):(document.body.appendChild(this.elementDiv),this.hide(),this.container=document.body),this.beforeAddingItems(e),i(e)){if(i(e.layers))for(let t=0;t<e.layers.length;t++)this.addLayer(e.layers[t]);i(e.dataSourceId)&&this.addLayer(new I({dataSourceId:e.dataSourceId})),i(e.visible)&&(document.getElementById(this.divId).style.display=e.visible?"block":"none")}const n=this;new MutationObserver(e=>{e.forEach((function(e){"style"===e.attributeName&&n.onResize()}))}).observe(this.elementDiv,{attributes:!0});new MutationObserver((function(e){i(document.getElementById(n.divId))||(this.disconnect(),n.destroy())})).observe(document.body,{childList:!0})}hide(){this.elementDiv.style.display="none"}onResize(){}attachTo(e){i(this.elementDiv.parentNode)&&this.elementDiv.parentNode.removeChild(this.elementDiv),document.getElementById(e).appendChild(this.elementDiv),"none"===this.elementDiv.style.display&&(this.elementDiv.style.display="block"),this.onResize()}beforeAddingItems(e){}getId(){return this.id}getDivId(){return this.divId}setData(e,t){}show(e){}destroy(){}addLayer(e){o(this.supportedLayers.includes(e.type),"this layer is not supported: "+e.type+", should be "+this.supportedLayers),this.layers.push(e);let t=e.getDataSourcesIds();for(let s=0;s<t.length;s++){const i=t[s];let n=this;new BroadcastChannel("datasource-data-"+i).onmessage=async t=>{if(t.data.type===v&&t.data.status===h)n.reset();else if(t.data.type===g){const s=this;e.setData(i,t.data.values).then(()=>{s.setData(i,e.getProps()),n.lastRec[i]=t.data})}};new BroadcastChannel("datasource-time-"+i).onmessage=e=>{e.data.type===S&&n.reset()}}}removeAllFromLayer(e){if(this.layers.includes(e)){for(let t in e.dataSourcesToFn)delete this.lastRec[t];e.reset()}}removeAllFromLayers(){for(let e of this.layers)this.removeAllFromLayer(e)}getDataSourcesId(){let e=[];for(let t=0;t<this.layers.length;t++){let s=this.layers[t];e=e.concat(s.getDataSourcesIds())}return e}reset(){this.removeAllFromLayers()}};var w=class extends T{constructor(e){if(super({supportedLayers:["data"],...e}),this.timeStamp=null,i(e.showTime)&&e.showTime&&(this.timeStamp=document.createElement("div"),this.timeStamp.setAttribute("class","video-time"),document.getElementById(this.divId).appendChild(this.timeStamp)),this.imgTag=document.createElement("img"),this.imgTag.setAttribute("class","video-mjpeg"),this.rotation=0,void 0!==e&&void 0!==e.rotation){this.rotation=e.rotation*Math.PI/180,this.canvas=document.createElement("canvas"),this.canvas.width=640,this.canvas.height=480;var t=this.canvas.getContext("2d");t.translate(0,480),t.rotate(this.rotation),document.getElementById(this.divId).appendChild(this.canvas)}else document.getElementById(this.divId).appendChild(this.imgTag)}async setData(e,t){const s=t.values;for(let e=0;e<s.length;e++){const e=s.shift();let t=new Blob([e.data.frameData]),i=window.URL.createObjectURL(t),n=this.imgTag.src;this.imgTag.src=i,null!==this.timeStamp&&(this.timeStamp.innerHTML=new Date(e.timeStamp).toISOString()),window.URL.revokeObjectURL(n)}}selectDataView(e,t){e.indexOf(this.dataSourceId)>-1||i(this.entity)&&this.entity.getId()===t?document.getElementById(this.divId).setAttribute("class",this.css+" "+this.cssSelected):document.getElementById(this.divId).setAttribute("class",this.css)}reset(){this.imgTag.src=""}};let x=new y("android-Video",{protocol:"ws",service:"SOS",endpointUrl:"sensiasoft.net:8181/sensorhub/sos",offeringID:"urn:android:device:060693280a28e015-sos",observedProperty:"http://sensorml.com/ont/swe/property/VideoFrame",startTime:"2015-02-16T07:58:35Z",endTime:"2015-02-16T08:09:00Z",replaySpeed:3});new w({container:"video-mjpeg-container",css:"video-mjpeg",name:"Android Video",keepRatio:!0,showTime:!0,dataSourceId:x.id});x.connect()}]);