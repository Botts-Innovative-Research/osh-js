!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=9)}([function(t,e,i){"use strict";var s,r=function(){return void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s},n=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}(),a=[];function o(t){for(var e=-1,i=0;i<a.length;i++)if(a[i].identifier===t){e=i;break}return e}function c(t,e){for(var i={},s=[],r=0;r<t.length;r++){var n=t[r],c=e.base?n[0]+e.base:n[0],d=i[c]||0,h="".concat(c," ").concat(d);i[c]=d+1;var u=o(h),p={css:n[1],media:n[2],sourceMap:n[3]};-1!==u?(a[u].references++,a[u].updater(p)):a.push({identifier:h,updater:g(p,e),references:1}),s.push(h)}return s}function d(t){var e=document.createElement("style"),s=t.attributes||{};if(void 0===s.nonce){var r=i.nc;r&&(s.nonce=r)}if(Object.keys(s).forEach((function(t){e.setAttribute(t,s[t])})),"function"==typeof t.insert)t.insert(e);else{var a=n(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var h,u=(h=[],function(t,e){return h[t]=e,h.filter(Boolean).join("\n")});function p(t,e,i,s){var r=i?"":s.media?"@media ".concat(s.media," {").concat(s.css,"}"):s.css;if(t.styleSheet)t.styleSheet.cssText=u(e,r);else{var n=document.createTextNode(r),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(n,a[e]):t.appendChild(n)}}function l(t,e,i){var s=i.css,r=i.media,n=i.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),n&&btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),t.styleSheet)t.styleSheet.cssText=s;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(s))}}var f=null,m=0;function g(t,e){var i,s,r;if(e.singleton){var n=m++;i=f||(f=d(e)),s=p.bind(null,i,n,!1),r=p.bind(null,i,n,!0)}else i=d(e),s=l.bind(null,i,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return s(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;s(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=r());var i=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var s=0;s<i.length;s++){var r=o(i[s]);a[r].references--}for(var n=c(t,e),d=0;d<i.length;d++){var h=o(i[d]);0===a[h].references&&(a[h].updater(),a.splice(h,1))}i=n}}}},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",s=t[3];if(!s)return i;if(e&&"function"==typeof btoa){var r=(a=s,o=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(c," */")),n=s.sources.map((function(t){return"/*# sourceURL=".concat(s.sourceRoot||"").concat(t," */")}));return[i].concat(n).concat([r]).join("\n")}var a,o,c;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i,s){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(s)for(var n=0;n<this.length;n++){var a=this[n][0];null!=a&&(r[a]=!0)}for(var o=0;o<t.length;o++){var c=[].concat(t[o]);s&&r[c[0]]||(i&&(c[2]?c[2]="".concat(i," and ").concat(c[2]):c[2]=i),e.push(c))}},e}},function(t,e,i){t.exports=function(){return new Worker(i.p+"WorkerName.4080b64c659b90da1edd.js")}},function(t,e,i){t.exports=function(){return new Worker(i.p+"WorkerName.50ffea08a031d6e46710.js")}},function(t,e,i){t.exports=function(){return new Worker(i.p+"WorkerName.d24f0b97e0fa1688214a.js")}},function(t,e,i){var s=i(0),r=i(6);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var n={insert:"head",singleton:!1},a=(s(r,n),r.locals?r.locals:{});t.exports=a},function(t,e,i){(e=i(1)(!1)).push([t.i,".ffmpeg-info{\n    position:absolute;\n    font-size: 12px;\n    color:#FFFFFF;\n    padding:2px;\n    font-weight: bold;\n    background-color: rgba(0, 0, 0, 0.3);\n    box-shadow: 2px 2px 2px 1px rgba(0, 0, 0, 0.3);\n    z-index: 10;\n}\n",""]),t.exports=e},function(t,e,i){var s=i(0),r=i(8);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var n={insert:"head",singleton:!1},a=(s(r,n),r.locals?r.locals:{});t.exports=a},function(t,e,i){(e=i(1)(!1)).push([t.i,".osh-view {\n    width:100%;\n    height: 100%;\n}\n",""]),t.exports=e},function(t,e,i){"use strict";i.r(e);Math.pow(2,53);function s(t){return null!=t}function r(t){return s(t)&&null!==t}function n(t,e){return r(t)&&typeof t===e}function a(t,e="letiable"){if(!s(t))throw e+" must be defined";return t}function o(t,e="letiable"){if(!s(t)||!t)throw e;return t}function c(t,e,i="letiable"){if(a(t,i),typeof t!==e)throw i+" must be of type "+e;return t}function d(t,e="letiable"){if(a(t,e),!Array.isArray(t))throw e+" must be an array";return t}function h(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}const u="closed-error";var p=class{constructor(t,e){this.id="DataSource-"+h(),this.name=t,this.properties=e,this.currentRunningProperties={},this.eventSubscriptionMap={},this.initialized=!1,this.init=void 0,this.messagesMap={}}getId(){return this.id}getName(){return this.name}getCurrentRunningProperties(){return this.currentRunningProperties}terminate(){null!==this.dataSourceWorker&&this.dataSourceWorker.terminate()}getTopicId(){return"datasource-data-"+this.id}getVersion(){return 0}subscribe(t,e){for(let i=0;i<e.length;i++)e[i]in this.eventSubscriptionMap||(this.eventSubscriptionMap[e[i]]=[]),this.eventSubscriptionMap[e[i]].push(t)}async createWorker(t){}async updateProperties(t){return this.currentRunningProperties={...this.properties,...t},new Promise(e=>{this.postMessage({message:"update-url",data:t},e)})}async connect(){await this.checkInit(),await this.doConnect()}async initDataSource(){return new Promise(async t=>{this.dataSourceWorker=await this.createWorker(this.properties),this.handleWorkerMessage(),this.postMessage({message:"init",id:this.id,properties:this.properties,topic:this.getTopicId()},function(e){new BroadcastChannel(this.getTopicId()).onmessage=t=>{const e=t.data.type;if(e in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[e].length;i++)this.eventSubscriptionMap[e][i](t.data)},this.initialized=e,t()}.bind(this))})}async checkInit(){return new Promise(async(t,e)=>{s(this.init)||(this.init=this.initDataSource()),await this.init,t()})}async doConnect(){return new Promise(async t=>{this.postMessage({message:"connect"},t)})}async isConnected(){return new Promise(async t=>{await this.checkInit(),this.postMessage({message:"is-connected"},t)})}async disconnect(){return new Promise(async t=>{await this.checkInit(),this.postMessage({message:"disconnect"},t)})}postMessage(t,e){const i=h();this.dataSourceWorker.postMessage({...t,messageId:i}),s(e)&&(this.messagesMap[i]=e)}handleWorkerMessage(){this.dataSourceWorker.onmessage=t=>{const e=t.data.messageId;e in this.messagesMap&&(this.messagesMap[e](t.data.data),delete this.messagesMap[e])}}onDisconnect(){}reset(){}};var l=class extends p{constructor(t,e){super(t,e),a(e,"Some properties must be defined"),a(e.startTime,"startTime must must be defined"),a(e.endTime,"startTime must must be defined"),this.timeSync=null}getTimeTopicId(){return"datasource-time-"+this.id}getStartTime(){return this.properties.startTime}getEndTime(){return this.properties.endTime}getMinTime(){return this.properties.minTime}getMaxTime(){return this.properties.maxTime}getReplaySpeed(){return s(this.currentRunningProperties)&&s(this.currentRunningProperties.replaySpeed)?this.currentRunningProperties.replaySpeed:s(this.properties.replaySpeed)?this.properties.replaySpeed:1}async setDataSynchronizer(t){return new Promise(async(e,i)=>{await this.checkInit();const s="data-synchronizer-"+t.id;this.timeSync=t,this.postMessage({message:"topic",topic:s,timeTopic:this.getTimeTopicId()},e)})}async initDataSource(t){return await super.initDataSource(t),new Promise(async t=>{this.postMessage({message:"topic",topic:this.getTopicId(),timeTopic:this.getTimeTopicId()},function(){new BroadcastChannel(this.getTimeTopicId()).onmessage=t=>{const e=t.data.type;if(e in this.eventSubscriptionMap)for(let i=0;i<this.eventSubscriptionMap[e].length;i++)this.eventSubscriptionMap[e][i](t.data)},t()}.bind(this))})}async setTimeRange(t,e,i,r=!1){let n={};return s(i)&&(n={replaySpeed:i}),this.updateProperties({...this.currentRunningProperties,startTime:t,endTime:e,...n,reconnect:r})}async getCurrentTime(){return s(this.timeSync)?this.timeSync.getCurrentTime():new Promise(t=>{this.postMessage({message:"last-timestamp"},t)})}},f=i(2),m=i.n(f);i(4);var g=class extends l{constructor(t,e){super(t,{timeShift:0,reconnectTimeout:5e3,tls:!1,...e})}async createWorker(t){return new m.a}};i(5),i(7);const v="data",y="status",S="time-changed";var b=class{constructor(t){this.properties=t,this.dataSourcesToFn=void 0,this.data=[],this.props={},this.props.id="layer-"+h(),this.props.name="",this.props.description="",this.props.dataSourceId="",this.props.visible=!0,this.props.filter=!0,s(t.name)&&(this.props.name=t.name),s(t.description)&&(this.props.description=t.description),s(t.dataSourceId)&&(this.props.dataSourceId=t.dataSourceId),s(t.visible)&&(this.props.visible=t.visible),this.initEvents();const e=this;if(this.checkFn("filter")){let t=function(t,i,s){e.props.filter=e.getFunc("filter")(t,i,s)};this.addFn(e.getDataSourcesIdsByProperty("filter"),t)}else{this.properties.filter=function(t,e,i){return!0};let t=async function(t,i,s){e.props.filter=await e.getFunc("filter")(t,i,s)};this.addFn(e.getDataSourcesIdsByProperty("filter"),t)}if(this.checkFn("getVisible")){let t=async function(t,i,s){e.props.visible=await e.getFunc("getVisible")(t,i,s)};this.addFn(e.getDataSourcesIdsByProperty("getVisible"),t)}}saveState(){this.initialState={...this.props}}restoreState(){this.props={...this.initialState}}getFunc(t){return this.properties[t].handler||this.properties[t]}checkFn(t){let e=this.properties[t];if(n(e,"function"))return a(this.properties.dataSourceId,"dataSourceId"),!0;{let i=r(e);return i&&(d(e.dataSourceIds,t+".dataSourceIds"),function(t,e){c(t,"function",e)}(e.handler,t+".handler")),i}}initEvents(){}clear(){}getId(){return this.id}select(t){}addFn(t,e){s(this.dataSourcesToFn)||(this.dataSourcesToFn={});for(let i=0;i<t.length;i++){let r=t[i];s(this.dataSourcesToFn[r])||(this.dataSourcesToFn[r]=[]),this.dataSourcesToFn[r].push(e)}}async setData(t,e,i={}){if(this.data=[],i.dataSourceId=t,s(this.dataSourcesToFn)&&t in this.dataSourcesToFn){let s=this.dataSourcesToFn[t];for(let t=0;t<e.length;t++){t:for(let r=0;r<s.length;r++){if("AsyncFunction"===s[r].constructor.name?await s[r](e[t].data,e[t].timeStamp,i):s[r](e[t].data,e[t].timeStamp,i),!this.props.filter)break t}this.props.filter&&this.data.push({...this.props})}}}getDataSourcesIds(){if(s(this.dataSourcesToFn)){let t=[];for(let e in this.dataSourcesToFn)t.push(e);return t}return a(this.properties.dataSourceId,"dataSourceId must be defined"),[this.properties.dataSourceId]}getDataSourcesIdsByProperty(t){return this.properties[t].dataSourceIds||[this.properties.dataSourceId]}init(){}getProps(){return{type:this.type,values:this.data}}reset(){this.restoreState()}};var w=class extends b{constructor(t){super(t),this.type="data"}async setData(t,e,i){this.props.data=e}getProps(){return{type:this.type,values:this.props.data}}};var x=class{constructor(t){this.layers=[],this.lastRec={},this.dataSources=[],this.id="view-"+h(),this.css="",s(t)&&s(t.css)&&(this.css=t.css),a(t&&t.supportedLayers,"supportedLayers"),d(t.supportedLayers,"supportedLayers"),o(t.supportedLayers.length>0,"supportedLayers.length === 0"),this.supportedLayers=t.supportedLayers,this.init(t)}init(t){this.properties=t,this.elementDiv=document.createElement("div"),this.elementDiv.setAttribute("id",this.id),this.elementDiv.setAttribute("class",this.css+" osh-view"),this.divId=this.id;let e=s(t.container)?t.container:document.body,i=document.getElementById(e);if(s(i)&&null!==i?(i.appendChild(this.elementDiv),this.container=i):(document.body.appendChild(this.elementDiv),this.hide(),this.container=document.body),this.beforeAddingItems(t),s(t)){if(s(t.layers))for(let e=0;e<t.layers.length;e++)this.addLayer(t.layers[e]);s(t.dataSourceId)&&this.addLayer(new w({dataSourceId:t.dataSourceId})),s(t.visible)&&(document.getElementById(this.divId).style.display=t.visible?"block":"none")}const r=this;new MutationObserver(t=>{t.forEach((function(t){"style"===t.attributeName&&r.onResize()}))}).observe(this.elementDiv,{attributes:!0});new MutationObserver((function(t){s(document.getElementById(r.divId))||(this.disconnect(),r.destroy())})).observe(document.body,{childList:!0})}hide(){this.elementDiv.style.display="none"}onResize(){}attachTo(t){s(this.elementDiv.parentNode)&&this.elementDiv.parentNode.removeChild(this.elementDiv),document.getElementById(t).appendChild(this.elementDiv),"none"===this.elementDiv.style.display&&(this.elementDiv.style.display="block"),this.onResize()}beforeAddingItems(t){}getId(){return this.id}getDivId(){return this.divId}setData(t,e){}show(t){}destroy(){}addLayer(t){o(this.supportedLayers.includes(t.type),"this layer is not supported: "+t.type+", should be "+this.supportedLayers),this.layers.push(t);let e=t.getDataSourcesIds();for(let i=0;i<e.length;i++){const s=e[i];let r=this;new BroadcastChannel("datasource-data-"+s).onmessage=async e=>{if(e.data.type===y&&e.data.status===u)r.reset();else if(e.data.type===v){const i=this;t.setData(s,e.data.values).then(()=>{i.setData(s,t.getProps()),r.lastRec[s]=e.data})}};new BroadcastChannel("datasource-time-"+s).onmessage=t=>{t.data.type===S&&r.reset()}}}removeAllFromLayer(t){if(this.layers.includes(t)){for(let e in t.dataSourcesToFn)delete this.lastRec[e];t.reset()}}removeAllFromLayers(){for(let t of this.layers)this.removeAllFromLayer(t)}getDataSourcesId(){let t=[];for(let e=0;e<this.layers.length;e++){let i=this.layers[e];t=t.concat(i.getDataSourcesIds())}return t}reset(){this.removeAllFromLayers()}};var T=class extends x{constructor(t){super(t),this.fps=0,this.width=1920,this.height=1080,this.showTime=!1,this.showStats=!1,this.statistics={averageFps:0,frames:0,firstTime:0,bitRate:0,averageBitRate:0},this.framerate=29.67,s(t)&&(s(t.framerate)&&(this.framerate=t.framerate),s(t.directPlay)&&(this.directPlay=t.directPlay),s(t.codec)&&(this.codec=t.codec),s(t.showTime)&&(this.showTime=t.showTime),s(t.showStats)&&(this.showStats=t.showStats),s(t.width)&&(this.width=t.width),s(t.height)&&(this.height=t.height));let e,i,r=document.getElementById(this.divId);(this.showTime||this.showStats)&&(this.textDiv=document.createElement("div"),this.textDiv.setAttribute("width",""+this.width),this.textDiv.setAttribute("height",15),this.textDiv.setAttribute("class","ffmpeg-info"),this.showTime&&(this.textFpsDiv=document.createElement("div"),this.textFpsDiv.setAttribute("class","ffmpeg-fps"),this.textDiv.appendChild(this.textFpsDiv)),this.showStats&&(this.textStatsDiv=document.createElement("div"),this.textStatsDiv.setAttribute("class","ffmpeg-stats"),this.textDiv.appendChild(this.textStatsDiv)),r.appendChild(this.textDiv)),this.domNode=r,s(document.hidden)?(e="hidden",i="visibilitychange"):s(document.msHidden)?(e="msHidden",i="msvisibilitychange"):s(document.webkitHidden)&&(e="webkitHidden",i="webkitvisibilitychange");const n=this;document.addEventListener(i,(function(){document.hidden?n.skipFrame=!0:n.skipFrame=!1}),!1)}updateStatistics(t){if(this.statistics.frames++,this.statistics.pktSize+=t,0===this.statistics.firstTime)return void(this.statistics.firstTime=performance.now());const e=performance.now();e-this.statistics.firstTime<1e3||(this.statistics.averageFps=(this.statistics.frames-1)/((e-this.statistics.firstTime)/1e3),this.statistics.averageBitRate=(this.statistics.pktSize-t)/((e-this.statistics.firstTime)/1e3),this.statistics.frames=1,this.statistics.pktSize=t,this.statistics.firstTime=e)}onUpdated(t){}destroy(){}onAfterDecoded(){}},I=i(3),D=i.n(I);var M=class extends T{constructor(t){if(super({supportedLayers:["data"],...t}),!1 in window)throw Error("WebCodec API is not supported");if(this.codecMap={vp9:"vp09.02.10.10.01.09.16.09.01",vp8:"vp08.00.41.08",h264:"avc1.42e01e"},this.codec=this.codecMap.h264,s(t.codec)){if(!t.codec in this.codecMap)throw Error("The codec properties.codec is not supported, the list of supported codec: this.codecMap");this.codec=this.codecMap[t.codec]}this.canvasElt=this.createCanvas(this.width,this.height),this.domNode.appendChild(this.canvasElt)}createCanvas(t,e,i){const r=document.createElement("canvas");return r.setAttribute("width",t),r.setAttribute("height",e),s(i)&&r.setAttribute("style",i),r}updateCanvasSize(t,e){this.canvasElt.setAttribute("width",t),this.canvasElt.setAttribute("height",e)}setData(t,e){const i=e.values;for(let t=0;t<i.length;t++)if(!this.skipFrame){const t=i.shift();let e=t.data.frameData,s=t.data.roll,r=e.length;this.decode(r,e,t.timeStamp,s)}}reset(){}initDecoder(){const t=this.canvasElt.getContext("bitmaprenderer");this.decodeWorker=new D.a,this.decodeWorker.postMessage({init:{codec:this.codec,width:this.width,height:this.height}}),this.decodeWorker.onmessage=e=>{if(e.data.init)this.codecConfigured=!0;else if(this.codecConfigured){const i=e.data.bitmap,r=e.data.width,n=e.data.height;if(!s(i))return void console.warn("Bitmap is undefined, skipping this frame..");try{this.width===r&&this.height===n||(this.width=r,this.height=n,this.updateCanvasSize(r,n)),t.transferFromImageBitmap(i),this.updateStatistics(e.data.pktSize),this.showTime&&(this.textFpsDiv.innerText=new Date(e.data.timestamp).toISOString()+" "),this.showStats&&(this.textStatsDiv.innerText=this.statistics.averageFps.toFixed(2)+" fps, "+(this.statistics.averageBitRate/1e3).toFixed(2)+" kB/s @"),this.onUpdated(this.statistics)}catch(t){console.error(t)}finally{i.close()}}}}decode(t,e,i,s){this.codecConfigured||this.initDecoder(),this.codecConfigured?this.decodeWorker.postMessage({pktSize:t,pktData:e,roll:s,codec:this.codec,timeStamp:i},[e.buffer]):console.warn("decoder has not been initialized yet")}destroy(){super.destroy()}};let F=new g("drone-Video",{protocol:"ws",service:"SOS",endpointUrl:"sensiasoft.net:8181/sensorhub/sos",offeringID:"urn:mysos:solo:video2",observedProperty:"http://sensorml.com/ont/swe/property/VideoFrame",startTime:"2015-12-19T21:04:30Z",endTime:"2015-12-19T21:09:19Z",replaySpeed:1});new M({container:"video-h264-container",css:"video-h264",name:"UAV Video",showTime:!0,showStats:!0,dataSourceId:F.id});F.connect()}]);