<div>
    <div id="cesium-container" style="height:100%; width:100%"></div>

    <script type="text/javascript">
        //@ sourceURL=cesium-fois.html.js
        window.CESIUM_BASE_URL = 'vendor/';

        var server = new OSH.Server({
            url:"https://nys.georobotix.com",
            sos: "sos",
            baseUrl: "sensorhub"
        });

        // create Leaflet view
        var cesiumView = new OSH.UI.CesiumView("cesium-container", []);
        cesiumView.viewer.terrainProvider = new Cesium.EllipsoidTerrainProvider();
        cesiumView.first = false; // don't zoom on first item added
        
        // retrieve list of features of interest from server (async call)
        server.getFeatureOfInterest("urn:osh:sensor:nysmesonet", function(resp) {

            // render each feature with a marker
            resp.GetFeatureOfInterestResponse.featureMember.forEach(function(f) {

                // parse location from GML
                var pos = f.location.pos.split(" ");
                var pointMarker = new OSH.UI.Styler.PointMarker({
                    location: {
                           x: parseFloat(pos[1]),
                           y: parseFloat(pos[0])
                    },
                    icon: 'images/marker-icon.png',
                    iconAnchor: [12, 41],
                    label: f.name,
                    labelColor: '#000000',
                    labelSize: 40
                });
 
                // add marker to Leaflet map
                cesiumView.addViewItem({
                    name: f.name + " (" + pos[1] + "," + pos[0] + ")",
                    description: f.description,
                    styler: pointMarker
                });
            });

            // zoom to all created markers
            cesiumView.viewer.zoomTo(cesiumView.viewer.entities, new Cesium.HeadingPitchRange(Cesium.Math.toRadians(0), Cesium.Math.toRadians(-90), 5e5));
        });

    </script>
</div>
