<div>
    <div id="cesium-container" style="height:100%; width:100%"></div>

    <script type="text/javascript">
        //@ sourceURL=cesium-fois.html.js
        window.CESIUM_BASE_URL = 'vendor/';

        var server = new OSH.Server({
            url: "http://sensiasoft.net:8181",
            sos: "sos",
            baseUrl: "sensorhub"
        });

        // create Cesium view
        var cesiumView = new OSH.UI.CesiumView("cesium-container", []);
        cesiumView.first = false; // don't zoom on first item added
        
        // retrieve list of features of interest from server (async call)
        //$loading = $("<p style='position:absolute; color:white; top:20; left:20; z-index:1000'>Loading...</p>");
        $loading = $("<img class='spinner' src='images/spinner.svg'>");
        $("#cesium-container").after($loading);
        server.getFeatureOfInterest("urn:usgs:water:network", function(resp) {

            // render each feature with a marker
            resp.GetFeatureOfInterestResponse.featureMember.forEach(function(f) {

                // parse location from GML
                var pos = f.shape.pos.split(" ");
                var pointMarker = new OSH.UI.Styler.PointMarker({
                    location: {
                           x: parseFloat(pos[1]),
                           y: parseFloat(pos[0])
                    },
                    icon: 'images/marker-icon.png',
                    iconAnchor: [12, 41],
                    /*label: f.id,
                    labelColor: '#ffffff',
                    labelSize: 28,
                    labelOffset: [0, 10],*/
                });
 
                // add marker to Leaflet map
                cesiumView.addViewItem({
                    name: f.name,
                    description: f.description + "<br/>" +
                        "Latitude: " + pos[0] + "°<br/>" +
                        "Longitude: " + pos[1] + "°",
                    styler: pointMarker
                });
            });
            
            // zoom to all created markers
            cesiumView.viewer.zoomTo(cesiumView.viewer.entities, new Cesium.HeadingPitchRange(Cesium.Math.toRadians(0), Cesium.Math.toRadians(-90), 5e5));
            $loading.remove();
        });

    </script>
</div>
